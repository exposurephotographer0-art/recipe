
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>& Dine ‚Äî Dinner Planner</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fdf8f2;
    --surface: #ffffff;
    --surface2: #faf4ec;
    --border: #e8ddd0;
    --accent: #b5763a;
    --accent2: #c98b50;
    --text: #2d2118;
    --text-muted: #8c7260;
    --text-soft: #5c4433;
    --danger: #c0442a;
    --success: #3d7a52;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; font-size:15px; }

  /* HEADER */
  header {
    padding: 20px 36px;
    border-bottom: 1px solid var(--border);
    box-shadow: 0 1px 8px rgba(45,33,24,0.07);
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top:0; background:var(--bg); z-index:100;
  }
  .logo { font-family:'Playfair Display',serif; font-size:1.5rem; color:var(--accent); }
  nav { display:flex; gap:4px; }
  nav button {
    background:none; border:none; color:var(--text-muted);
    font-family:'DM Sans',sans-serif; font-size:0.82rem; letter-spacing:0.08em;
    text-transform:uppercase; padding:8px 16px; cursor:pointer; border-radius:6px; transition:all 0.2s;
  }
  nav button.active, nav button:hover { background:var(--surface2); color:var(--accent); }
  .badge {
    background:var(--accent); color:#fff; font-size:0.62rem; font-weight:700;
    padding:2px 6px; border-radius:10px; margin-left:4px; vertical-align:middle;
  }

  /* LAYOUT */
  main { max-width:1120px; margin:0 auto; padding:36px 24px; }
  .view { display:none; }
  .view.active { display:block; }
  .page-title { font-family:'Playfair Display',serif; font-size:1.9rem; margin-bottom:6px; }
  .page-sub { color:var(--text-muted); font-size:0.88rem; margin-bottom:28px; }

  /* BUTTONS */
  .btn-primary {
    background:var(--accent); color:#fff; border:none;
    padding:11px 26px; border-radius:8px; font-family:'DM Sans',sans-serif;
    font-weight:500; font-size:0.88rem; cursor:pointer; transition:background 0.2s;
  }
  .btn-primary:hover { background:var(--accent2); }
  .btn-secondary {
    background:var(--surface2); color:var(--text-soft); border:1px solid var(--border);
    padding:11px 22px; border-radius:8px; font-family:'DM Sans',sans-serif;
    font-size:0.88rem; cursor:pointer; transition:all 0.2s;
  }
  .btn-secondary:hover { border-color:var(--accent); color:var(--accent); }
  .btn-sm {
    font-size:0.72rem; padding:5px 10px; border-radius:6px;
    border:1px solid var(--border); background:var(--surface2);
    color:var(--text-muted); cursor:pointer; font-family:'DM Sans',sans-serif; transition:all 0.15s;
  }
  .btn-sm:hover { border-color:var(--accent); color:var(--accent); }
  .btn-sm.danger:hover { border-color:var(--danger); color:var(--danger); }
  .icon-btn {
    background:none; border:1px solid var(--border); color:var(--text-muted);
    width:32px; height:32px; border-radius:6px; cursor:pointer;
    display:flex; align-items:center; justify-content:center; font-size:1rem; transition:all 0.15s; flex-shrink:0;
  }
  .icon-btn:hover { border-color:var(--danger); color:var(--danger); }

  /* COOKED MODAL */
  .cooked-ingredient-row {
    display: grid;
    grid-template-columns: 24px 1fr auto auto auto;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 9px;
    background: var(--surface2);
    border: 1px solid var(--border);
    transition: all 0.15s;
  }
  .cooked-ingredient-row.in-pantry { border-color: var(--success)33; }
  .cooked-ingredient-row.skipped { opacity: 0.45; }
  .cooked-ingredient-row .ci-name { font-size: 0.88rem; color: var(--text); }
  .cooked-ingredient-row .ci-qty-input {
    width: 62px; text-align: center; padding: 5px 6px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 6px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.82rem;
  }
  .cooked-ingredient-row .ci-unit { font-size: 0.76rem; color: var(--text-muted); min-width: 26px; }
  .ci-pantry-flag { font-size: 0.67rem; color: var(--success); }
  .ci-missing-flag { font-size: 0.67rem; color: var(--text-muted); font-style: italic; }
  .cooked-list { display: flex; flex-direction: column; gap: 7px; max-height: 52vh; overflow-y: auto; margin-bottom: 4px; }
  .cooked-summary { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 12px 15px; margin-bottom: 14px; font-size: 0.83rem; line-height: 1.6; color: var(--text-soft); }
  .cooked-btn-cooked { background: var(--success); color: #fff; border: none; padding: 11px 22px; border-radius: 8px; font-family: 'DM Sans', sans-serif; font-weight: 500; font-size: 0.88rem; cursor: pointer; transition: opacity 0.2s; }
  .cooked-btn-cooked:hover { opacity: 0.85; }

  /* WEEK GRID */
  .week-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:10px; margin-bottom:28px; }
  .day-card {
    background:var(--surface); border:1px solid var(--border); border-radius:12px;
    padding:14px 12px; min-height:155px; display:flex; flex-direction:column; gap:8px; transition:border-color 0.2s;
    box-shadow: 0 1px 4px rgba(45,33,24,0.06);
  }
  .day-card:hover { border-color:var(--accent); }
  .day-label { font-size:0.68rem; text-transform:uppercase; letter-spacing:0.12em; color:var(--text-muted); font-weight:500; }
  .day-meal { font-size:0.85rem; color:var(--text-soft); flex:1; line-height:1.4; }
  .day-meal.empty { color:var(--border); font-style:italic; font-size:0.78rem; }
  .day-actions { display:flex; gap:5px; flex-wrap:wrap; }
  .bottom-bar { display:flex; gap:12px; align-items:center; padding-top:22px; border-top:1px solid var(--border); }

  /* MODALS */
  .modal-overlay {
    position:fixed; inset:0; background:rgba(45,33,24,0.55); z-index:200;
    display:none; align-items:center; justify-content:center; padding:20px;
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background:var(--surface); border:1px solid var(--border); border-radius:16px;
    padding:30px; width:100%; max-width:540px; max-height:90vh; overflow-y:auto;
  }
  .modal.wide { max-width:680px; }
  .modal h2 { font-family:'Playfair Display',serif; font-size:1.35rem; margin-bottom:18px; color:var(--accent); }
  .form-group { margin-bottom:14px; }
  label { display:block; font-size:0.78rem; text-transform:uppercase; letter-spacing:0.1em; color:var(--text-muted); margin-bottom:5px; }
  input[type="text"], textarea, select {
    width:100%; background:var(--surface2); border:1px solid var(--border);
    color:var(--text); padding:9px 13px; border-radius:8px;
    font-family:'DM Sans',sans-serif; font-size:0.93rem; outline:none; transition:border-color 0.2s;
  }
  input:focus, textarea:focus, select:focus { border-color:var(--accent); }
  textarea { resize:vertical; min-height:75px; }
  select option { background:var(--surface2); }
  .ingredient-row { display:grid; grid-template-columns:1fr 75px 110px 65px auto; gap:7px; margin-bottom:7px; align-items:start; }
  .ingredient-row input { margin:0; }
  .add-ingredient-btn {
    background:none; border:1px dashed var(--border); color:var(--text-muted);
    padding:7px; border-radius:8px; cursor:pointer; font-family:'DM Sans',sans-serif;
    font-size:0.83rem; width:100%; transition:all 0.2s; margin-top:3px;
  }
  .add-ingredient-btn:hover { border-color:var(--accent); color:var(--accent); }
  .modal-actions { display:flex; gap:10px; margin-top:22px; justify-content:flex-end; flex-wrap:wrap; }

  /* SHOPPING AISLES */
  .shop-aisle { margin-bottom: 22px; }
  .shop-aisle-header {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 10px; padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
    position: sticky; top: 61px; background: var(--bg);
    z-index: 10; padding-top: 6px;
  }
  .shop-aisle-icon { font-size: 1.1rem; }
  .shop-aisle-title {
    font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.1em;
    color: var(--text-muted); font-weight: 500; flex: 1;
  }
  .shop-aisle-count {
    font-size: 0.7rem; color: var(--text-muted);
    background: var(--surface2); border: 1px solid var(--border);
    padding: 2px 7px; border-radius: 10px;
  }
  .ingredient-item .del-btn {
    background: none; border: none; color: var(--border);
    cursor: pointer; font-size: 1rem; padding: 0 4px; line-height: 1;
    transition: color 0.15s; flex-shrink: 0;
  }
  .ingredient-item .del-btn:hover { color: var(--danger); }

  /* SHOPPING */
  .shopping-header { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:24px; gap:16px; flex-wrap:wrap; }
  .ingredient-list { display:flex; flex-direction:column; gap:7px; }
  .ingredient-item {
    background:var(--surface); border:1px solid var(--border); border-radius:10px;
    padding:12px 16px; display:flex; align-items:center; gap:12px; transition:opacity 0.2s;
  }
  .ingredient-item.checked { opacity:0.4; }
  .ingredient-item.checked .ing-name { text-decoration:line-through; }
  .ingredient-item input[type="checkbox"] { width:17px; height:17px; accent-color:var(--accent); cursor:pointer; flex-shrink:0; }
  .ing-name { flex:1; font-size:0.93rem; }
  .ing-qty { color:var(--text-muted); font-size:0.83rem; white-space:nowrap; }
  .ing-meal { font-size:0.72rem; color:var(--border); font-style:italic; }

  /* PANTRY CATEGORIES */
  .pantry-section { margin-bottom: 28px; }
  .pantry-section-header {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 12px; padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }
  .pantry-section-icon { font-size: 1.2rem; }
  .pantry-section-title {
    font-family: 'Playfair Display', serif; font-size: 1rem;
    color: var(--text-soft); flex: 1;
  }
  .pantry-section-count {
    font-size: 0.72rem; color: var(--text-muted);
    background: var(--surface2); border: 1px solid var(--border);
    padding: 2px 8px; border-radius: 10px;
  }
  .pantry-cat-badge {
    font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--text-muted); background: var(--surface2);
    border: 1px solid var(--border); padding: 2px 7px; border-radius: 10px;
    white-space: nowrap;
  }

  /* PANTRY */
  .pantry-toolbar { display:flex; gap:10px; align-items:flex-start; margin-bottom:20px; flex-wrap:wrap; justify-content:space-between; }
  .pantry-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(210px,1fr)); gap:10px; }
  .pantry-item {
    background:var(--surface); border:1px solid var(--border); border-radius:10px;
    padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .pantry-item-info .p-name { font-size:0.92rem; color:var(--text); }
  .pantry-item-info .p-qty { font-size:0.8rem; color:var(--text-muted); margin-top:2px; }
  .pantry-item-info .p-added { font-size:0.7rem; color:var(--border); margin-top:3px; }
  .pantry-item-actions { display:flex; gap:5px; flex-shrink:0; }
  .edit-btn, .remove-btn {
    background:none; border:1px solid var(--border); border-radius:6px;
    color:var(--text-muted); cursor:pointer; font-size:0.75rem; padding:4px 8px; transition:all 0.15s;
  }
  .edit-btn:hover { border-color:var(--accent); color:var(--accent); }
  .remove-btn:hover { border-color:var(--danger); color:var(--danger); }

  /* RECIPES */
  .recipes-toolbar { display:flex; gap:10px; align-items:flex-start; margin-bottom:16px; flex-wrap:wrap; justify-content:space-between; }

  /* RECIPE FILTERS */
  .recipe-filters { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:20px; align-items:center; }
  .filter-chip {
    background:var(--surface2); border:1px solid var(--border); color:var(--text-muted);
    padding:5px 13px; border-radius:20px; font-size:0.75rem; cursor:pointer;
    font-family:'DM Sans',sans-serif; transition:all 0.15s; white-space:nowrap;
  }
  .filter-chip:hover { border-color:var(--accent); color:var(--accent); }
  .filter-chip.active { background:var(--accent); color:#fff; border-color:var(--accent); font-weight:500; }
  .filter-chip.pantry-chip.active { background:var(--success); border-color:var(--success); color:#fff; }
  .filter-chip.onepot-chip.active { background:#7c5c3a; border-color:#7c5c3a; color:#fff; }
  .filter-divider { width:1px; height:22px; background:var(--border); margin:0 2px; flex-shrink:0; }
  .recipe-count { font-size:0.78rem; color:var(--text-muted); padding:5px 0; }
  .cook-time-tag, .one-pot-tag, .pantry-match-tag {
    font-size:0.65rem; padding:2px 7px; border-radius:10px; white-space:nowrap;
  }
  .cook-time-tag { color:var(--text-muted); background:var(--surface2); border:1px solid var(--border); }
  .one-pot-tag { color:#7c5c3a; background:#7c5c3a15; border:1px solid #7c5c3a33; }
  .pantry-match-tag { color:var(--success); background:var(--success)12; border:1px solid var(--success)33; }
  .recipes-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px; }
  .recipe-card {
    background:var(--surface); border:1px solid var(--border); border-radius:12px;
    padding:20px; display:flex; flex-direction:column; gap:10px; transition:border-color 0.2s;
    box-shadow: 0 1px 4px rgba(45,33,24,0.06);
  }
  .recipe-card:hover { border-color:var(--accent); }
  .recipe-card-header { display:flex; align-items:flex-start; justify-content:space-between; gap:8px; }
  .recipe-name { font-family:'Playfair Display',serif; font-size:1.05rem; color:var(--text); flex:1; }
  .recipe-tag {
    font-size:0.65rem; text-transform:uppercase; letter-spacing:0.1em;
    background:var(--surface2); border:1px solid var(--border);
    color:var(--text-muted); padding:3px 8px; border-radius:20px; white-space:nowrap;
  }
  .recipe-desc { font-size:0.82rem; color:var(--text-muted); line-height:1.5; }
  .recipe-meta { font-size:0.75rem; color:var(--border); }
  .recipe-actions { display:flex; gap:7px; margin-top:4px; flex-wrap:wrap; }

  /* FAVOURITE STAR */
  .fav-btn {
    background: none; border: none; cursor: pointer;
    font-size: 1.1rem; line-height: 1; padding: 2px 4px;
    transition: transform 0.15s; flex-shrink: 0; opacity: 0.35;
  }
  .fav-btn:hover { transform: scale(1.25); opacity: 0.7; }
  .fav-btn.is-fav { opacity: 1; }
  .filter-chip.fav-chip.active { background: #d4a017; border-color: #d4a017; color: #fff; }

  /* recipe detail */
  .ing-chips { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:16px; }
  .ing-chip {
    background:var(--surface2); border:1px solid var(--border); border-radius:20px;
    padding:4px 12px; font-size:0.8rem; color:var(--text-soft);
  }
  .recipe-steps ol { padding-left:18px; color:var(--text-soft); font-size:0.87rem; line-height:1.8; }

  /* recipe picker */
  .recipe-picker-list { max-height:340px; overflow-y:auto; display:flex; flex-direction:column; gap:7px; }
  .recipe-picker-item {
    background:var(--surface2); border:1px solid var(--border); border-radius:8px;
    padding:12px 14px; cursor:pointer; transition:all 0.15s;
  }
  .recipe-picker-item:hover { border-color:var(--accent); }
  .recipe-picker-item .r-name { font-size:0.93rem; color:var(--text); }
  .recipe-picker-item .r-meta { font-size:0.75rem; color:var(--text-muted); margin-top:2px; }

  /* MISC */
  .empty-state { text-align:center; padding:56px 20px; color:var(--text-muted); }
  .empty-state .big { font-size:2.8rem; margin-bottom:10px; }
  .empty-state h3 { font-family:'Playfair Display',serif; font-size:1.2rem; margin-bottom:6px; color:var(--text-soft); }
  .success-banner {
    background:rgba(106,158,111,0.15); border:1px solid var(--success);
    color:var(--success); padding:13px 18px; border-radius:10px; margin-bottom:22px; font-size:0.88rem;
  }

  /* AI FEATURES */
  .ai-badge {
    display:inline-flex; align-items:center; gap:4px;
    background:linear-gradient(135deg,#b5763a22,#c98b5022);
    border:1px solid #b5763a55; color:#7c4a1e;
    font-size:0.65rem; letter-spacing:0.08em; text-transform:uppercase;
    padding:2px 8px; border-radius:20px; font-weight:500;
  }
  .ai-btn {
    background:linear-gradient(135deg,#b5763a,#c98b50);
    color:#fff; border:none; padding:6px 12px; border-radius:6px;
    font-family:'DM Sans',sans-serif; font-size:0.72rem; font-weight:500;
    cursor:pointer; transition:all 0.2s; white-space:nowrap;
    display:inline-flex; align-items:center; gap:4px;
  }
  .ai-btn:hover { background:linear-gradient(135deg,#9a6030,#b5763a); transform:translateY(-1px); }
  .ai-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
  .ai-btn-secondary {
    background:none; border:1px solid #b5763a55; color:#7c4a1e;
    padding:8px 16px; border-radius:8px; font-family:'DM Sans',sans-serif;
    font-size:0.82rem; cursor:pointer; transition:all 0.2s; display:inline-flex; align-items:center; gap:5px;
  }
  .ai-btn-secondary:hover { background:#b5763a18; border-color:#b5763a; }
  .ai-btn-secondary:disabled { opacity:0.5; cursor:not-allowed; }

  .ai-key-btn {
    background:none; border:1px solid var(--border); color:var(--text-muted);
    font-family:'DM Sans',sans-serif; font-size:0.75rem; padding:6px 12px;
    border-radius:6px; cursor:pointer; transition:all 0.2s; white-space:nowrap;
  }
  .ai-key-btn:hover { border-color:var(--accent); color:var(--accent); }
  .ai-key-btn.has-key { border-color:var(--success)44; color:var(--success); }
  .key-tip { font-size:0.78rem; color:var(--text-muted); line-height:1.5; margin-bottom:14px; }
  .key-tip a { color:var(--accent); text-decoration:none; }
  .key-tip a:hover { text-decoration:underline; }

  /* spinner */
  @keyframes spin { to { transform:rotate(360deg); } }
  .spinner { display:inline-block; width:12px; height:12px; border:2px solid rgba(44,33,24,0.2); border-top-color:#b5763a; border-radius:50%; animation:spin 0.7s linear infinite; }
  .spinner.dark { border-color:rgba(181,118,58,0.25); border-top-color:#b5763a; }

  /* AI suggestion modal */
  .ai-suggestions { display:flex; flex-direction:column; gap:8px; margin-top:10px; max-height:320px; overflow-y:auto; }
  .ai-suggestion-item {
    background:var(--surface2); border:1px solid var(--border); border-radius:10px;
    padding:13px 15px; cursor:pointer; transition:all 0.15s;
  }
  .ai-suggestion-item:hover { border-color:#b5763a; background:#b5763a08; }
  .ai-suggestion-item .sug-name { font-size:0.95rem; color:var(--text); margin-bottom:3px; }
  .ai-suggestion-item .sug-why { font-size:0.78rem; color:var(--text-muted); line-height:1.4; }

  /* nutrition chips */
  .nutrition-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
  .nutr-chip {
    background:var(--surface2); border:1px solid var(--border); border-radius:8px;
    padding:6px 12px; font-size:0.78rem; text-align:center;
  }
  .nutr-chip .nutr-val { color:var(--accent); font-weight:600; font-size:0.92rem; }
  .nutr-chip .nutr-label { color:var(--text-muted); font-size:0.68rem; text-transform:uppercase; letter-spacing:0.06em; }

  /* calorie tag */
  .calorie-tag { color:#a0522d; background:#a0522d12; border:1px solid #a0522d33; }
  .calorie-pill {
    display:inline-flex; align-items:center; gap:4px;
    font-size:0.72rem; padding:3px 9px; border-radius:10px;
    color:#a0522d; background:#a0522d12; border:1px solid #a0522d33; white-space:nowrap;
  }
  .day-cal-badge {
    font-size:0.68rem; color:#a0522d; background:#a0522d12;
    border:1px solid #a0522d25; border-radius:8px;
    padding:2px 7px; display:inline-block; margin-top:2px;
  }

  /* cost styles */
  .cost-tag { color:#2e7d5e; background:#2e7d5e10; border:1px solid #2e7d5e33; }
  .cost-pill {
    display:inline-flex; align-items:center; gap:4px;
    font-size:0.72rem; padding:3px 9px; border-radius:10px;
    color:#2e7d5e; background:#2e7d5e10; border:1px solid #2e7d5e33; white-space:nowrap;
  }
  /* calorie breakdown (mirrors cost breakdown) */
  .cal-breakdown {
    background:var(--surface2); border:1px solid var(--border); border-radius:10px;
    padding:12px 14px; margin-top:14px;
  }
  .cal-breakdown-title {
    font-size:0.72rem; text-transform:uppercase; letter-spacing:0.1em;
    color:var(--text-muted); margin-bottom:10px;
  }
  .cal-ing-row {
    display:flex; align-items:center; justify-content:space-between;
    font-size:0.82rem; padding:5px 0;
    border-bottom:1px solid var(--border);
  }
  .cal-ing-row:last-child { border-bottom:none; }
  .cal-ing-name { color:var(--text-soft); flex:1; }
  .cal-ing-val { color:#a0522d; font-weight:500; font-size:0.82rem; white-space:nowrap; margin-left:10px; }
  .cal-total-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 0 0; margin-top:6px; font-size:0.9rem; font-weight:600;
  }
  .cal-total-label { color:var(--text-soft); }
  .cal-total-val { color:#a0522d; font-size:1rem; }
  .cal-per-portion { font-size:0.78rem; color:var(--text-muted); }

  .cost-breakdown {
    background:var(--surface2); border:1px solid var(--border); border-radius:10px;
    padding:12px 14px; margin-top:14px;
  }
  .cost-breakdown-title {
    font-size:0.72rem; text-transform:uppercase; letter-spacing:0.1em;
    color:var(--text-muted); margin-bottom:10px; display:flex;
    align-items:center; justify-content:space-between;
  }
  .cost-ing-row {
    display:flex; align-items:center; justify-content:space-between;
    font-size:0.82rem; padding:5px 0;
    border-bottom:1px solid var(--border);
  }
  .cost-ing-row:last-child { border-bottom:none; }
  .cost-ing-name { color:var(--text-soft); flex:1; }
  .cost-ing-price { color:#2e7d5e; font-weight:500; font-size:0.82rem; white-space:nowrap; margin-left:10px; }
  .cost-total-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 0 0; margin-top:6px; font-size:0.9rem; font-weight:600;
  }
  .cost-total-label { color:var(--text-soft); }
  .cost-total-val { color:#2e7d5e; font-size:1rem; }
  .cost-per-portion { font-size:0.78rem; color:var(--text-muted); }
  .day-cost-badge {
    font-size:0.68rem; color:#2e7d5e; background:#2e7d5e10;
    border:1px solid #2e7d5e25; border-radius:8px;
    padding:2px 7px; display:inline-block; margin-top:2px;
  }

  /* pantry match highlight */
  .ingredient-item.in-pantry { border-color:var(--success)33; }
  .pantry-flag { font-size:0.68rem; color:var(--success); white-space:nowrap; }

  .day-card.drag-over { border-color:var(--accent); background:var(--surface2); box-shadow:0 0 0 2px var(--accent)44; }
  .day-card.dragging { opacity:0.45; cursor:grabbing; }
  .day-card[draggable="true"] { cursor:grab; }

  @media(max-width:768px) {
    header { padding:14px 18px; }
    nav button { padding:6px 10px; font-size:0.72rem; }
    main { padding:22px 14px; }
    .week-grid { grid-template-columns:repeat(2,1fr); }
    .ingredient-row { grid-template-columns:1fr 60px 70px auto; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">& Dine</div>
  <nav>
    <button class="active" onclick="showView('planner')">Week</button>
    <button onclick="showView('recipes')">Recipes <span class="badge" id="rec-badge" style="display:none">0</span></button>
    <button onclick="showView('shopping')">Shopping <span class="badge" id="shop-badge" style="display:none">0</span></button>
    <button onclick="showView('pantry')">Pantry <span class="badge" id="pantry-badge" style="display:none">0</span></button>
  </nav>
</header>

<main>
  <div id="global-error" style="display:none;background:rgba(196,92,58,0.15);border:1px solid var(--danger);color:var(--danger);padding:13px 18px;border-radius:10px;margin-bottom:22px;font-size:0.88rem"></div>

  <!-- PLANNER -->
  <div class="view active" id="view-planner">
    <h1 class="page-title">This Week's Dinners</h1>
    <p class="page-sub">Click a day to pick from your recipe catalog or enter a meal manually.</p>
    <div class="week-grid" id="week-grid"></div>
    <div class="bottom-bar">
      <button class="btn-primary" onclick="generateShoppingList()">Generate Shopping List</button>
      <button class="ai-btn-secondary" onclick="aiPlanWeek()" id="ai-plan-btn">‚ú® AI Plan My Week</button>
      <button class="btn-secondary" onclick="clearWeek()">Clear Week</button>
    </div>
  </div>

  <!-- RECIPES -->
  <div class="view" id="view-recipes">
    <div class="recipes-toolbar">
      <div>
        <h1 class="page-title">Recipe Catalog</h1>
        <p class="page-sub">Your personal dinner library.</p>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <button class="ai-btn-secondary" onclick="aiUpdateAllCalories()" id="ai-calories-btn">üî• AI Update Calories</button>
        <button class="ai-btn-secondary" onclick="aiUpdateAllCosts()" id="ai-costs-btn">üí∑ AI Update Costs</button>
        <button class="ai-btn-secondary" onclick="openAiRecipeModal()">‚ú® AI Generate Recipe</button>
        <button class="btn-secondary" onclick="openUrlImportModal()">üîó Import from URL</button>
        <button class="btn-primary" onclick="openRecipeModal(null)">+ New Recipe</button>
      </div>
    </div>

    <!-- Search + Filters -->
    <div style="margin-bottom:14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <input type="text" placeholder="Search recipes, category or country‚Ä¶" id="recipe-search" oninput="applyRecipeFilters()" style="max-width:340px;flex:1">
      <div style="display:flex;align-items:center;gap:6px;white-space:nowrap">
        <label style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin:0">Sort</label>
        <select id="recipe-sort" onchange="applyRecipeFilters()" style="width:auto;padding:8px 12px;font-size:0.82rem">
          <option value="added">Recently added</option>
          <option value="name">A ‚Äì Z</option>
          <option value="name-desc">Z ‚Äì A</option>
          <option value="cooktime">Cook time (fastest)</option>
          <option value="calories">Calories (lowest)</option>
          <option value="cost">Cost (cheapest)</option>
          <option value="country">Country</option>
        </select>
      </div>
    </div>
    <div class="recipe-filters" id="recipe-filters">
      <!-- Cost -->
      <button class="filter-chip" data-filter="cost" data-value="under5" onclick="toggleFilter(this)">üí∑ Budget (under ¬£5 total)</button>
      <div class="filter-divider"></div>
      <!-- Favourites -->
      <button class="filter-chip fav-chip" data-filter="special" data-value="favourites" onclick="toggleFilter(this)">‚≠ê Favourites</button>
      <div class="filter-divider"></div>
      <!-- Cuisine category -->
      <button class="filter-chip" data-filter="cuisine" data-value="Pasta" onclick="toggleFilter(this)">üçù Pasta</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Curry" onclick="toggleFilter(this)">üçõ Curry</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Asian" onclick="toggleFilter(this)">ü•¢ Asian</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Fish" onclick="toggleFilter(this)">üêü Fish</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Meat" onclick="toggleFilter(this)">ü•© Meat</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Vegetarian" onclick="toggleFilter(this)">ü•¶ Vegetarian</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Soup" onclick="toggleFilter(this)">üç≤ Soup</button>
      <button class="filter-chip" data-filter="cuisine" data-value="Salad" onclick="toggleFilter(this)">ü•ó Salad</button>
      <div class="filter-divider"></div>
      <!-- Ingredients count -->
      <button class="filter-chip" data-filter="ingredients" data-value="few" onclick="toggleFilter(this)">üßÑ &lt;6 ingredients</button>
      <div class="filter-divider"></div>
      <!-- Time -->
      <button class="filter-chip" data-filter="time" data-value="under30" onclick="toggleFilter(this)">‚è± Under 30 min</button>
      <button class="filter-chip" data-filter="time" data-value="under60" onclick="toggleFilter(this)">‚è± Under 1 hr</button>
      <div class="filter-divider"></div>
      <!-- Special -->
      <button class="filter-chip pantry-chip" data-filter="special" data-value="pantry" onclick="toggleFilter(this)">‚úì Can make now</button>
      <button class="filter-chip onepot-chip" data-filter="special" data-value="onepot" onclick="toggleFilter(this)">ü•ò 1-pot meals</button>
      <div class="filter-divider"></div>
      <!-- Calories -->
      <button class="filter-chip" data-filter="calories" data-value="under600" onclick="toggleFilter(this)">üî• Under 600 kcal</button>
    </div>
    <div id="recipe-filter-count" class="recipe-count" style="margin-bottom:14px"></div>

    <div class="recipes-grid" id="recipes-grid"></div>
  </div>

  <!-- SHOPPING -->
  <div class="view" id="view-shopping">
    <div class="shopping-header">
      <div>
        <h1 class="page-title">Shopping List</h1>
        <p class="page-sub">Tick items off as you go.</p>
      </div>
      <div style="display:flex;gap:9px;flex-wrap:wrap;">
        <button class="btn-secondary" onclick="markAllDone()">Mark all done</button>
        <button class="btn-primary" onclick="shoppingBought()">üõí Done ‚Äî Add to Pantry</button>
      </div>
    </div>
    <div id="shopping-list-container"></div>
  </div>

  <!-- PANTRY -->
  <div class="view" id="view-pantry">
    <div id="success-msg" class="success-banner" style="display:none">‚úì Shopping added to pantry!</div>
    <div class="pantry-toolbar">
      <div>
        <h1 class="page-title">Pantry</h1>
        <p class="page-sub">Items in stock ‚Äî edit quantities or add manually.</p>
      </div>
      <div style="display:flex;gap:9px;flex-wrap:wrap;">
        <button class="ai-btn-secondary" onclick="aiCategorisePantry()" id="ai-cat-btn">‚ú® Auto-categorise</button>
        <button class="btn-secondary" onclick="openAddPantryModal()">+ Add Item</button>
        <button class="btn-secondary" onclick="clearPantry()">Clear All</button>
      </div>
    </div>
    <div id="pantry-container"></div>
  </div>

</main>

<!-- MODAL: Manual Meal -->
<div class="modal-overlay" id="meal-modal">
  <div class="modal">
    <h2 id="modal-day-title">Add Meal</h2>
    <div class="form-group">
      <label>Meal Name</label>
      <input type="text" id="meal-name" placeholder="e.g. Pasta Carbonara">
    </div>
    <div class="form-group">
      <label>Notes (optional)</label>
      <textarea id="meal-notes" placeholder="Recipe steps, tips‚Ä¶"></textarea>
    </div>
    <div class="form-group">
      <label>Ingredients</label>
      <div id="ingredients-container"></div>
      <button class="add-ingredient-btn" onclick="addIngredientRow()">+ Add Ingredient</button>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('meal-modal')">Cancel</button>
      <button class="btn-primary" onclick="saveMeal()">Save Meal</button>
    </div>
  </div>
</div>

<!-- MODAL: Pick Recipe for Day -->
<div class="modal-overlay" id="picker-modal">
  <div class="modal">
    <h2 id="picker-day-title">Choose a Recipe</h2>
    <div class="form-group" style="margin-bottom:14px">
      <input type="text" id="picker-search" placeholder="Search‚Ä¶" oninput="renderPicker(this.value)">
    </div>
    <div class="recipe-picker-list" id="picker-list"></div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('picker-modal')">Cancel</button>
      <button class="btn-secondary" onclick="openManualFromPicker()">Enter manually instead</button>
    </div>
  </div>
</div>

<!-- MODAL: Add/Edit Recipe -->
<div class="modal-overlay" id="recipe-modal">
  <div class="modal wide">
    <h2 id="recipe-modal-title">New Recipe</h2>
    <div class="form-group">
      <label>Recipe Name</label>
      <div style="display:flex;gap:8px;align-items:center">
        <input type="text" id="rec-name" placeholder="e.g. Chicken Tikka Masala" style="flex:1">
        <button class="ai-btn" onclick="aiGenerateRecipe()" id="ai-gen-btn" title="Fill recipe details with AI">‚ú® AI Fill</button>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-group">
        <label>Category</label>
        <select id="rec-cat">
          <option>Pasta</option><option>Meat</option><option>Fish</option>
          <option>Vegetarian</option><option>Curry</option><option>Soup</option>
          <option>Salad</option><option>Asian</option><option>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label>Country of Origin</label>
        <input type="text" id="rec-country" list="country-suggestions" placeholder="e.g. Italy, Japan, Mexico‚Ä¶" autocomplete="off">
        <datalist id="country-suggestions">
          <option>Argentina</option><option>Australia</option><option>Austria</option>
          <option>Belgium</option><option>Brazil</option><option>Cambodia</option>
          <option>Canada</option><option>Chile</option><option>China</option>
          <option>Colombia</option><option>Cuba</option><option>Egypt</option>
          <option>Ethiopia</option><option>France</option><option>Georgia</option>
          <option>Germany</option><option>Ghana</option><option>Greece</option>
          <option>Hungary</option><option>India</option><option>Indonesia</option>
          <option>Iran</option><option>Iraq</option><option>Israel</option>
          <option>Italy</option><option>Jamaica</option><option>Japan</option>
          <option>Jordan</option><option>Kenya</option><option>Korea</option>
          <option>Laos</option><option>Lebanon</option><option>Malaysia</option>
          <option>Mexico</option><option>Morocco</option><option>Myanmar</option>
          <option>Nepal</option><option>Netherlands</option><option>Nigeria</option>
          <option>Pakistan</option><option>Peru</option><option>Philippines</option>
          <option>Poland</option><option>Portugal</option><option>Russia</option>
          <option>Saudi Arabia</option><option>Senegal</option><option>South Africa</option>
          <option>Spain</option><option>Sri Lanka</option><option>Sweden</option>
          <option>Taiwan</option><option>Thailand</option><option>Tunisia</option>
          <option>Turkey</option><option>Ukraine</option><option>UK</option>
          <option>USA</option><option>Uzbekistan</option><option>Venezuela</option>
          <option>Vietnam</option><option>Yemen</option>
        </datalist>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-group">
        <label>Serves</label>
        <input type="text" id="rec-serves" placeholder="e.g. 4">
      </div>
      <div class="form-group">
        <label>Cook Time (minutes)</label>
        <input type="number" id="rec-cooktime" placeholder="e.g. 30" min="0">
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-group">
        <label>Calories per serving <span style="font-size:0.7rem;color:var(--text-muted)">(auto-totalled from ingredients)</span></label>
        <div id="rec-calories-display" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px 13px;font-size:0.93rem;color:var(--text-muted);font-family:'DM Sans',sans-serif">‚Äî</div>
        <input type="hidden" id="rec-calories">
      </div>
    </div>
    <div class="form-group" style="display:flex;align-items:center;gap:10px;padding-top:4px">
        <input type="checkbox" id="rec-onepot" style="width:16px;height:16px;cursor:pointer;flex-shrink:0">
        <label for="rec-onepot" style="cursor:pointer;margin:0;font-size:0.85rem">ü•ò One-pot / one-tray meal</label>
      </div>
    <div class="form-group">
      <label>Description</label>
      <textarea id="rec-desc" placeholder="Brief description‚Ä¶" style="min-height:55px"></textarea>
    </div>
    <div class="form-group">
      <label>Ingredients</label>
      <div style="display:grid;grid-template-columns:1fr 75px 110px 65px auto;gap:7px;margin-bottom:4px;padding:0 2px">
        <span style="font-size:0.68rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em">Name</span>
        <span style="font-size:0.68rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em">Qty</span>
        <span style="font-size:0.68rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em">Unit</span>
        <span style="font-size:0.68rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em">kcal</span>
        <span></span>
      </div>
      <div id="rec-ingredients-container"></div>
      <button class="add-ingredient-btn" onclick="addRecipeIngRow()">+ Add Ingredient</button>
    </div>
    <div class="form-group">
      <label>Method / Steps</label>
      <textarea id="rec-steps" placeholder="1. Preheat oven to 200¬∞C&#10;2. Fry the onions‚Ä¶" style="min-height:110px"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('recipe-modal')">Cancel</button>
      <button class="btn-primary" onclick="saveRecipe()">Save Recipe</button>
    </div>
  </div>
</div>

<!-- MODAL: Recipe Detail -->
<div class="modal-overlay" id="recipe-detail-modal">
  <div class="modal wide">
    <div id="recipe-detail-content"></div>
    <div class="modal-actions" id="recipe-detail-actions"></div>
  </div>
</div>

<!-- MODAL: Add/Edit Pantry Item -->
<div class="modal-overlay" id="pantry-modal">
  <div class="modal">
    <h2 id="pantry-modal-title">Add Pantry Item</h2>
    <div class="form-group">
      <label>Item Name</label>
      <input type="text" id="pantry-item-name" placeholder="e.g. Olive Oil">
    </div>
    <div class="form-group">
      <label>Category <span id="ai-cat-suggest-status" style="color:var(--text-muted);font-size:0.75rem;margin-left:6px"></span></label>
      <select id="pantry-item-category">
        <option value="Meat & Fish">ü•© Meat &amp; Fish</option>
        <option value="Dairy & Eggs">ü•õ Dairy &amp; Eggs</option>
        <option value="Fruit & Veg">ü•¶ Fruit &amp; Veg</option>
        <option value="Bakery">üçû Bakery</option>
        <option value="Frozen">üßä Frozen</option>
        <option value="Condiments & Spices">üßÇ Condiments &amp; Spices</option>
        <option value="Drinks">ü•§ Drinks</option>
        <option value="Grains">üåæ Grains</option>
        <option value="Tinned Goods">ü•´ Tinned Goods</option>
        <option value="Snacks">üçø Snacks</option>
        <option value="Other" selected>üì¶ Other</option>
      </select>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="form-group">
        <label>Quantity</label>
        <input type="text" id="pantry-item-qty" placeholder="e.g. 500">
      </div>
      <div class="form-group">
        <label>Unit</label>
        <select id="pantry-item-unit"></select>
        <input type="text" id="pantry-item-unit-other" placeholder="Type unit‚Ä¶" style="display:none;margin-top:6px">
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('pantry-modal')">Cancel</button>
      <button class="btn-primary" onclick="savePantryItem()">Save</button>
    </div>
  </div>
</div>

<!-- MODAL: AI Generate Recipe -->
<div class="modal-overlay" id="ai-recipe-gen-modal">
  <div class="modal wide">
    <h2>‚ú® AI Generate Recipe</h2>
    <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:18px">Describe what you want and AI will build a full recipe for you.</p>
    <div class="form-group">
      <label>What would you like to cook?</label>
      <textarea id="ai-recipe-prompt" placeholder="e.g. A quick weeknight pasta with chorizo and cherry tomatoes‚Ä¶ or a healthy Thai green curry‚Ä¶ or something with leftover chicken and rice‚Ä¶" style="min-height:90px"></textarea>
    </div>
    <div id="ai-recipe-gen-error" style="color:var(--danger);font-size:0.82rem;margin-bottom:8px;display:none"></div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('ai-recipe-gen-modal')">Cancel</button>
      <button class="ai-btn" onclick="runAiRecipeGen()" id="ai-recipe-gen-btn" style="font-size:0.88rem;padding:10px 22px">‚ú® Generate</button>
    </div>
  </div>
</div>

<!-- MODAL: Import Recipe from URL -->
<div class="modal-overlay" id="url-import-modal">
  <div class="modal wide">
    <h2>üîó Import Recipe from URL</h2>
    <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:18px">Paste a link to any recipe page ‚Äî AI will extract the recipe even from busy sites with lots of extra text.</p>
    <div class="form-group">
      <label>Recipe URL</label>
      <input type="url" id="url-import-input" placeholder="https://www.bbcgoodfood.com/recipes/chicken-tikka-masala" autocomplete="off">
    </div>
    <div id="url-import-status" style="font-size:0.82rem;color:var(--text-muted);margin-bottom:6px;display:none;min-height:20px"></div>
    <div id="url-import-error" style="color:var(--danger);font-size:0.82rem;margin-bottom:8px;display:none"></div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('url-import-modal')">Cancel</button>
      <button class="ai-btn" onclick="runUrlImport()" id="url-import-btn" style="font-size:0.88rem;padding:10px 22px">üîó Import Recipe</button>
    </div>
  </div>
</div>

<!-- MODAL: I Cooked This -->
<div class="modal-overlay" id="cooked-modal">
  <div class="modal wide">
    <h2 id="cooked-modal-title">‚úì I Cooked This</h2>
    <div id="cooked-summary" class="cooked-summary"></div>
    <p style="font-size:0.78rem;color:var(--text-muted);margin-bottom:12px">
      Tick off each ingredient you used ‚Äî adjust the quantity if you used more or less. Untick anything you didn't use. Then hit <strong>Update Pantry</strong> to deduct them.
    </p>
    <div class="cooked-list" id="cooked-ingredient-list"></div>
    <div class="modal-actions" style="margin-top:16px">
      <button class="btn-secondary" onclick="closeModal('cooked-modal')">Cancel</button>
      <button class="btn-secondary" onclick="cookedSelectAll()">Select all</button>
      <button class="cooked-btn-cooked" onclick="confirmCooked()">‚úì Update Pantry</button>
    </div>
  </div>
</div>

<!-- MODAL: AI Suggest Meal -->
<div class="modal-overlay" id="ai-modal">
  <div class="modal">
    <h2 id="ai-modal-title">‚ú® AI Meal Suggestions</h2>
    <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:14px" id="ai-modal-sub">Based on your recipe catalog and pantry</p>
    <div id="ai-suggestions-container">
      <div style="text-align:center;padding:30px;color:var(--text-muted)"><div class="spinner dark" style="width:22px;height:22px;margin:0 auto 10px"></div><div style="font-size:0.85rem">Thinking‚Ä¶</div></div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('ai-modal')">Cancel</button>
    </div>
  </div>
</div>

<!-- MODAL: AI Plan Week -->
<div class="modal-overlay" id="ai-week-modal">
  <div class="modal">
    <h2>‚ú® AI Week Plan</h2>
    <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:14px">Tell AI what you're in the mood for this week (optional)</p>
    <div class="form-group">
      <label>Preferences / Notes</label>
      <textarea id="ai-week-prefs" placeholder="e.g. Mostly vegetarian, one fish dish, quick weeknight meals, avoid spicy‚Ä¶" style="min-height:70px"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('ai-week-modal')">Cancel</button>
      <button class="ai-btn" onclick="runAiWeekPlan()" id="ai-week-go-btn" style="font-size:0.88rem;padding:10px 20px">‚ú® Generate Plan</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEFAULT RECIPES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEFAULT_RECIPES = [
  {
    id:'r_default_1', name:'Spaghetti Bolognese', category:'Pasta', serves:'4',
    desc:'A rich, slow-cooked Italian meat sauce served over spaghetti.',
    ingredients:[
      {name:'Spaghetti',qty:'400',unit:'g'},{name:'Beef mince',qty:'500',unit:'g'},
      {name:'Onion',qty:'1',unit:''},{name:'Garlic',qty:'3',unit:'cloves'},
      {name:'Carrot',qty:'1',unit:''},{name:'Celery',qty:'2',unit:'sticks'},
      {name:'Chopped tomatoes',qty:'400',unit:'g'},{name:'Tomato pur√©e',qty:'2',unit:'tbsp'},
      {name:'Beef stock',qty:'150',unit:'ml'},{name:'Olive oil',qty:'2',unit:'tbsp'},
      {name:'Parmesan',qty:'50',unit:'g'},
    ],
    steps:'1. Soften onion, carrot and celery in olive oil for 8 mins.\n2. Add garlic, cook 1 min.\n3. Brown the mince, breaking it up.\n4. Stir in tomato pur√©e, chopped tomatoes and stock.\n5. Simmer uncovered for 45 mins until thick.\n6. Cook spaghetti, drain, serve topped with sauce and Parmesan.',
  },
  {
    id:'r_default_2', name:'Chicken Tikka Masala', category:'Curry', serves:'4',
    desc:'Tender marinated chicken in a creamy, spiced tomato sauce.',
    ingredients:[
      {name:'Chicken breast',qty:'700',unit:'g'},{name:'Plain yoghurt',qty:'150',unit:'ml'},
      {name:'Tikka masala paste',qty:'4',unit:'tbsp'},{name:'Onion',qty:'1',unit:''},
      {name:'Garlic',qty:'3',unit:'cloves'},{name:'Fresh ginger',qty:'2',unit:'tsp'},
      {name:'Chopped tomatoes',qty:'400',unit:'g'},{name:'Double cream',qty:'150',unit:'ml'},
      {name:'Basmati rice',qty:'300',unit:'g'},{name:'Coriander',qty:'1',unit:'handful'},
    ],
    steps:'1. Marinate chicken in yoghurt and half the paste for 30 mins.\n2. Grill or griddle chicken until charred, set aside.\n3. Fry onion until golden, add garlic, ginger and remaining paste.\n4. Add tomatoes, simmer 15 mins.\n5. Stir in cream and chicken, cook 5 more mins.\n6. Serve over rice with coriander.',
  },
  {
    id:'r_default_3', name:'Salmon with Roast Veg', category:'Fish', serves:'2',
    desc:'Oven-baked salmon fillets on a tray of colourful roasted vegetables.',
    ingredients:[
      {name:'Salmon fillets',qty:'2',unit:''},{name:'Courgette',qty:'1',unit:''},
      {name:'Red pepper',qty:'1',unit:''},{name:'Cherry tomatoes',qty:'200',unit:'g'},
      {name:'Red onion',qty:'1',unit:''},{name:'Olive oil',qty:'3',unit:'tbsp'},
      {name:'Lemon',qty:'1',unit:''},{name:'Garlic',qty:'2',unit:'cloves'},
    ],
    steps:'1. Preheat oven to 200¬∞C.\n2. Chop all veg, toss with oil and garlic, roast 20 mins.\n3. Nestle salmon on top, squeeze over lemon.\n4. Return to oven for 12‚Äì15 mins until salmon is cooked through.',
  },
  {
    id:'r_default_4', name:'Mushroom Risotto', category:'Vegetarian', serves:'4',
    desc:'A classic creamy Italian risotto with mixed mushrooms.',
    ingredients:[
      {name:'Arborio rice',qty:'320',unit:'g'},{name:'Mixed mushrooms',qty:'400',unit:'g'},
      {name:'Onion',qty:'1',unit:''},{name:'Garlic',qty:'2',unit:'cloves'},
      {name:'White wine',qty:'150',unit:'ml'},{name:'Vegetable stock',qty:'1.2',unit:'l'},
      {name:'Parmesan',qty:'60',unit:'g'},{name:'Butter',qty:'40',unit:'g'},
      {name:'Olive oil',qty:'2',unit:'tbsp'},{name:'Parsley',qty:'1',unit:'handful'},
    ],
    steps:'1. Keep stock warm in a pan.\n2. Fry onion in oil until soft, add garlic.\n3. Add rice, toast 2 mins, pour in wine.\n4. Add stock one ladle at a time, stirring until absorbed (~20 mins).\n5. Meanwhile saut√© mushrooms in butter.\n6. Stir mushrooms, Parmesan and butter into risotto. Season and serve.',
  },
  {
    id:'r_default_5', name:'Beef Tacos', category:'Meat', serves:'4',
    desc:'Juicy spiced beef mince in warm tortillas with all the toppings.',
    ingredients:[
      {name:'Beef mince',qty:'500',unit:'g'},{name:'Taco seasoning',qty:'2',unit:'tbsp'},
      {name:'Small tortillas',qty:'8',unit:''},{name:'Cheddar cheese',qty:'100',unit:'g'},
      {name:'Sour cream',qty:'100',unit:'ml'},{name:'Salsa',qty:'150',unit:'g'},
      {name:'Avocado',qty:'2',unit:''},{name:'Lime',qty:'1',unit:''},
      {name:'Iceberg lettuce',qty:'0.5',unit:'head'},
    ],
    steps:'1. Brown mince in a pan, drain excess fat.\n2. Add taco seasoning and a splash of water, cook 3 mins.\n3. Warm tortillas in a dry pan or microwave.\n4. Slice avocado, squeeze over lime.\n5. Assemble tacos with mince, cheese, lettuce, salsa, sour cream and avocado.',
  },
  {
    id:'r_default_6', name:'Thai Green Curry', category:'Asian', serves:'4',
    desc:'Fragrant, creamy coconut curry with chicken and vegetables.',
    ingredients:[
      {name:'Chicken breast',qty:'600',unit:'g'},{name:'Green curry paste',qty:'3',unit:'tbsp'},
      {name:'Coconut milk',qty:'400',unit:'ml'},{name:'Fish sauce',qty:'2',unit:'tbsp'},
      {name:'Courgette',qty:'1',unit:''},{name:'Sugar snap peas',qty:'150',unit:'g'},
      {name:'Lime leaves',qty:'4',unit:''},{name:'Lemongrass',qty:'1',unit:'stalk'},
      {name:'Thai basil',qty:'1',unit:'handful'},{name:'Jasmine rice',qty:'300',unit:'g'},
    ],
    steps:'1. Fry curry paste in a little oil for 1 min.\n2. Add coconut milk, lemongrass and lime leaves, bring to simmer.\n3. Add chicken, cook 10 mins.\n4. Add veg, cook 5 more mins.\n5. Season with fish sauce. Stir in basil.\n6. Serve with jasmine rice.',
  },
  {
    id:'r_default_7', name:'Roasted Tomato Soup', category:'Soup', serves:'4',
    desc:'A simple, velvety roasted tomato soup ‚Äî perfect with crusty bread.',
    ingredients:[
      {name:'Ripe tomatoes',qty:'1',unit:'kg'},{name:'Onion',qty:'1',unit:''},
      {name:'Garlic',qty:'4',unit:'cloves'},{name:'Vegetable stock',qty:'500',unit:'ml'},
      {name:'Olive oil',qty:'3',unit:'tbsp'},{name:'Double cream',qty:'50',unit:'ml'},
      {name:'Basil',qty:'1',unit:'handful'},{name:'Crusty bread',qty:'1',unit:'loaf'},
    ],
    steps:'1. Halve tomatoes and place cut-side up on a tray with onion, garlic and oil. Roast at 190¬∞C for 40 mins.\n2. Transfer to a blender with stock, blend until smooth.\n3. Pass through a sieve for extra smoothness if desired.\n4. Reheat gently, stir in cream, season.\n5. Serve with fresh basil and crusty bread.',
  },
  {
    id:'r_default_8', name:'Prawn Stir Fry', category:'Asian', serves:'2',
    desc:'Quick and punchy king prawn stir fry with noodles in a sticky sauce.',
    ingredients:[
      {name:'King prawns',qty:'300',unit:'g'},{name:'Egg noodles',qty:'200',unit:'g'},
      {name:'Red pepper',qty:'1',unit:''},{name:'Pak choi',qty:'2',unit:'heads'},
      {name:'Spring onions',qty:'3',unit:''},{name:'Garlic',qty:'2',unit:'cloves'},
      {name:'Soy sauce',qty:'3',unit:'tbsp'},{name:'Oyster sauce',qty:'2',unit:'tbsp'},
      {name:'Sesame oil',qty:'1',unit:'tsp'},{name:'Fresh ginger',qty:'1',unit:'tsp'},
    ],
    steps:'1. Cook noodles, drain and toss in sesame oil.\n2. Heat wok until smoking, add oil, garlic and ginger.\n3. Add prawns, stir fry 2 mins.\n4. Add veg, stir fry 2 more mins.\n5. Add noodles and sauces, toss everything together for 1 min.\n6. Serve immediately with sliced spring onions.',
  },
];

const WORLD_RECIPES = [
{
  id:'c_it_1',
  name:"Cacio e Pepe",
  category:"Pasta",
  country:"Italy",
  serves:"2",
  desc:"Roman pasta with Pecorino Romano and black pepper \u2014 simple perfection.",
  cookTime:20,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Spaghetti",qty:"200",unit:"g"},
      {name:"Pecorino Romano",qty:"80",unit:"g"},
      {name:"Parmesan",qty:"40",unit:"g"},
      {name:"Black pepper",qty:"2",unit:"tsp"},
      {name:"Pasta water",qty:"100",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cook spaghetti in well-salted water until al dente.\n2. Toast cracked black pepper in a dry pan 1 min.\n3. Mix grated cheeses with a little pasta water to form a paste.\n4. Drain pasta, reserve 150ml water. Add to pepper pan off heat.\n5. Add cheese paste, toss vigorously with pasta water until creamy.\n6. Serve immediately with extra pepper."
},
{
  id:'c_it_2',
  name:"Osso Buco",
  category:"Meat",
  country:"Italy",
  serves:"4",
  desc:"Braised veal shanks in white wine and gremolata \u2014 a Milanese classic.",
  cookTime:120,
  onePot:true,
  calories:680,
  ingredients:[
      {name:"Veal shanks",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Celery",qty:"2",unit:"sticks"},
      {name:"Carrot",qty:"1",unit:""},
      {name:"White wine",qty:"200",unit:"ml"},
      {name:"Chopped tomatoes",qty:"200",unit:"g"},
      {name:"Beef stock",qty:"300",unit:"ml"},
      {name:"Lemon zest",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Olive oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Dust veal shanks in flour, brown in oil. Set aside.\n2. Soften onion, celery and carrot in same pot.\n3. Add garlic, wine, tomatoes and stock.\n4. Return veal, cover and braise 1.5 hrs until tender.\n5. Mix lemon zest, garlic and parsley for gremolata.\n6. Serve with gremolata scattered on top."
},
{
  id:'c_it_3',
  name:"Penne all'Arrabbiata",
  category:"Pasta",
  country:"Italy",
  serves:"4",
  desc:"Fiery tomato and chilli pasta from Rome.",
  cookTime:25,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Penne",qty:"400",unit:"g"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Red chilli",qty:"2",unit:""},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Fry sliced garlic and chilli in olive oil until fragrant.\n2. Add tomatoes, season and simmer 15 mins.\n3. Cook penne until al dente.\n4. Toss pasta in sauce with pasta water.\n5. Serve with fresh parsley."
},
{
  id:'c_it_4',
  name:"Saltimbocca alla Romana",
  category:"Meat",
  country:"Italy",
  serves:"4",
  desc:"Veal escalopes with prosciutto and sage in white wine.",
  cookTime:20,
  onePot:false,
  calories:420,
  ingredients:[
      {name:"Veal escalopes",qty:"4",unit:""},
      {name:"Prosciutto",qty:"4",unit:"slices"},
      {name:"Sage leaves",qty:"8",unit:""},
      {name:"White wine",qty:"100",unit:"ml"},
      {name:"Butter",qty:"40",unit:"g"},
      {name:"Olive oil",qty:"2",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Place a sage leaf and prosciutto slice on each escalope, secure with toothpick.\n2. Pan fry prosciutto-side down in oil and butter 2 mins.\n3. Flip, cook 2 more mins.\n4. Deglaze pan with white wine, reduce 1 min.\n5. Serve with pan juices poured over."
},
{
  id:'c_it_5',
  name:"Ribollita",
  category:"Soup",
  country:"Italy",
  serves:"6",
  desc:"Tuscan hearty bread and bean soup \u2014 traditionally made better the next day.",
  cookTime:60,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Cannellini beans",qty:"2",unit:"tins"},
      {name:"Cavolo nero",qty:"200",unit:"g"},
      {name:"Stale bread",qty:"200",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"2",unit:"sticks"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Vegetable stock",qty:"1",unit:"l"},
      {name:"Rosemary",qty:"2",unit:"sprigs"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"}
  ],
  steps:"1. Soften onion, carrot and celery in oil.\n2. Add garlic, rosemary, tomatoes and stock.\n3. Add beans and cavolo nero, simmer 30 mins.\n4. Tear in stale bread, stir through.\n5. Simmer 10 more mins until thick.\n6. Drizzle with olive oil to serve."
},
{
  id:'c_jp_1',
  name:"Chicken Teriyaki",
  category:"Asian",
  country:"Japan",
  serves:"4",
  desc:"Glossy sweet-soy glazed chicken thighs \u2014 a Japanese weeknight staple.",
  cookTime:25,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Chicken thighs",qty:"700",unit:"g"},
      {name:"Soy sauce",qty:"4",unit:"tbsp"},
      {name:"Mirin",qty:"3",unit:"tbsp"},
      {name:"Sake",qty:"2",unit:"tbsp"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Garlic",qty:"1",unit:"clove"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Sesame seeds",qty:"1",unit:"tbsp"},
      {name:"Steamed rice",qty:"300",unit:"g"}
  ],
  steps:"1. Mix soy, mirin, sake and sugar for the glaze.\n2. Pan-fry chicken thighs skin-side down 5 mins until golden.\n3. Flip, cook 4 more mins.\n4. Pour over glaze, reduce until sticky and coating.\n5. Slice and serve over rice with sesame seeds."
},
{
  id:'c_jp_2',
  name:"Tonkatsu",
  category:"Meat",
  country:"Japan",
  serves:"4",
  desc:"Crispy breaded pork cutlet with tonkatsu sauce and shredded cabbage.",
  cookTime:30,
  onePot:false,
  calories:620,
  ingredients:[
      {name:"Pork loin cutlets",qty:"4",unit:""},
      {name:"Panko breadcrumbs",qty:"100",unit:"g"},
      {name:"Egg",qty:"2",unit:""},
      {name:"Plain flour",qty:"50",unit:"g"},
      {name:"Shredded cabbage",qty:"200",unit:"g"},
      {name:"Tonkatsu sauce",qty:"4",unit:"tbsp"},
      {name:"Vegetable oil",qty:"500",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Pepper",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Season cutlets, dust in flour, dip in egg, coat in panko.\n2. Deep fry at 170\u00b0C for 6\u20138 mins until golden.\n3. Drain on paper and rest 2 mins.\n4. Slice and serve on shredded cabbage.\n5. Drizzle tonkatsu sauce on top."
},
{
  id:'c_jp_3',
  name:"Miso Ramen",
  category:"Soup",
  country:"Japan",
  serves:"4",
  desc:"Rich miso broth ramen with chashu pork, noodles and soft-boiled egg.",
  cookTime:50,
  onePot:true,
  calories:650,
  ingredients:[
      {name:"Ramen noodles",qty:"400",unit:"g"},
      {name:"White miso paste",qty:"4",unit:"tbsp"},
      {name:"Chicken stock",qty:"1.2",unit:"l"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Sesame oil",qty:"1",unit:"tbsp"},
      {name:"Pork belly",qty:"300",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Sweetcorn",qty:"100",unit:"g"},
      {name:"Nori sheets",qty:"4",unit:""}
  ],
  steps:"1. Simmer pork belly in stock with soy 30 mins.\n2. Soft-boil eggs 7 mins, peel.\n3. Whisk miso into hot stock until dissolved.\n4. Cook noodles, divide into bowls.\n5. Pour miso broth over, add pork slices, egg, corn and nori.\n6. Finish with sesame oil and spring onions."
},
{
  id:'c_jp_4',
  name:"Gyoza",
  category:"Asian",
  country:"Japan",
  serves:"4",
  desc:"Pan-fried Japanese pork and cabbage dumplings with dipping sauce.",
  cookTime:40,
  onePot:false,
  calories:380,
  ingredients:[
      {name:"Gyoza wrappers",qty:"30",unit:""},
      {name:"Pork mince",qty:"300",unit:"g"},
      {name:"Cabbage",qty:"150",unit:"g"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Sesame oil",qty:"1",unit:"tbsp"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Rice vinegar",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Mix pork, finely chopped cabbage, garlic, ginger, soy and sesame oil.\n2. Place 1 tsp filling in each wrapper, fold and pleat edges.\n3. Fry flat-side down in oil 2 mins until golden.\n4. Add 4 tbsp water, cover and steam 4 mins.\n5. Serve with soy-vinegar dipping sauce."
},
{
  id:'c_jp_5',
  name:"Oyakodon",
  category:"Asian",
  country:"Japan",
  serves:"4",
  desc:"Chicken and egg rice bowl simmered in dashi and soy \u2014 one of Japan's most beloved comfort dishes.",
  cookTime:25,
  onePot:true,
  calories:510,
  ingredients:[
      {name:"Chicken thighs",qty:"500",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Dashi stock",qty:"300",unit:"ml"},
      {name:"Soy sauce",qty:"3",unit:"tbsp"},
      {name:"Mirin",qty:"3",unit:"tbsp"},
      {name:"Steamed rice",qty:"400",unit:"g"},
      {name:"Spring onions",qty:"2",unit:""}
  ],
  steps:"1. Simmer onion in dashi, soy and mirin 5 mins.\n2. Add sliced chicken, cook 8 mins.\n3. Beat eggs and pour over, cover and cook 2 mins (yolk should be slightly runny).\n4. Slide over bowls of steamed rice.\n5. Garnish with sliced spring onions."
},
{
  id:'c_mx_1',
  name:"Chicken Enchiladas",
  category:"Meat",
  country:"Mexico",
  serves:"4",
  desc:"Corn tortillas filled with spiced chicken, smothered in red chilli sauce and melted cheese.",
  cookTime:45,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Corn tortillas",qty:"8",unit:""},
      {name:"Chicken breast",qty:"600",unit:"g"},
      {name:"Red enchilada sauce",qty:"400",unit:"ml"},
      {name:"Cheddar cheese",qty:"150",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Sour cream",qty:"100",unit:"ml"},
      {name:"Coriander",qty:"1",unit:"handful"}
  ],
  steps:"1. Cook and shred chicken with onion, garlic and cumin.\n2. Fill tortillas with chicken, roll and place in baking dish.\n3. Pour enchilada sauce over, top with cheese.\n4. Bake at 190\u00b0C for 20 mins.\n5. Serve with sour cream and coriander."
},
{
  id:'c_mx_2',
  name:"Chiles Rellenos",
  category:"Vegetarian",
  country:"Mexico",
  serves:"4",
  desc:"Roasted poblano peppers stuffed with cheese, dipped in egg batter and fried.",
  cookTime:50,
  onePot:false,
  calories:520,
  ingredients:[
      {name:"Poblano chillies",qty:"4",unit:""},
      {name:"Queso fresco",qty:"200",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Plain flour",qty:"50",unit:"g"},
      {name:"Vegetable oil",qty:"500",unit:"ml"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Onion",qty:"0.5",unit:""}
  ],
  steps:"1. Char chillies directly on flame, peel and deseed carefully.\n2. Stuff with cheese, close with toothpick.\n3. Separate eggs. Whisk whites to stiff peaks, fold in yolks.\n4. Dust chillies in flour, dip in batter, fry until golden.\n5. Serve in tomato sauce made with blended tomatoes, garlic and onion."
},
{
  id:'c_mx_3',
  name:"Pozole Rojo",
  category:"Soup",
  country:"Mexico",
  serves:"6",
  desc:"Hearty hominy and pork soup with a rich dried chilli broth.",
  cookTime:90,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Pork shoulder",qty:"700",unit:"g"},
      {name:"Hominy corn",qty:"400",unit:"g"},
      {name:"Dried guajillo chillies",qty:"4",unit:""},
      {name:"Dried ancho chillies",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Dried oregano",qty:"1",unit:"tsp"},
      {name:"Chicken stock",qty:"1.5",unit:"l"},
      {name:"Cabbage",qty:"200",unit:"g"},
      {name:"Radishes",qty:"6",unit:""},
      {name:"Lime",qty:"2",unit:""}
  ],
  steps:"1. Boil pork with onion and garlic 60 mins, shred.\n2. Toast chillies, soak in hot water 20 mins, blend to paste.\n3. Fry chilli paste, add stock and hominy.\n4. Add shredded pork, simmer 20 mins.\n5. Serve topped with shredded cabbage, sliced radishes and lime."
},
{
  id:'c_mx_4',
  name:"Mole Poblano",
  category:"Meat",
  country:"Mexico",
  serves:"6",
  desc:"Complex chocolate-chilli sauce over chicken \u2014 a masterpiece of Mexican cuisine.",
  cookTime:90,
  onePot:false,
  calories:640,
  ingredients:[
      {name:"Chicken pieces",qty:"1.2",unit:"kg"},
      {name:"Dried mulato chillies",qty:"4",unit:""},
      {name:"Dried pasilla chillies",qty:"3",unit:""},
      {name:"Dark chocolate",qty:"50",unit:"g"},
      {name:"Sesame seeds",qty:"2",unit:"tbsp"},
      {name:"Peanuts",qty:"40",unit:"g"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Chicken stock",qty:"500",unit:"ml"}
  ],
  steps:"1. Toast and soak chillies 20 mins, blend.\n2. Toast sesame seeds and peanuts separately.\n3. Blend chillies with tomatoes, onion, garlic, spices, nuts and chocolate.\n4. Fry paste in oil 5 mins.\n5. Add stock, simmer 30 mins until thick.\n6. Add grilled chicken, simmer 20 more mins."
},
{
  id:'c_mx_5',
  name:"Sopa de Lima",
  category:"Soup",
  country:"Mexico",
  serves:"4",
  desc:"Yucat\u00e1n lime chicken soup with tortilla strips \u2014 bright and deeply flavourful.",
  cookTime:40,
  onePot:true,
  calories:360,
  ingredients:[
      {name:"Chicken breast",qty:"400",unit:"g"},
      {name:"Limes",qty:"3",unit:""},
      {name:"Chicken stock",qty:"1.2",unit:"l"},
      {name:"Tomatoes",qty:"2",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Green chilli",qty:"1",unit:""},
      {name:"Corn tortillas",qty:"4",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Coriander",qty:"1",unit:"handful"},
      {name:"Vegetable oil",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Simmer chicken in stock with garlic until cooked, shred.\n2. Fry onion, tomato and chilli until soft.\n3. Add to stock with lime juice, simmer 15 mins.\n4. Cut tortillas into strips and fry until crisp.\n5. Ladle soup into bowls, top with tortilla strips and coriander."
},
{
  id:'c_in_1',
  name:"Butter Chicken",
  category:"Curry",
  country:"India",
  serves:"4",
  desc:"Tender chicken in a rich, creamy tomato and butter sauce \u2014 India's most beloved export.",
  cookTime:45,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Chicken breast",qty:"700",unit:"g"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Double cream",qty:"150",unit:"ml"},
      {name:"Tomato passata",qty:"400",unit:"ml"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Garam masala",qty:"2",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Chilli powder",qty:"0.5",unit:"tsp"},
      {name:"Basmati rice",qty:"300",unit:"g"}
  ],
  steps:"1. Marinate chicken in yoghurt and spices 30 mins, grill until charred.\n2. Fry onion in butter until golden. Add garlic and ginger.\n3. Add passata, simmer 15 mins.\n4. Blend sauce until smooth, return to pan.\n5. Add cream and chicken, simmer 10 mins.\n6. Serve with basmati rice."
},
{
  id:'c_in_2',
  name:"Dal Makhani",
  category:"Vegetarian",
  country:"India",
  serves:"4",
  desc:"Slow-cooked black lentils in creamy tomato and butter sauce.",
  cookTime:120,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Black urad dal",qty:"200",unit:"g"},
      {name:"Kidney beans",qty:"100",unit:"g"},
      {name:"Butter",qty:"50",unit:"g"},
      {name:"Double cream",qty:"100",unit:"ml"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Garam masala",qty:"2",unit:"tsp"},
      {name:"Cumin seeds",qty:"1",unit:"tsp"},
      {name:"Chilli powder",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Soak lentils and beans overnight. Pressure cook until soft.\n2. Fry onion, garlic, ginger and cumin seeds in butter.\n3. Add blended tomatoes, cook down 15 mins.\n4. Add lentils and beans, simmer 1 hour on low.\n5. Stir in cream and butter, cook 15 more mins.\n6. Serve with naan or rice."
},
{
  id:'c_in_3',
  name:"Lamb Rogan Josh",
  category:"Curry",
  country:"India",
  serves:"4",
  desc:"Deeply spiced Kashmiri lamb curry with dried chillies and Kashmiri spices.",
  cookTime:80,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Lamb shoulder",qty:"700",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Yoghurt",qty:"150",unit:"ml"},
      {name:"Kashmiri chilli powder",qty:"2",unit:"tsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Whole spices",qty:"1",unit:"tbsp"},
      {name:"Cardamom",qty:"4",unit:"pods"},
      {name:"Fennel seeds",qty:"1",unit:"tsp"},
      {name:"Tomatoes",qty:"2",unit:""},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Brown lamb pieces in oil. Set aside.\n2. Fry whole spices, onion until golden.\n3. Add garlic, ginger, ground spices and chilli.\n4. Add yoghurt slowly, stirring.\n5. Return lamb, add tomatoes and 200ml water.\n6. Cover and simmer 1 hour until lamb is tender."
},
{
  id:'c_in_4',
  name:"Palak Paneer",
  category:"Vegetarian",
  country:"India",
  serves:"4",
  desc:"Fresh paneer cheese in a smooth, spiced spinach sauce.",
  cookTime:35,
  onePot:true,
  calories:420,
  ingredients:[
      {name:"Paneer",qty:"300",unit:"g"},
      {name:"Spinach",qty:"500",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Tomato",qty:"1",unit:""},
      {name:"Garam masala",qty:"1",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Cream",qty:"50",unit:"ml"},
      {name:"Butter",qty:"20",unit:"g"},
      {name:"Oil",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Blanch spinach 2 mins, drain and blend to a pur\u00e9e.\n2. Fry cubed paneer until golden, set aside.\n3. Saut\u00e9 onion, garlic and ginger until soft.\n4. Add tomato and spices, cook 5 mins.\n5. Add spinach pur\u00e9e and cream, simmer 10 mins.\n6. Add paneer, heat through and serve."
},
{
  id:'c_in_5',
  name:"Biryani",
  category:"Asian",
  country:"India",
  serves:"6",
  desc:"Fragrant layered basmati rice and marinated chicken cooked together with saffron and caramelised onions.",
  cookTime:90,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Chicken thighs",qty:"800",unit:"g"},
      {name:"Basmati rice",qty:"400",unit:"g"},
      {name:"Yoghurt",qty:"200",unit:"ml"},
      {name:"Onion",qty:"3",unit:""},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Warm milk",qty:"3",unit:"tbsp"},
      {name:"Garam masala",qty:"3",unit:"tsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Ghee",qty:"3",unit:"tbsp"},
      {name:"Cardamom",qty:"4",unit:"pods"},
      {name:"Rose water",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Marinate chicken in yoghurt and spices 2 hours.\n2. Par-cook rice until 70% done, drain.\n3. Deep fry onions until golden brown.\n4. Cook marinated chicken in ghee until cooked.\n5. Layer rice over chicken in pot with saffron milk and fried onions.\n6. Seal and cook on very low heat 25 mins (dum method)."
},
{
  id:'c_cn_1',
  name:"Kung Pao Chicken",
  category:"Asian",
  country:"China",
  serves:"4",
  desc:"Stir-fried chicken with peanuts, dried chillies and Sichuan peppercorns.",
  cookTime:25,
  onePot:true,
  calories:490,
  ingredients:[
      {name:"Chicken breast",qty:"600",unit:"g"},
      {name:"Dry roasted peanuts",qty:"60",unit:"g"},
      {name:"Dried red chillies",qty:"8",unit:""},
      {name:"Sichuan peppercorns",qty:"1",unit:"tsp"},
      {name:"Soy sauce",qty:"3",unit:"tbsp"},
      {name:"Rice vinegar",qty:"2",unit:"tbsp"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Cornflour",qty:"2",unit:"tsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Spring onions",qty:"3",unit:""}
  ],
  steps:"1. Mix sauce: soy, vinegar, sugar and cornflour.\n2. Stir-fry chillies and Sichuan pepper in hot oil 30 secs.\n3. Add garlic and ginger, then chicken pieces.\n4. Stir fry on high heat 5 mins.\n5. Add sauce, peanuts and spring onions.\n6. Toss and serve with steamed rice."
},
{
  id:'c_cn_2',
  name:"Mapo Tofu",
  category:"Vegetarian",
  country:"China",
  serves:"4",
  desc:"Silken tofu in a fiery, numbing Sichuan chilli bean sauce \u2014 bold and addictive.",
  cookTime:25,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Silken tofu",qty:"600",unit:"g"},
      {name:"Doubanjiang paste",qty:"2",unit:"tbsp"},
      {name:"Pork mince",qty:"150",unit:"g"},
      {name:"Sichuan peppercorns",qty:"1",unit:"tsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Chicken stock",qty:"150",unit:"ml"},
      {name:"Cornflour",qty:"1",unit:"tbsp"},
      {name:"Spring onions",qty:"3",unit:""}
  ],
  steps:"1. Gently simmer cubed tofu in salted water 3 mins, drain.\n2. Fry doubanjiang paste in oil 2 mins.\n3. Add pork, cook until browned.\n4. Add garlic, ginger, stock and soy.\n5. Add tofu, simmer 5 mins.\n6. Thicken with cornflour slurry, finish with toasted Sichuan pepper and spring onions."
},
{
  id:'c_cn_3',
  name:"Char Siu Pork",
  category:"Meat",
  country:"China",
  serves:"4",
  desc:"Sticky Cantonese BBQ pork marinated in five-spice and honey.",
  cookTime:50,
  onePot:false,
  calories:540,
  ingredients:[
      {name:"Pork shoulder",qty:"700",unit:"g"},
      {name:"Hoisin sauce",qty:"3",unit:"tbsp"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Honey",qty:"2",unit:"tbsp"},
      {name:"Five spice",qty:"1",unit:"tsp"},
      {name:"Shaoxing wine",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Red food colouring",qty:"1",unit:"tsp"}
  ],
  steps:"1. Mix marinade ingredients and coat pork.\n2. Marinate in fridge at least 4 hours (overnight best).\n3. Roast at 200\u00b0C for 20 mins.\n4. Brush with reserved marinade mixed with honey.\n5. Roast 10 more mins until lacquered.\n6. Rest 5 mins before slicing."
},
{
  id:'c_cn_4',
  name:"Dan Dan Noodles",
  category:"Asian",
  country:"China",
  serves:"4",
  desc:"Springy noodles in a spicy sesame and chilli sauce with crispy pork.",
  cookTime:30,
  onePot:true,
  calories:560,
  ingredients:[
      {name:"Noodles",qty:"400",unit:"g"},
      {name:"Pork mince",qty:"250",unit:"g"},
      {name:"Tahini",qty:"3",unit:"tbsp"},
      {name:"Chilli oil",qty:"2",unit:"tbsp"},
      {name:"Soy sauce",qty:"3",unit:"tbsp"},
      {name:"Black vinegar",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Sichuan peppercorns",qty:"1",unit:"tsp"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Peanuts",qty:"40",unit:"g"}
  ],
  steps:"1. Cook pork mince with garlic until crispy.\n2. Mix tahini, chilli oil, soy, vinegar and toasted Sichuan pepper for sauce.\n3. Cook noodles, drain.\n4. Divide sauce into bowls, add noodles and pork.\n5. Top with peanuts, spring onions and extra chilli oil."
},
{
  id:'c_cn_5',
  name:"Hong Shao Rou",
  category:"Meat",
  country:"China",
  serves:"4",
  desc:"Shanghai red-braised pork belly \u2014 melt-in-the-mouth with a rich soy-caramel glaze.",
  cookTime:90,
  onePot:true,
  calories:720,
  ingredients:[
      {name:"Pork belly",qty:"700",unit:"g"},
      {name:"Soy sauce",qty:"4",unit:"tbsp"},
      {name:"Dark soy sauce",qty:"2",unit:"tbsp"},
      {name:"Shaoxing wine",qty:"3",unit:"tbsp"},
      {name:"Sugar",qty:"3",unit:"tbsp"},
      {name:"Star anise",qty:"3",unit:""},
      {name:"Ginger",qty:"4",unit:"slices"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Water",qty:"200",unit:"ml"}
  ],
  steps:"1. Blanch pork belly in boiling water 3 mins, drain and cube.\n2. Caramelise sugar in a wok until amber.\n3. Add pork, coat in caramel.\n4. Add soy, dark soy, wine, star anise, ginger and water.\n5. Cover and braise on low 60 mins.\n6. Uncover, reduce sauce until glossy."
},
{
  id:'c_fr_1',
  name:"Boeuf Bourguignon",
  category:"Meat",
  country:"France",
  serves:"6",
  desc:"Slow-braised beef in Burgundy wine with mushrooms, lardons and pearl onions.",
  cookTime:180,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Beef chuck",qty:"1",unit:"kg"},
      {name:"Red wine (Burgundy)",qty:"750",unit:"ml"},
      {name:"Lardons",qty:"150",unit:"g"},
      {name:"Button mushrooms",qty:"250",unit:"g"},
      {name:"Pearl onions",qty:"200",unit:"g"},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"},
      {name:"Thyme",qty:"3",unit:"sprigs"},
      {name:"Bay leaves",qty:"2",unit:""},
      {name:"Beef stock",qty:"300",unit:"ml"},
      {name:"Butter",qty:"30",unit:"g"}
  ],
  steps:"1. Brown beef cubes in batches, set aside.\n2. Fry lardons, add pearl onions, mushrooms and carrot.\n3. Add garlic, tomato pur\u00e9e, wine, stock and herbs.\n4. Return beef, cover and braise at 160\u00b0C for 2.5 hrs.\n5. Strain sauce if desired, reduce slightly.\n6. Serve with crusty bread or mashed potato."
},
{
  id:'c_fr_2',
  name:"Coq au Vin",
  category:"Meat",
  country:"France",
  serves:"4",
  desc:"Classic French chicken braised in red wine with mushrooms and herbs.",
  cookTime:90,
  onePot:true,
  calories:560,
  ingredients:[
      {name:"Chicken pieces",qty:"1.2",unit:"kg"},
      {name:"Red wine",qty:"500",unit:"ml"},
      {name:"Lardons",qty:"100",unit:"g"},
      {name:"Button mushrooms",qty:"200",unit:"g"},
      {name:"Pearl onions",qty:"150",unit:"g"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Chicken stock",qty:"200",unit:"ml"},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"},
      {name:"Thyme",qty:"2",unit:"sprigs"},
      {name:"Bay leaf",qty:"1",unit:""},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Flour",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Brown chicken pieces in butter. Set aside.\n2. Fry lardons, add mushrooms and pearl onions.\n3. Add garlic, flour, wine, stock, tomato pur\u00e9e and herbs.\n4. Return chicken, cover and simmer 45 mins.\n5. Remove chicken, reduce sauce until thick.\n6. Return chicken, serve with crusty bread or tagliatelle."
},
{
  id:'c_fr_3',
  name:"Bouillabaisse",
  category:"Fish",
  country:"France",
  serves:"6",
  desc:"Marseille's iconic saffron-scented fish stew with rouille on toast.",
  cookTime:60,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Mixed white fish",qty:"600",unit:"g"},
      {name:"Mussels",qty:"400",unit:"g"},
      {name:"Prawns",qty:"300",unit:"g"},
      {name:"Tomatoes",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Fennel",qty:"1",unit:"bulb"},
      {name:"Garlic",qty:"5",unit:"cloves"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"White wine",qty:"200",unit:"ml"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Baguette",qty:"1",unit:""},
      {name:"Mayonnaise",qty:"100",unit:"ml"}
  ],
  steps:"1. Saut\u00e9 onion, fennel and garlic in oil until soft.\n2. Add tomatoes, wine and saffron, simmer 15 mins.\n3. Add fish stock or water, bring to vigorous boil.\n4. Add fish, mussels and prawns, cook 8 mins.\n5. Mix saffron and garlic into mayo for rouille.\n6. Serve stew in bowls with rouille-topped toast floating on top."
},
{
  id:'c_fr_4',
  name:"Cassoulet",
  category:"Meat",
  country:"France",
  serves:"6",
  desc:"Rich, hearty white bean and meat casserole from the Languedoc.",
  cookTime:180,
  onePot:true,
  calories:740,
  ingredients:[
      {name:"White haricot beans",qty:"500",unit:"g"},
      {name:"Pork sausages",qty:"400",unit:"g"},
      {name:"Pork belly",qty:"300",unit:"g"},
      {name:"Duck confit legs",qty:"2",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Chicken stock",qty:"500",unit:"ml"},
      {name:"Thyme",qty:"3",unit:"sprigs"},
      {name:"Bay leaves",qty:"2",unit:""},
      {name:"Breadcrumbs",qty:"50",unit:"g"}
  ],
  steps:"1. Soak beans overnight, drain.\n2. Fry sausages and pork belly until browned.\n3. Layer beans, meats, garlic, tomatoes, herbs and stock in a deep casserole.\n4. Top with breadcrumbs.\n5. Bake at 160\u00b0C for 2.5 hrs, pressing crust down twice.\n6. Serve directly from the pot."
},
{
  id:'c_fr_5',
  name:"Ratatouille",
  category:"Vegetarian",
  country:"France",
  serves:"4",
  desc:"Proven\u00e7al roasted summer vegetable stew \u2014 a celebration of the Mediterranean garden.",
  cookTime:60,
  onePot:true,
  calories:280,
  ingredients:[
      {name:"Aubergine",qty:"1",unit:""},
      {name:"Courgette",qty:"2",unit:""},
      {name:"Red pepper",qty:"2",unit:""},
      {name:"Yellow pepper",qty:"1",unit:""},
      {name:"Tomatoes",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Thyme",qty:"3",unit:"sprigs"},
      {name:"Basil",qty:"1",unit:"handful"}
  ],
  steps:"1. Dice all vegetables roughly.\n2. Roast aubergine and peppers at 200\u00b0C for 20 mins.\n3. Soften onion and garlic in oil in a large pan.\n4. Add tomatoes and herbs, simmer 10 mins.\n5. Add all roasted veg, cook together 20 mins.\n6. Finish with fresh basil and a generous glug of olive oil."
},
{
  id:'c_es_1',
  name:"Paella Valenciana",
  category:"Asian",
  country:"Spain",
  serves:"4",
  desc:"The original paella \u2014 rabbit, chicken and green beans in saffron-scented rice over fire.",
  cookTime:60,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Paella rice",qty:"320",unit:"g"},
      {name:"Chicken thighs",qty:"4",unit:""},
      {name:"Rabbit pieces",qty:"300",unit:"g"},
      {name:"Runner beans",qty:"150",unit:"g"},
      {name:"Butter beans",qty:"100",unit:"g"},
      {name:"Tomatoes",qty:"2",unit:""},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Smoked paprika",qty:"1",unit:"tsp"},
      {name:"Chicken stock",qty:"900",unit:"ml"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"}
  ],
  steps:"1. Fry chicken and rabbit in oil until golden.\n2. Add beans and tomatoes, cook down.\n3. Add paprika and rice, stir to coat.\n4. Pour in saffron-infused stock.\n5. Cook on medium without stirring 18 mins until socarrat forms on bottom.\n6. Rest 5 mins before serving."
},
{
  id:'c_es_2',
  name:"Cocido Madrile\u00f1o",
  category:"Soup",
  country:"Spain",
  serves:"6",
  desc:"Madrid's famous chickpea and meat stew served across two courses.",
  cookTime:180,
  onePot:true,
  calories:680,
  ingredients:[
      {name:"Chickpeas",qty:"400",unit:"g"},
      {name:"Beef brisket",qty:"400",unit:"g"},
      {name:"Pork belly",qty:"200",unit:"g"},
      {name:"Chorizo",qty:"200",unit:"g"},
      {name:"Morcilla",qty:"150",unit:"g"},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Potato",qty:"2",unit:""},
      {name:"Cabbage",qty:"0.5",unit:"head"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Onion",qty:"1",unit:""}
  ],
  steps:"1. Soak chickpeas overnight.\n2. Cover meats with water, bring to boil, skim.\n3. Add chickpeas, carrot, potato and garlic, simmer 1.5 hrs.\n4. Add chorizo and morcilla, cook 30 more mins.\n5. Add cabbage, cook 15 mins.\n6. Serve broth as first course, meats and veg as second."
},
{
  id:'c_es_3',
  name:"Gambas al Ajillo",
  category:"Fish",
  country:"Spain",
  serves:"4",
  desc:"Sizzling garlic prawns in olive oil with chilli and dry sherry \u2014 Spain's most irresistible tapa.",
  cookTime:15,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Raw king prawns",qty:"500",unit:"g"},
      {name:"Garlic",qty:"8",unit:"cloves"},
      {name:"Dried chilli",qty:"2",unit:""},
      {name:"Dry sherry",qty:"3",unit:"tbsp"},
      {name:"Olive oil",qty:"100",unit:"ml"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Crusty bread",qty:"1",unit:"loaf"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Heat olive oil in a clay dish or heavy pan.\n2. Add sliced garlic and chilli, fry 1 min until fragrant.\n3. Add prawns, cook 2 mins until pink.\n4. Splash in sherry, cook 1 more min.\n5. Season well, scatter with parsley.\n6. Serve immediately in the pan with crusty bread."
},
{
  id:'c_es_4',
  name:"Fabada Asturiana",
  category:"Meat",
  country:"Spain",
  serves:"6",
  desc:"Asturian white bean and smoked pork stew \u2014 warming and deeply savoury.",
  cookTime:120,
  onePot:true,
  calories:640,
  ingredients:[
      {name:"Large white fabes beans",qty:"500",unit:"g"},
      {name:"Morcilla",qty:"200",unit:"g"},
      {name:"Chorizo",qty:"200",unit:"g"},
      {name:"Smoked bacon",qty:"200",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Smoked paprika",qty:"1",unit:"tsp"},
      {name:"Bay leaves",qty:"2",unit:""}
  ],
  steps:"1. Soak beans overnight, drain.\n2. Place beans, meats and aromatics in pot with cold water.\n3. Bring slowly to a simmer over medium heat.\n4. Skim foam, add saffron and paprika.\n5. Cook on very low heat 1.5\u20132 hrs until beans are tender.\n6. Adjust seasoning and serve with crusty bread."
},
{
  id:'c_es_5',
  name:"Tortilla Espa\u00f1ola",
  category:"Vegetarian",
  country:"Spain",
  serves:"4",
  desc:"The iconic Spanish potato omelette \u2014 simple, satisfying and perfect hot or cold.",
  cookTime:35,
  onePot:true,
  calories:420,
  ingredients:[
      {name:"Potatoes",qty:"600",unit:"g"},
      {name:"Eggs",qty:"6",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Olive oil",qty:"200",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Peel and thinly slice potatoes and onion.\n2. Confit slowly in olive oil 20 mins until tender.\n3. Drain, cool slightly. Beat eggs in a bowl.\n4. Combine potatoes with eggs, season generously.\n5. Pour into an oiled non-stick pan on medium heat.\n6. Cook 4 mins, flip onto a plate and slide back to cook other side 3 mins."
},
{
  id:'c_th_1',
  name:"Pad Thai",
  category:"Asian",
  country:"Thailand",
  serves:"4",
  desc:"Thailand's national noodle dish \u2014 rice noodles stir-fried with egg, prawns and tamarind sauce.",
  cookTime:30,
  onePot:true,
  calories:540,
  ingredients:[
      {name:"Rice noodles",qty:"300",unit:"g"},
      {name:"King prawns",qty:"300",unit:"g"},
      {name:"Eggs",qty:"3",unit:""},
      {name:"Bean sprouts",qty:"150",unit:"g"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Tofu",qty:"150",unit:"g"},
      {name:"Tamarind paste",qty:"3",unit:"tbsp"},
      {name:"Fish sauce",qty:"3",unit:"tbsp"},
      {name:"Palm sugar",qty:"2",unit:"tbsp"},
      {name:"Peanuts",qty:"50",unit:"g"},
      {name:"Lime",qty:"2",unit:""}
  ],
  steps:"1. Soak rice noodles in cold water 30 mins.\n2. Mix tamarind, fish sauce and sugar for sauce.\n3. Stir fry garlic and tofu in very hot wok.\n4. Add prawns, then push aside and scramble eggs.\n5. Add noodles and sauce, toss together.\n6. Serve with bean sprouts, peanuts, spring onions and lime."
},
{
  id:'c_th_2',
  name:"Massaman Curry",
  category:"Curry",
  country:"Thailand",
  serves:"4",
  desc:"Rich, mild curry with potato, peanuts and aromatic spices \u2014 influenced by Persian traders.",
  cookTime:60,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Chicken thighs",qty:"700",unit:"g"},
      {name:"Massaman curry paste",qty:"4",unit:"tbsp"},
      {name:"Coconut milk",qty:"400",unit:"ml"},
      {name:"Potato",qty:"2",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Peanuts",qty:"60",unit:"g"},
      {name:"Fish sauce",qty:"2",unit:"tbsp"},
      {name:"Palm sugar",qty:"1",unit:"tbsp"},
      {name:"Tamarind paste",qty:"1",unit:"tbsp"},
      {name:"Cardamom",qty:"3",unit:"pods"},
      {name:"Cinnamon stick",qty:"1",unit:""}
  ],
  steps:"1. Fry curry paste in oil 2 mins.\n2. Add coconut milk and bring to simmer.\n3. Add chicken, potatoes and onion.\n4. Add peanuts, cardamom, cinnamon, fish sauce and sugar.\n5. Simmer 40 mins until chicken is tender.\n6. Stir in tamarind, serve with jasmine rice."
},
{
  id:'c_th_3',
  name:"Tom Yum Goong",
  category:"Soup",
  country:"Thailand",
  serves:"4",
  desc:"Hot and sour prawn soup with lemongrass, lime leaves and galangal.",
  cookTime:25,
  onePot:true,
  calories:180,
  ingredients:[
      {name:"King prawns",qty:"400",unit:"g"},
      {name:"Lemongrass",qty:"3",unit:"stalks"},
      {name:"Galangal",qty:"4",unit:"slices"},
      {name:"Lime leaves",qty:"6",unit:""},
      {name:"Mushrooms",qty:"150",unit:"g"},
      {name:"Fish sauce",qty:"3",unit:"tbsp"},
      {name:"Lime juice",qty:"3",unit:"tbsp"},
      {name:"Fresh chilli",qty:"3",unit:""},
      {name:"Coriander",qty:"1",unit:"handful"},
      {name:"Chicken stock",qty:"1",unit:"l"}
  ],
  steps:"1. Bruise lemongrass and simmer in stock 5 mins with galangal and lime leaves.\n2. Add mushrooms and chilli, cook 5 mins.\n3. Add prawns, cook 3 mins.\n4. Season with fish sauce and lime juice.\n5. Taste \u2014 should be hot, sour, salty, fragrant.\n6. Serve with rice and coriander."
},
{
  id:'c_th_4',
  name:"Som Tam",
  category:"Salad",
  country:"Thailand",
  serves:"4",
  desc:"Green papaya salad with peanuts, dried shrimp and a tongue-tingling dressing.",
  cookTime:15,
  onePot:true,
  calories:220,
  ingredients:[
      {name:"Green papaya",qty:"400",unit:"g"},
      {name:"Cherry tomatoes",qty:"100",unit:"g"},
      {name:"Long beans",qty:"50",unit:"g"},
      {name:"Dried shrimp",qty:"2",unit:"tbsp"},
      {name:"Peanuts",qty:"40",unit:"g"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Birds eye chilli",qty:"2",unit:""},
      {name:"Fish sauce",qty:"2",unit:"tbsp"},
      {name:"Lime juice",qty:"3",unit:"tbsp"},
      {name:"Palm sugar",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Pound garlic and chilli in pestle and mortar.\n2. Add long beans, pound lightly.\n3. Add papaya, pound to bruise (not mush).\n4. Add tomatoes, shrimp, peanuts.\n5. Season with fish sauce, lime and sugar.\n6. Mix and serve immediately."
},
{
  id:'c_th_5',
  name:"Khao Pad",
  category:"Asian",
  country:"Thailand",
  serves:"4",
  desc:"Simple Thai fried rice with egg, vegetables and fish sauce \u2014 endlessly satisfying.",
  cookTime:20,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Cooked jasmine rice",qty:"600",unit:"g"},
      {name:"Eggs",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Fish sauce",qty:"3",unit:"tbsp"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Cucumber",qty:"0.5",unit:""},
      {name:"Lime",qty:"2",unit:""}
  ],
  steps:"1. Heat wok until smoking, add oil.\n2. Fry garlic 30 secs, add onion.\n3. Push to side, scramble eggs.\n4. Add cold rice, stir-fry on high heat.\n5. Season with fish sauce and soy.\n6. Serve with cucumber, spring onions and lime wedges."
},
{
  id:'c_gr_1',
  name:"Moussaka",
  category:"Meat",
  country:"Greece",
  serves:"6",
  desc:"Layered aubergine, spiced lamb and b\u00e9chamel \u2014 the crown jewel of Greek cooking.",
  cookTime:90,
  onePot:false,
  calories:620,
  ingredients:[
      {name:"Aubergine",qty:"3",unit:""},
      {name:"Lamb mince",qty:"600",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Red wine",qty:"150",unit:"ml"},
      {name:"Cinnamon",qty:"1",unit:"tsp"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Plain flour",qty:"50",unit:"g"},
      {name:"Milk",qty:"500",unit:"ml"},
      {name:"Egg yolks",qty:"2",unit:""},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"},
      {name:"Parmesan",qty:"50",unit:"g"}
  ],
  steps:"1. Slice and salt aubergine, fry until golden.\n2. Brown lamb with onion, garlic, cinnamon and wine. Add tomatoes.\n3. Make b\u00e9chamel: melt butter, add flour, gradually whisk in milk until thick. Add yolks and nutmeg.\n4. Layer aubergine, meat sauce, aubergine again in dish.\n5. Pour b\u00e9chamel over, sprinkle with Parmesan.\n6. Bake at 180\u00b0C for 45 mins."
},
{
  id:'c_gr_2',
  name:"Pastitsio",
  category:"Pasta",
  country:"Greece",
  serves:"6",
  desc:"Greek baked pasta with meat sauce and creamy b\u00e9chamel \u2014 comfort food at its finest.",
  cookTime:80,
  onePot:false,
  calories:640,
  ingredients:[
      {name:"Penne",qty:"400",unit:"g"},
      {name:"Beef mince",qty:"500",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Cinnamon",qty:"1",unit:"tsp"},
      {name:"Red wine",qty:"150",unit:"ml"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Plain flour",qty:"50",unit:"g"},
      {name:"Milk",qty:"500",unit:"ml"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"},
      {name:"Parmesan",qty:"80",unit:"g"}
  ],
  steps:"1. Cook pasta al dente, drain.\n2. Brown mince with onion, wine, tomatoes and cinnamon.\n3. Make b\u00e9chamel, mix half with pasta.\n4. Layer pasta, meat sauce, remaining pasta in greased dish.\n5. Pour remaining b\u00e9chamel over, top with Parmesan.\n6. Bake at 180\u00b0C for 40 mins."
},
{
  id:'c_gr_3',
  name:"Kleftiko",
  category:"Meat",
  country:"Greece",
  serves:"4",
  desc:"Slow-roasted lamb with lemon, garlic and oregano wrapped in parchment.",
  cookTime:180,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Lamb shoulder",qty:"1.2",unit:"kg"},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Lemon",qty:"2",unit:""},
      {name:"Dried oregano",qty:"2",unit:"tsp"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Potatoes",qty:"4",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Feta",qty:"100",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Pepper",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cut slits in lamb, stuff with garlic and lemon zest.\n2. Rub with oil, oregano, salt and pepper.\n3. Place on parchment with potatoes, tomatoes and remaining lemon.\n4. Wrap tightly in parchment and foil.\n5. Roast at 160\u00b0C for 3 hours.\n6. Open package, add feta and roast uncovered 20 mins more."
},
{
  id:'c_gr_4',
  name:"Spanakopita",
  category:"Vegetarian",
  country:"Greece",
  serves:"6",
  desc:"Flaky filo pastry filled with spinach and feta \u2014 a beloved Greek classic.",
  cookTime:60,
  onePot:false,
  calories:380,
  ingredients:[
      {name:"Spinach",qty:"500",unit:"g"},
      {name:"Feta",qty:"300",unit:"g"},
      {name:"Eggs",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Filo pastry",qty:"8",unit:"sheets"},
      {name:"Butter",qty:"80",unit:"g"},
      {name:"Dill",qty:"1",unit:"handful"},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"}
  ],
  steps:"1. Wilt spinach, squeeze dry, chop.\n2. Mix with crumbled feta, eggs, onion, dill and nutmeg.\n3. Brush filo sheets with melted butter, layer in baking dish.\n4. Add filling, fold over edges, top with more buttered filo.\n5. Score top, brush with butter.\n6. Bake at 180\u00b0C for 45 mins until golden."
},
{
  id:'c_gr_5',
  name:"Fasolada",
  category:"Soup",
  country:"Greece",
  serves:"4",
  desc:"The national bean soup \u2014 simple white beans simmered with olive oil, carrot and celery.",
  cookTime:60,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Cannellini beans",qty:"400",unit:"g"},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Olive oil",qty:"6",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Soak beans overnight if dried, or use tinned.\n2. Saut\u00e9 onion, carrot, celery and garlic in oil.\n3. Add tomatoes, beans and enough water to cover.\n4. Simmer 60 mins until beans are very tender.\n5. Season generously with salt and pepper.\n6. Finish with a generous pour of good olive oil and parsley."
},
{
  id:'c_ma_1',
  name:"Lamb Tagine",
  category:"Meat",
  country:"Morocco",
  serves:"4",
  desc:"Slow-braised lamb with dried apricots, almonds and warm Moroccan spices.",
  cookTime:90,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Lamb shoulder",qty:"700",unit:"g"},
      {name:"Dried apricots",qty:"100",unit:"g"},
      {name:"Blanched almonds",qty:"60",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Cinnamon",qty:"1",unit:"tsp"},
      {name:"Ras el hanout",qty:"2",unit:"tsp"},
      {name:"Chicken stock",qty:"300",unit:"ml"},
      {name:"Honey",qty:"1",unit:"tbsp"},
      {name:"Olive oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Brown lamb in oil.\n2. Add onion, garlic and all spices, cook 3 mins.\n3. Add stock, apricots and honey.\n4. Cover and cook on low heat 1.5 hrs until tender.\n5. Toast almonds and scatter over.\n6. Serve with couscous."
},
{
  id:'c_ma_2',
  name:"Chicken Bastilla",
  category:"Meat",
  country:"Morocco",
  serves:"6",
  desc:"Sweet-savoury pigeon (or chicken) pie in crispy warka pastry with cinnamon sugar.",
  cookTime:90,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Chicken thighs",qty:"800",unit:"g"},
      {name:"Filo pastry",qty:"8",unit:"sheets"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Cinnamon",qty:"2",unit:"tsp"},
      {name:"Icing sugar",qty:"2",unit:"tbsp"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Almonds",qty:"100",unit:"g"},
      {name:"Butter",qty:"80",unit:"g"},
      {name:"Coriander",qty:"1",unit:"handful"}
  ],
  steps:"1. Braise chicken with onion, garlic, ginger and saffron until tender. Shred.\n2. Reduce cooking liquid, scramble eggs in it.\n3. Toast and crush almonds with half the cinnamon and sugar.\n4. Layer buttered filo in dish, fill with chicken, eggs and almond layers.\n5. Wrap and seal with more buttered filo.\n6. Bake at 190\u00b0C 30 mins, dust with icing sugar and remaining cinnamon."
},
{
  id:'c_ma_3',
  name:"Harira",
  category:"Soup",
  country:"Morocco",
  serves:"6",
  desc:"The classic Moroccan tomato, lentil and chickpea soup \u2014 traditionally eaten to break the Ramadan fast.",
  cookTime:60,
  onePot:true,
  calories:360,
  ingredients:[
      {name:"Chickpeas",qty:"200",unit:"g"},
      {name:"Red lentils",qty:"100",unit:"g"},
      {name:"Tomatoes",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Coriander",qty:"1",unit:"bunch"},
      {name:"Parsley",qty:"1",unit:"bunch"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Lemon",qty:"1",unit:""},
      {name:"Vermicelli",qty:"50",unit:"g"}
  ],
  steps:"1. Saut\u00e9 onion and celery, add ginger and cinnamon.\n2. Add tomatoes, pur\u00e9e, saffron and 1.5l water.\n3. Add chickpeas and lentils, simmer 30 mins.\n4. Add vermicelli, cook 5 more mins.\n5. Stir in coriander and parsley.\n6. Finish with lemon juice and serve with dates."
},
{
  id:'c_ma_4',
  name:"Mechoui",
  category:"Meat",
  country:"Morocco",
  serves:"6",
  desc:"Whole slow-roasted lamb rubbed with cumin, coriander and butter \u2014 a festive centrepiece.",
  cookTime:240,
  onePot:false,
  calories:780,
  ingredients:[
      {name:"Leg of lamb",qty:"2",unit:"kg"},
      {name:"Butter",qty:"100",unit:"g"},
      {name:"Cumin",qty:"2",unit:"tbsp"},
      {name:"Coriander",qty:"2",unit:"tsp"},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Salt",qty:"1",unit:"tbsp"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Olive oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Score lamb deeply all over.\n2. Blend butter, garlic and spices into a paste.\n3. Rub paste all over and into incisions.\n4. Marinate overnight in fridge.\n5. Roast at 140\u00b0C for 3.5\u20134 hrs, basting every hour.\n6. Rest 20 mins, serve with flatbread and cumin salt."
},
{
  id:'c_ma_5',
  name:"Zaalouk",
  category:"Vegetarian",
  country:"Morocco",
  serves:"4",
  desc:"Roasted aubergine and tomato salad cooked with Moroccan spices \u2014 served warm as a starter or side.",
  cookTime:30,
  onePot:true,
  calories:220,
  ingredients:[
      {name:"Aubergine",qty:"2",unit:""},
      {name:"Tomatoes",qty:"4",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Lemon juice",qty:"1",unit:"tbsp"},
      {name:"Coriander leaf",qty:"1",unit:"handful"},
      {name:"Parsley",qty:"1",unit:"handful"}
  ],
  steps:"1. Roast aubergines whole at 200\u00b0C until collapsed.\n2. Peel, chop flesh roughly.\n3. Fry garlic with all spices in oil.\n4. Add chopped tomatoes, cook down 15 mins.\n5. Add aubergine, mix and cook together 10 mins.\n6. Finish with lemon, coriander and parsley. Serve with flatbread."
},
{
  id:'c_pe_1',
  name:"Lomo Saltado",
  category:"Meat",
  country:"Peru",
  serves:"4",
  desc:"Peruvian stir-fried beef with tomatoes, peppers and soy sauce \u2014 a fusion of Chinese and Andean.",
  cookTime:30,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Beef sirloin",qty:"600",unit:"g"},
      {name:"Red onion",qty:"2",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Yellow pepper",qty:"1",unit:""},
      {name:"Soy sauce",qty:"3",unit:"tbsp"},
      {name:"Red wine vinegar",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Chilli paste (aji amarillo)",qty:"1",unit:"tbsp"},
      {name:"Chips/fries",qty:"500",unit:"g"},
      {name:"Coriander",qty:"1",unit:"handful"}
  ],
  steps:"1. Marinate beef strips in soy, vinegar, cumin and garlic.\n2. Stir fry beef on very high heat, set aside.\n3. Fry onion, pepper and tomatoes on high heat briefly.\n4. Return beef, add aji amarillo paste, toss everything.\n5. Serve immediately over fries with rice.\n6. Scatter with coriander."
},
{
  id:'c_pe_2',
  name:"Aji de Gallina",
  category:"Meat",
  country:"Peru",
  serves:"4",
  desc:"Shredded chicken in a rich, creamy aj\u00ed amarillo and walnut sauce.",
  cookTime:50,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Chicken breast",qty:"600",unit:"g"},
      {name:"Aji amarillo paste",qty:"3",unit:"tbsp"},
      {name:"White bread",qty:"4",unit:"slices"},
      {name:"Walnuts",qty:"60",unit:"g"},
      {name:"Parmesan",qty:"50",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Chicken stock",qty:"300",unit:"ml"},
      {name:"Evaporated milk",qty:"100",unit:"ml"},
      {name:"Potatoes",qty:"4",unit:""},
      {name:"Eggs",qty:"4",unit:""}
  ],
  steps:"1. Poach chicken in stock, shred. Reserve stock.\n2. Soak bread in evaporated milk.\n3. Fry onion and garlic, add aji amarillo.\n4. Blend with soaked bread, walnuts and stock.\n5. Return to pan, add shredded chicken and Parmesan.\n6. Serve over boiled potatoes with hard-boiled egg and black olives."
},
{
  id:'c_pe_3',
  name:"Ceviche Peruano",
  category:"Fish",
  country:"Peru",
  serves:"4",
  desc:"The king of ceviches \u2014 raw fish cured in tiger's milk with aji amarillo and red onion.",
  cookTime:20,
  onePot:true,
  calories:240,
  ingredients:[
      {name:"Firm white fish",qty:"600",unit:"g"},
      {name:"Lime juice",qty:"200",unit:"ml"},
      {name:"Red onion",qty:"2",unit:""},
      {name:"Aji amarillo",qty:"2",unit:""},
      {name:"Coriander",qty:"1",unit:"handful"},
      {name:"Garlic",qty:"1",unit:"clove"},
      {name:"Ginger",qty:"0.5",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Sweet potato",qty:"2",unit:""},
      {name:"Corn on the cob",qty:"2",unit:""}
  ],
  steps:"1. Cut fish into cubes. Season with salt.\n2. Blend lime juice, garlic, ginger and one aji for tiger's milk.\n3. Mix fish with tiger's milk for exactly 3 mins (no more).\n4. Add thinly sliced red onion, remaining chopped aji and coriander.\n5. Serve immediately with boiled sweet potato and corn."
},
{
  id:'c_pe_4',
  name:"Carapulcra",
  category:"Meat",
  country:"Peru",
  serves:"6",
  desc:"Ancient Andean freeze-dried potato stew with pork and peanuts \u2014 one of Peru's oldest dishes.",
  cookTime:90,
  onePot:true,
  calories:560,
  ingredients:[
      {name:"Freeze-dried potato (papas secas)",qty:"300",unit:"g"},
      {name:"Pork shoulder",qty:"500",unit:"g"},
      {name:"Peanuts",qty:"80",unit:"g"},
      {name:"Aji panca paste",qty:"3",unit:"tbsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Chicken stock",qty:"500",unit:"ml"},
      {name:"Red wine",qty:"150",unit:"ml"},
      {name:"Dark chocolate",qty:"20",unit:"g"}
  ],
  steps:"1. Soak freeze-dried potato in water 30 mins.\n2. Brown pork with onion, garlic and aji panca.\n3. Add wine, stock and drained potato.\n4. Add crushed peanuts and chocolate.\n5. Simmer 1 hour on low, stirring to prevent sticking.\n6. Serve with rice."
},
{
  id:'c_pe_5',
  name:"Seco de Res",
  category:"Meat",
  country:"Peru",
  serves:"4",
  desc:"Peruvian beef stew with chicha de jora (corn beer), coriander and aji verde.",
  cookTime:60,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Beef chuck",qty:"700",unit:"g"},
      {name:"Chicha de jora or light beer",qty:"300",unit:"ml"},
      {name:"Coriander",qty:"2",unit:"bunches"},
      {name:"Aji amarillo paste",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Peas",qty:"100",unit:"g"},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Potato",qty:"2",unit:""},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Brown beef in oil.\n2. Blend coriander with chicha for green sauce.\n3. Fry onion, garlic, aji amarillo and cumin.\n4. Add beef, coriander-chicha sauce, carrots and potatoes.\n5. Simmer 45 mins until tender.\n6. Add peas at end. Serve with white rice and beans."
},
{
  id:'c_tr_1',
  name:"\u0130skender Kebap",
  category:"Meat",
  country:"Turkey",
  serves:"4",
  desc:"Thin slices of d\u00f6ner-style lamb over pita with yoghurt and tomato butter sauce \u2014 a Bursa icon.",
  cookTime:40,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Lamb mince",qty:"600",unit:"g"},
      {name:"Pita bread",qty:"4",unit:""},
      {name:"Yoghurt",qty:"300",unit:"ml"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Dried oregano",qty:"1",unit:"tsp"}
  ],
  steps:"1. Mix mince with garlic, cumin and paprika. Form into flat patties.\n2. Grill or pan-fry until charred, slice thinly.\n3. Fry chopped tomatoes in butter until saucy.\n4. Tear pita and place in serving bowl.\n5. Top with yoghurt, then meat, then hot tomato butter.\n6. Serve immediately with pickled chillies."
},
{
  id:'c_tr_2',
  name:"Karn\u0131yar\u0131k",
  category:"Vegetarian",
  country:"Turkey",
  serves:"4",
  desc:"Split aubergine stuffed with spiced minced lamb and tomatoes \u2014 literally \"split belly\".",
  cookTime:55,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Aubergine",qty:"4",unit:""},
      {name:"Lamb mince",qty:"400",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Green pepper",qty:"2",unit:""},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Vegetable oil",qty:"100",unit:"ml"},
      {name:"Sugar",qty:"1",unit:"tsp"}
  ],
  steps:"1. Fry aubergines whole in oil until softened. Split lengthwise.\n2. Brown lamb with onion, garlic and pepper.\n3. Add chopped tomatoes, pur\u00e9e and sugar. Season.\n4. Fill split aubergines with lamb mixture.\n5. Place in baking dish, add sliced tomato on top.\n6. Bake at 180\u00b0C for 30 mins."
},
{
  id:'c_tr_3',
  name:"Mercimek \u00c7orbas\u0131",
  category:"Soup",
  country:"Turkey",
  serves:"4",
  desc:"Velvety Turkish red lentil soup with cumin and a brown butter drizzle.",
  cookTime:30,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Red lentils",qty:"250",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Potato",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Cumin",qty:"2",unit:"tsp"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Vegetable stock",qty:"1.2",unit:"l"},
      {name:"Lemon",qty:"1",unit:""}
  ],
  steps:"1. Saut\u00e9 onion, carrot and potato in oil.\n2. Add garlic, lentils, cumin and stock.\n3. Simmer 25 mins until lentils collapse.\n4. Blend until smooth. Season and add lemon juice.\n5. In separate pan, melt butter, add paprika.\n6. Ladle soup, drizzle with paprika butter."
},
{
  id:'c_tr_4',
  name:"H\u00fcnk\u00e2r Be\u011fendi",
  category:"Meat",
  country:"Turkey",
  serves:"4",
  desc:"Slow-cooked lamb stew served over smoky aubergine and b\u00e9chamel \u2014 the Sultan's delight.",
  cookTime:80,
  onePot:false,
  calories:620,
  ingredients:[
      {name:"Lamb shoulder",qty:"600",unit:"g"},
      {name:"Aubergine",qty:"3",unit:""},
      {name:"Butter",qty:"40",unit:"g"},
      {name:"Plain flour",qty:"3",unit:"tbsp"},
      {name:"Milk",qty:"300",unit:"ml"},
      {name:"Parmesan",qty:"40",unit:"g"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Paprika",qty:"1",unit:"tsp"}
  ],
  steps:"1. Brown lamb with onion, garlic and paprika.\n2. Add tomatoes, cook stew 60 mins until tender.\n3. Char aubergines over flame, peel and mash flesh.\n4. Make b\u00e9chamel with butter and flour, add milk.\n5. Mix in aubergine and Parmesan for the \"be\u011fendi\".\n6. Plate be\u011fendi, top with lamb stew."
},
{
  id:'c_tr_5',
  name:"Kuzu G\u00fcve\u00e7",
  category:"Meat",
  country:"Turkey",
  serves:"4",
  desc:"Slow-baked lamb and vegetable casserole in an earthenware pot.",
  cookTime:90,
  onePot:true,
  calories:540,
  ingredients:[
      {name:"Lamb pieces",qty:"700",unit:"g"},
      {name:"Potato",qty:"3",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Courgette",qty:"2",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Green pepper",qty:"2",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Dried thyme",qty:"1",unit:"tsp"},
      {name:"Paprika",qty:"1",unit:"tsp"}
  ],
  steps:"1. Brown lamb in oil.\n2. Chop all vegetables into large pieces.\n3. Layer vegetables and lamb in an earthenware casserole.\n4. Mix tomato pur\u00e9e with 200ml water, spices and oil, pour over.\n5. Cover with foil and bake at 170\u00b0C for 1.5 hrs.\n6. Uncover last 20 mins to brown top."
},
{
  id:'c_lb_1',
  name:"Kibbeh",
  category:"Meat",
  country:"Lebanon",
  serves:"6",
  desc:"Torpedo-shaped bulgur and lamb shells filled with spiced mince and pine nuts.",
  cookTime:60,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Fine bulgur",qty:"300",unit:"g"},
      {name:"Lamb mince",qty:"400",unit:"g"},
      {name:"Pine nuts",qty:"40",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Cinnamon",qty:"1",unit:"tsp"},
      {name:"Allspice",qty:"1",unit:"tsp"},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"},
      {name:"Vegetable oil",qty:"500",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Soak bulgur 20 mins, drain and squeeze.\n2. Mix with half the lamb, onion, cinnamon and allspice.\n3. Fry remaining lamb with onion, pine nuts and spices for filling.\n4. Shape bulgur-lamb mix into ovals, hollow, fill, seal.\n5. Deep fry at 170\u00b0C for 8 mins until golden.\n6. Serve with yoghurt dip."
},
{
  id:'c_lb_2',
  name:"Kafta bi Bandora",
  category:"Meat",
  country:"Lebanon",
  serves:"4",
  desc:"Spiced lamb meatballs baked in a rich tomato sauce \u2014 a Lebanese comfort classic.",
  cookTime:45,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Lamb mince",qty:"600",unit:"g"},
      {name:"Tomatoes",qty:"5",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Parsley",qty:"1",unit:"bunch"},
      {name:"Allspice",qty:"1",unit:"tsp"},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Cumin",qty:"0.5",unit:"tsp"},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"},
      {name:"Potato",qty:"3",unit:""},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Mix lamb with chopped parsley, onion and spices. Form into patties.\n2. Slice potatoes, par-cook in boiling water.\n3. Layer potatoes and sliced tomatoes in baking dish.\n4. Place kafta on top.\n5. Mix tomato pur\u00e9e with water and oil, pour over.\n6. Bake at 190\u00b0C for 35 mins."
},
{
  id:'c_lb_3',
  name:"Sayyadieh",
  category:"Fish",
  country:"Lebanon",
  serves:"4",
  desc:"Caramelised onion rice topped with spiced fried fish \u2014 a Lebanese fisherman's dish.",
  cookTime:50,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"White fish fillets",qty:"700",unit:"g"},
      {name:"Basmati rice",qty:"350",unit:"g"},
      {name:"Onion",qty:"3",unit:""},
      {name:"Cumin",qty:"2",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Turmeric",qty:"0.5",unit:"tsp"},
      {name:"Fish stock",qty:"700",unit:"ml"},
      {name:"Pine nuts",qty:"40",unit:"g"},
      {name:"Vegetable oil",qty:"4",unit:"tbsp"},
      {name:"Lemon",qty:"2",unit:""},
      {name:"Tahini sauce",qty:"4",unit:"tbsp"}
  ],
  steps:"1. Very slowly caramelise onions in oil 30 mins until deep brown.\n2. Season fish with spices, pan-fry 3 mins each side.\n3. Toast rice in onion oil with spices.\n4. Add fish stock, cook rice covered 18 mins.\n5. Plate rice, top with fried fish.\n6. Serve with toasted pine nuts, lemon and tahini."
},
{
  id:'c_lb_4',
  name:"Fatteh",
  category:"Vegetarian",
  country:"Lebanon",
  serves:"4",
  desc:"Layers of toasted pita, chickpeas and yoghurt with a warm tahini drizzle \u2014 a celebratory dish.",
  cookTime:35,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Pita bread",qty:"4",unit:""},
      {name:"Chickpeas",qty:"400",unit:"g"},
      {name:"Greek yoghurt",qty:"400",unit:"ml"},
      {name:"Tahini",qty:"3",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Lemon juice",qty:"3",unit:"tbsp"},
      {name:"Pine nuts",qty:"40",unit:"g"},
      {name:"Butter",qty:"20",unit:"g"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Parsley",qty:"1",unit:"handful"}
  ],
  steps:"1. Toast pita until crisp, break into pieces.\n2. Warm chickpeas in their liquid.\n3. Mix yoghurt with garlic, tahini and lemon.\n4. Brown pine nuts in butter.\n5. Layer pita, chickpeas, then yoghurt sauce.\n6. Drizzle with butter, pine nuts and paprika."
},
{
  id:'c_lb_5',
  name:"Mujaddara",
  category:"Vegetarian",
  country:"Lebanon",
  serves:"4",
  desc:"Lentils and rice topped with sweet fried onions \u2014 the ancient dish of Esau's biblical fame.",
  cookTime:40,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Brown lentils",qty:"200",unit:"g"},
      {name:"Basmati rice",qty:"150",unit:"g"},
      {name:"Onion",qty:"3",unit:""},
      {name:"Olive oil",qty:"6",unit:"tbsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Greek yoghurt",qty:"200",unit:"ml"}
  ],
  steps:"1. Cook lentils until just tender, 20 mins.\n2. Add rice to lentils, cook together 15 mins.\n3. Very slowly fry sliced onions in oil 25 mins until dark caramelised.\n4. Season lentil-rice with cumin, coriander and salt.\n5. Serve topped with lots of crispy caramelised onions.\n6. Accompany with cold yoghurt."
},
{
  id:'c_ng_1',
  name:"Jollof Rice",
  category:"Asian",
  country:"Nigeria",
  serves:"6",
  desc:"West Africa's most celebrated dish \u2014 smoky, tomato-based rice slow-cooked in one pot.",
  cookTime:60,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Long grain rice",qty:"400",unit:"g"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Red pepper",qty:"2",unit:""},
      {name:"Onion",qty:"2",unit:""},
      {name:"Scotch bonnet",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"3",unit:"tbsp"},
      {name:"Chicken stock",qty:"500",unit:"ml"},
      {name:"Vegetable oil",qty:"4",unit:"tbsp"},
      {name:"Curry powder",qty:"1",unit:"tsp"},
      {name:"Thyme",qty:"1",unit:"tsp"},
      {name:"Bay leaves",qty:"2",unit:""}
  ],
  steps:"1. Blend tomatoes, peppers and scotch bonnet into a pur\u00e9e.\n2. Fry onion in oil, add tomato pur\u00e9e and cook down 5 mins.\n3. Add blended mixture, fry on high heat 20 mins until paste-like.\n4. Add stock, spices and washed rice.\n5. Cover and cook on low heat 30 mins, do not lift lid.\n6. Fluff with fork, serve with fried chicken."
},
{
  id:'c_ng_2',
  name:"Egusi Soup",
  category:"Meat",
  country:"Nigeria",
  serves:"4",
  desc:"Hearty West African soup made from ground melon seeds, leafy greens and assorted meats.",
  cookTime:60,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Egusi seeds",qty:"150",unit:"g"},
      {name:"Goat or beef",qty:"400",unit:"g"},
      {name:"Smoked fish",qty:"100",unit:"g"},
      {name:"Palm oil",qty:"3",unit:"tbsp"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Scotch bonnet",qty:"1",unit:""},
      {name:"Spinach",qty:"200",unit:"g"},
      {name:"Crayfish powder",qty:"1",unit:"tbsp"},
      {name:"Stock cubes",qty:"2",unit:""},
      {name:"Tomatoes",qty:"2",unit:""}
  ],
  steps:"1. Brown meat with onion and stock cubes.\n2. Heat palm oil, add blended tomato and scotch bonnet.\n3. Fry tomato base 10 mins until oil separates.\n4. Add ground egusi, stir-fry 5 mins.\n5. Add meat, smoked fish, crayfish and water.\n6. Cook 20 mins, add spinach last 5 mins. Serve with pounded yam."
},
{
  id:'c_ng_3',
  name:"Pepper Soup",
  category:"Soup",
  country:"Nigeria",
  serves:"4",
  desc:"Fragrant spiced broth with goat meat and whole Cameroon peppers \u2014 restorative and warming.",
  cookTime:45,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Goat meat",qty:"600",unit:"g"},
      {name:"Pepper soup spice mix",qty:"2",unit:"tbsp"},
      {name:"Scotch bonnet",qty:"2",unit:""},
      {name:"Uziza leaves",qty:"1",unit:"handful"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Stock cubes",qty:"2",unit:""},
      {name:"Crayfish powder",qty:"1",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Water",qty:"1.5",unit:"l"}
  ],
  steps:"1. Wash and season meat with spice mix and stock cubes.\n2. Add water and bring to boil, skim.\n3. Add sliced scotch bonnet and onion.\n4. Simmer 35 mins until meat is tender.\n5. Add crayfish and uziza leaves.\n6. Adjust seasoning, serve very hot in bowls."
},
{
  id:'c_ng_4',
  name:"Ofe Onugbu",
  category:"Vegetarian",
  country:"Nigeria",
  serves:"4",
  desc:"Bitter leaf soup \u2014 a richly flavoured Igbo soup with cocoyam thickener and palm oil.",
  cookTime:60,
  onePot:true,
  calories:420,
  ingredients:[
      {name:"Bitter leaf",qty:"200",unit:"g"},
      {name:"Cocoyam",qty:"200",unit:"g"},
      {name:"Palm oil",qty:"3",unit:"tbsp"},
      {name:"Stockfish",qty:"100",unit:"g"},
      {name:"Smoked fish",qty:"100",unit:"g"},
      {name:"Crayfish powder",qty:"1",unit:"tbsp"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Scotch bonnet",qty:"1",unit:""},
      {name:"Stock cubes",qty:"2",unit:""}
  ],
  steps:"1. Wash and wring bitter leaf multiple times until less bitter.\n2. Boil cocoyam, mash to a smooth paste for thickening.\n3. Heat palm oil, add onion and scotch bonnet.\n4. Add stockfish, smoked fish and crayfish.\n5. Add cocoyam paste and water to desired consistency.\n6. Add bitter leaf, season and cook 15 mins."
},
{
  id:'c_ng_5',
  name:"Suya",
  category:"Meat",
  country:"Nigeria",
  serves:"4",
  desc:"Spiced skewered beef coated in groundnut powder and roasted over charcoal.",
  cookTime:30,
  onePot:false,
  calories:420,
  ingredients:[
      {name:"Beef sirloin",qty:"600",unit:"g"},
      {name:"Groundnut powder",qty:"80",unit:"g"},
      {name:"Yaji spice mix",qty:"3",unit:"tbsp"},
      {name:"Ginger powder",qty:"1",unit:"tsp"},
      {name:"Garlic powder",qty:"1",unit:"tsp"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomatoes",qty:"2",unit:""}
  ],
  steps:"1. Slice beef thinly and flatten slightly.\n2. Mix groundnut powder with yaji, ginger, garlic and paprika.\n3. Coat beef thoroughly in spice mixture with oil.\n4. Thread onto skewers.\n5. Grill over high heat 3\u20134 mins each side.\n6. Serve with sliced raw onion and tomatoes."
},
{
  id:'c_kr_1',
  name:"Bibimbap",
  category:"Asian",
  country:"Korea",
  serves:"4",
  desc:"Korean mixed rice bowl topped with saut\u00e9ed vegetables, gochujang and a fried egg.",
  cookTime:35,
  onePot:false,
  calories:520,
  ingredients:[
      {name:"Steamed rice",qty:"400",unit:"g"},
      {name:"Beef mince",qty:"200",unit:"g"},
      {name:"Spinach",qty:"150",unit:"g"},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Courgette",qty:"1",unit:""},
      {name:"Bean sprouts",qty:"100",unit:"g"},
      {name:"Mushrooms",qty:"100",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Gochujang",qty:"3",unit:"tbsp"},
      {name:"Sesame oil",qty:"2",unit:"tbsp"},
      {name:"Soy sauce",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"2",unit:"cloves"}
  ],
  steps:"1. Cook each vegetable separately in sesame oil with garlic.\n2. Season beef with soy and sesame, fry until cooked.\n3. Fry eggs sunny-side up.\n4. Divide rice into bowls, arrange vegetables in sections.\n5. Place beef and fried egg on top.\n6. Add gochujang, mix everything together at the table."
},
{
  id:'c_kr_2',
  name:"Doenjang Jjigae",
  category:"Soup",
  country:"Korea",
  serves:"4",
  desc:"Korean fermented soybean paste stew with tofu, courgette and mushrooms \u2014 comfort in a bowl.",
  cookTime:25,
  onePot:true,
  calories:280,
  ingredients:[
      {name:"Doenjang paste",qty:"4",unit:"tbsp"},
      {name:"Silken tofu",qty:"300",unit:"g"},
      {name:"Courgette",qty:"1",unit:""},
      {name:"Mushrooms",qty:"100",unit:"g"},
      {name:"Onion",qty:"0.5",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Anchovies",qty:"1",unit:"tbsp"},
      {name:"Gochugaru chilli flakes",qty:"1",unit:"tsp"},
      {name:"Dashi or water",qty:"800",unit:"ml"}
  ],
  steps:"1. Make stock with anchovies and water, simmer 10 mins.\n2. Dissolve doenjang into the stock.\n3. Add courgette, mushrooms and onion.\n4. Simmer 10 mins.\n5. Add cubed tofu and garlic, cook 5 more mins.\n6. Add gochugaru, adjust seasoning, serve with steamed rice."
},
{
  id:'c_kr_3',
  name:"Galbi",
  category:"Meat",
  country:"Korea",
  serves:"4",
  desc:"Korean BBQ short ribs marinated in soy, pear, garlic and sesame \u2014 caramelised and charred.",
  cookTime:40,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Beef short ribs",qty:"1",unit:"kg"},
      {name:"Soy sauce",qty:"6",unit:"tbsp"},
      {name:"Asian pear",qty:"1",unit:""},
      {name:"Garlic",qty:"5",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Sesame oil",qty:"2",unit:"tbsp"},
      {name:"Sugar",qty:"3",unit:"tbsp"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Sesame seeds",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Score ribs and soak in cold water 1 hour.\n2. Blend pear, garlic, ginger, soy, sesame oil and sugar.\n3. Marinate ribs at least 4 hours (overnight best).\n4. Grill on high heat 4\u20135 mins each side until charred.\n5. Serve with steamed rice, kimchi and spring onions.\n6. Sprinkle with sesame seeds."
},
{
  id:'c_kr_4',
  name:"Sundubu Jjigae",
  category:"Soup",
  country:"Korea",
  serves:"2",
  desc:"Spicy silken tofu stew with seafood or pork and a raw egg cracked in \u2014 fiery Korean comfort.",
  cookTime:25,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Silken tofu",qty:"300",unit:"g"},
      {name:"Pork mince",qty:"150",unit:"g"},
      {name:"Clams or prawns",qty:"100",unit:"g"},
      {name:"Gochujang",qty:"2",unit:"tbsp"},
      {name:"Gochugaru",qty:"2",unit:"tsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Spring onions",qty:"2",unit:""},
      {name:"Sesame oil",qty:"1",unit:"tsp"},
      {name:"Egg",qty:"1",unit:""},
      {name:"Anchovy stock",qty:"500",unit:"ml"}
  ],
  steps:"1. Fry pork with gochujang and gochugaru in sesame oil.\n2. Add anchovy stock and bring to boil.\n3. Add tofu in large chunks.\n4. Add seafood and garlic, cook 5 mins.\n5. Crack egg directly into the boiling stew.\n6. Serve immediately in the hot pot with steamed rice."
},
{
  id:'c_kr_5',
  name:"Japchae",
  category:"Asian",
  country:"Korea",
  serves:"4",
  desc:"Sweet potato glass noodles stir-fried with colourful vegetables and beef in soy-sesame sauce.",
  cookTime:35,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Sweet potato glass noodles",qty:"250",unit:"g"},
      {name:"Beef sirloin",qty:"200",unit:"g"},
      {name:"Spinach",qty:"100",unit:"g"},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Red pepper",qty:"1",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Mushrooms",qty:"100",unit:"g"},
      {name:"Soy sauce",qty:"4",unit:"tbsp"},
      {name:"Sesame oil",qty:"3",unit:"tbsp"},
      {name:"Sugar",qty:"2",unit:"tsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Sesame seeds",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Soak noodles 30 mins, boil 6 mins, drain.\n2. Season beef with soy, sesame oil, garlic and sugar.\n3. Stir-fry each vegetable separately with seasoning.\n4. Cook beef, add noodles and all veg.\n5. Season with remaining soy and sesame oil.\n6. Serve garnished with sesame seeds."
},
{
  id:'c_vn_1',
  name:"Pho Bo",
  category:"Soup",
  country:"Vietnam",
  serves:"4",
  desc:"Silky beef bone broth with rice noodles, tender beef and fragrant herbs \u2014 Vietnam's soul.",
  cookTime:180,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Beef bones",qty:"1",unit:"kg"},
      {name:"Beef brisket",qty:"400",unit:"g"},
      {name:"Rice noodles",qty:"400",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Ginger",qty:"5",unit:"slices"},
      {name:"Star anise",qty:"4",unit:""},
      {name:"Cinnamon stick",qty:"1",unit:""},
      {name:"Cloves",qty:"4",unit:""},
      {name:"Fish sauce",qty:"4",unit:"tbsp"},
      {name:"Bean sprouts",qty:"200",unit:"g"},
      {name:"Thai basil",qty:"1",unit:"bunch"},
      {name:"Lime",qty:"3",unit:""},
      {name:"Spring onions",qty:"4",unit:""}
  ],
  steps:"1. Char onion and ginger directly over flame.\n2. Toast star anise, cinnamon and cloves.\n3. Simmer bones with charred veg and spices 3 hours.\n4. Add brisket last 30 mins.\n5. Strain broth, season with fish sauce and sugar.\n6. Serve over noodles with sliced beef, herbs, sprouts and lime."
},
{
  id:'c_vn_2',
  name:"Bun Bo Hue",
  category:"Soup",
  country:"Vietnam",
  serves:"4",
  desc:"Spicy lemongrass and shrimp paste beef noodle soup from Hue \u2014 bolder than pho.",
  cookTime:90,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Beef shank",qty:"600",unit:"g"},
      {name:"Pork trotters",qty:"2",unit:""},
      {name:"Rice vermicelli",qty:"400",unit:"g"},
      {name:"Lemongrass",qty:"4",unit:"stalks"},
      {name:"Shrimp paste",qty:"2",unit:"tbsp"},
      {name:"Chilli oil",qty:"2",unit:"tbsp"},
      {name:"Fish sauce",qty:"4",unit:"tbsp"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Spring onions",qty:"4",unit:""},
      {name:"Mint",qty:"1",unit:"bunch"},
      {name:"Bean sprouts",qty:"150",unit:"g"}
  ],
  steps:"1. Simmer beef shank and pork trotters with onion and lemongrass 1.5 hrs.\n2. Remove meats, slice beef thinly.\n3. Stir shrimp paste into broth, add fish sauce.\n4. Cook rice vermicelli, divide into bowls.\n5. Pour over hot broth with beef slices.\n6. Serve with chilli oil, herbs and bean sprouts."
},
{
  id:'c_vn_3',
  name:"Thit Kho Trung",
  category:"Meat",
  country:"Vietnam",
  serves:"4",
  desc:"Caramelised pork belly braised in coconut water with hard-boiled eggs and fish sauce.",
  cookTime:60,
  onePot:true,
  calories:640,
  ingredients:[
      {name:"Pork belly",qty:"600",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Coconut water",qty:"400",unit:"ml"},
      {name:"Fish sauce",qty:"4",unit:"tbsp"},
      {name:"Sugar",qty:"3",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Shallots",qty:"3",unit:""},
      {name:"Spring onions",qty:"2",unit:""},
      {name:"Black pepper",qty:"1",unit:"tsp"}
  ],
  steps:"1. Hard boil eggs, peel and set aside.\n2. Caramelise sugar in pot until amber.\n3. Add pork, coat in caramel, add shallots and garlic.\n4. Pour in fish sauce and coconut water.\n5. Add eggs, simmer on low 40 mins until sauce thickens.\n6. Serve with steamed rice and pickled mustard greens."
},
{
  id:'c_vn_4',
  name:"Com Tam",
  category:"Meat",
  country:"Vietnam",
  serves:"4",
  desc:"Vietnamese broken rice with grilled lemongrass pork and pickled vegetables.",
  cookTime:40,
  onePot:false,
  calories:560,
  ingredients:[
      {name:"Broken rice",qty:"400",unit:"g"},
      {name:"Pork shoulder steaks",qty:"600",unit:"g"},
      {name:"Lemongrass",qty:"3",unit:"stalks"},
      {name:"Fish sauce",qty:"4",unit:"tbsp"},
      {name:"Sugar",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Shallots",qty:"3",unit:""},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Daikon",qty:"150",unit:"g"},
      {name:"Rice vinegar",qty:"3",unit:"tbsp"},
      {name:"Eggs",qty:"4",unit:""}
  ],
  steps:"1. Marinate pork in blended lemongrass, garlic, fish sauce and sugar.\n2. Make pickled carrot and daikon with vinegar, sugar and salt.\n3. Grill pork on high heat until charred.\n4. Cook broken rice.\n5. Fry eggs.\n6. Serve rice with sliced pork, fried egg and pickled veg with fish sauce dip."
},
{
  id:'c_vn_5',
  name:"Canh Chua",
  category:"Fish",
  country:"Vietnam",
  serves:"4",
  desc:"Vietnamese sweet and sour tamarind soup with pineapple, tomatoes and fresh fish.",
  cookTime:30,
  onePot:true,
  calories:280,
  ingredients:[
      {name:"White fish fillets",qty:"500",unit:"g"},
      {name:"Pineapple",qty:"200",unit:"g"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Bean sprouts",qty:"100",unit:"g"},
      {name:"Tamarind paste",qty:"3",unit:"tbsp"},
      {name:"Fish sauce",qty:"3",unit:"tbsp"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Elephant ear stem or celery",qty:"100",unit:"g"},
      {name:"Dill",qty:"1",unit:"handful"},
      {name:"Chilli",qty:"1",unit:""}
  ],
  steps:"1. Dissolve tamarind in 1l water with fish sauce and sugar.\n2. Bring to simmer, add pineapple and tomatoes.\n3. Add fish pieces, cook 5 mins gently.\n4. Add bean sprouts and celery.\n5. Check seasoning \u2014 should be sour, sweet and salty.\n6. Serve with rice and fresh dill on top."
},
{
  id:'c_br_1',
  name:"Feijoada",
  category:"Meat",
  country:"Brazil",
  serves:"6",
  desc:"Brazil's national dish \u2014 black bean and pork stew with smoked meats, served with rice and farofa.",
  cookTime:180,
  onePot:true,
  calories:780,
  ingredients:[
      {name:"Black beans",qty:"500",unit:"g"},
      {name:"Pork ribs",qty:"300",unit:"g"},
      {name:"Smoked sausage",qty:"200",unit:"g"},
      {name:"Bacon",qty:"200",unit:"g"},
      {name:"Pork ear",qty:"1",unit:""},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Bay leaves",qty:"3",unit:""},
      {name:"Orange",qty:"1",unit:""},
      {name:"Steamed rice",qty:"400",unit:"g"},
      {name:"Farofa (toasted cassava flour)",qty:"150",unit:"g"},
      {name:"Collard greens",qty:"200",unit:"g"}
  ],
  steps:"1. Soak beans overnight, soak salted meats 2 hours.\n2. Simmer all meats in water 1 hour.\n3. Add beans, garlic, onion and bay leaves.\n4. Cook 1.5\u20132 hrs until beans are creamy.\n5. Fry collard greens in garlic.\n6. Serve beans and meats over rice with farofa and orange slices."
},
{
  id:'c_br_2',
  name:"Moqueca Baiana",
  category:"Fish",
  country:"Brazil",
  serves:"4",
  desc:"Bahian fish stew in coconut milk and dend\u00ea palm oil with peppers and coriander.",
  cookTime:40,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"White fish fillets",qty:"700",unit:"g"},
      {name:"Coconut milk",qty:"400",unit:"ml"},
      {name:"Palm oil (dend\u00ea)",qty:"3",unit:"tbsp"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Red pepper",qty:"1",unit:""},
      {name:"Green pepper",qty:"1",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Lime",qty:"2",unit:""},
      {name:"Coriander",qty:"1",unit:"bunch"},
      {name:"Chilli",qty:"1",unit:""}
  ],
  steps:"1. Marinate fish in lime juice, salt and garlic.\n2. Heat palm oil, fry onion and peppers.\n3. Add tomatoes and chilli, cook 5 mins.\n4. Add fish and coconut milk.\n5. Simmer gently 15 mins.\n6. Scatter coriander and serve with white rice and pir\u00e3o."
},
{
  id:'c_br_3',
  name:"Picanha na Brasa",
  category:"Meat",
  country:"Brazil",
  serves:"4",
  desc:"Grilled Brazilian rump cap with rock salt \u2014 the king of the churrasco.",
  cookTime:30,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Picanha (rump cap)",qty:"1",unit:"kg"},
      {name:"Coarse rock salt",qty:"2",unit:"tbsp"},
      {name:"Garlic butter",qty:"50",unit:"g"}
  ],
  steps:"1. Score fat cap in diamond pattern.\n2. Season generously with coarse rock salt only.\n3. Grill fat-side down on very high heat 8 mins.\n4. Flip and grill meat side 5 mins for medium rare.\n5. Rest 8 mins, carve against the grain.\n6. Serve with garlic butter and chimichurri."
},
{
  id:'c_br_4',
  name:"Coxinha",
  category:"Meat",
  country:"Brazil",
  serves:"6",
  desc:"Teardrop-shaped chicken croquettes in crispy breadcrumbs \u2014 Brazil's favourite street food.",
  cookTime:60,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Chicken breast",qty:"600",unit:"g"},
      {name:"Chicken stock",qty:"500",unit:"ml"},
      {name:"Plain flour",qty:"300",unit:"g"},
      {name:"Cream cheese",qty:"150",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Breadcrumbs",qty:"200",unit:"g"},
      {name:"Vegetable oil",qty:"500",unit:"ml"}
  ],
  steps:"1. Poach chicken in stock, shred. Reserve stock.\n2. Mix chicken with cream cheese, onion, garlic and parsley.\n3. Make dough: cook flour in chicken stock until dough forms.\n4. Shape dough around filling into teardrops.\n5. Coat in egg and breadcrumbs.\n6. Deep fry at 170\u00b0C for 5 mins until golden."
},
{
  id:'c_br_5',
  name:"Vatap\u00e1",
  category:"Fish",
  country:"Brazil",
  serves:"4",
  desc:"Thick Bahian bread and shrimp paste with coconut milk, peanuts and dend\u00ea oil.",
  cookTime:45,
  onePot:true,
  calories:560,
  ingredients:[
      {name:"Dried shrimp",qty:"150",unit:"g"},
      {name:"Stale bread",qty:"200",unit:"g"},
      {name:"Coconut milk",qty:"400",unit:"ml"},
      {name:"Palm oil",qty:"3",unit:"tbsp"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Peanuts",qty:"80",unit:"g"},
      {name:"Cashews",qty:"60",unit:"g"},
      {name:"Chilli",qty:"1",unit:""},
      {name:"Coriander",qty:"1",unit:"handful"}
  ],
  steps:"1. Soak bread in coconut milk, blend smooth.\n2. Blend dried shrimp to powder.\n3. Fry onion, garlic and ginger in palm oil.\n4. Add shrimp powder, blended bread mixture.\n5. Add peanuts, cashews and chilli.\n6. Cook stirring 20 mins until thick. Serve with acaraj\u00e9 or rice."
},
{
  id:'c_ar_1',
  name:"Asado",
  category:"Meat",
  country:"Argentina",
  serves:"6",
  desc:"The Argentine mixed grill \u2014 a ritual of slowly cooked beef cuts over wood-fire embers.",
  cookTime:180,
  onePot:false,
  calories:820,
  ingredients:[
      {name:"Beef short ribs",qty:"1",unit:"kg"},
      {name:"Chorizo sausages",qty:"4",unit:""},
      {name:"Morcilla",qty:"4",unit:""},
      {name:"Beef sirloin",qty:"600",unit:"g"},
      {name:"Chimichurri (parsley, garlic, oil, vinegar)",qty:"200",unit:"ml"},
      {name:"Coarse salt",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Build wood or charcoal fire, let it die to glowing embers.\n2. Season all meats only with coarse salt.\n3. Start ribs over cooler area, cook slowly 2 hours.\n4. Add chorizo and morcilla 40 mins before serving.\n5. Finish sirloin on hot coals 5 mins each side.\n6. Serve in stages with chimichurri."
},
{
  id:'c_ar_2',
  name:"Empanadas",
  category:"Meat",
  country:"Argentina",
  serves:"6",
  desc:"Flaky baked pastry pockets filled with spiced beef, olives and hard-boiled egg.",
  cookTime:60,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Plain flour",qty:"400",unit:"g"},
      {name:"Butter",qty:"100",unit:"g"},
      {name:"Egg",qty:"3",unit:""},
      {name:"Beef mince",qty:"400",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Paprika",qty:"2",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Green olives",qty:"60",unit:"g"},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Raisins",qty:"40",unit:"g"}
  ],
  steps:"1. Make pastry with flour, butter, egg and water. Rest 30 mins.\n2. Fry beef with onion, garlic, paprika and cumin.\n3. Cool, add chopped olives, raisins, spring onions and chopped egg.\n4. Roll pastry, cut circles, fill and fold.\n5. Seal edges with repulgue crimp.\n6. Bake at 200\u00b0C for 20 mins until golden."
},
{
  id:'c_ar_3',
  name:"Cazuela de Mondongo",
  category:"Meat",
  country:"Argentina",
  serves:"4",
  desc:"Slow-braised tripe and vegetable stew with chickpeas \u2014 hearty gaucho cooking.",
  cookTime:120,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Tripe",qty:"700",unit:"g"},
      {name:"Chickpeas",qty:"200",unit:"g"},
      {name:"Potato",qty:"2",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Red pepper",qty:"1",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Paprika",qty:"2",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Beef stock",qty:"600",unit:"ml"}
  ],
  steps:"1. Blanch tripe and cut into strips.\n2. Fry onion, garlic, pepper and paprika.\n3. Add tripe, tomatoes, chickpeas and stock.\n4. Cook 1 hour, add potato and carrot.\n5. Simmer 30 more mins until everything tender.\n6. Serve with crusty bread."
},
{
  id:'c_ar_4',
  name:"Milanesa a la Napolitana",
  category:"Meat",
  country:"Argentina",
  serves:"4",
  desc:"Breaded beef escalope topped with tomato sauce, ham and melted cheese \u2014 Argentina's twist on Milanese.",
  cookTime:30,
  onePot:false,
  calories:620,
  ingredients:[
      {name:"Beef escalopes",qty:"4",unit:""},
      {name:"Breadcrumbs",qty:"100",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Flour",qty:"50",unit:"g"},
      {name:"Tomato sauce",qty:"150",unit:"ml"},
      {name:"Mozzarella",qty:"200",unit:"g"},
      {name:"Ham",qty:"4",unit:"slices"},
      {name:"Oregano",qty:"1",unit:"tsp"},
      {name:"Vegetable oil",qty:"4",unit:"tbsp"}
  ],
  steps:"1. Pound beef thin, dust in flour, dip in egg, coat in breadcrumbs.\n2. Shallow fry until golden on both sides.\n3. Place on baking tray, top with tomato sauce.\n4. Add ham slice and mozzarella.\n5. Bake at 200\u00b0C for 10 mins until cheese melts.\n6. Serve with chips or salad."
},
{
  id:'c_ar_5',
  name:"Locro",
  category:"Soup",
  country:"Argentina",
  serves:"6",
  desc:"Thick winter stew of corn, beans and pork \u2014 Argentina's oldest indigenous comfort dish.",
  cookTime:120,
  onePot:true,
  calories:680,
  ingredients:[
      {name:"White hominy corn",qty:"300",unit:"g"},
      {name:"White beans",qty:"200",unit:"g"},
      {name:"Pork ribs",qty:"400",unit:"g"},
      {name:"Chorizo",qty:"200",unit:"g"},
      {name:"Squash",qty:"300",unit:"g"},
      {name:"Potato",qty:"2",unit:""},
      {name:"Onion",qty:"2",unit:""},
      {name:"Paprika",qty:"2",unit:"tsp"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Chilli flakes",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Soak corn and beans overnight.\n2. Cook corn and beans together 1.5 hrs.\n3. Brown pork and chorizo, add with veg to beans.\n4. Add squash, potato, garlic, spices and water.\n5. Simmer 45 mins, stir vigorously to break down starch.\n6. Serve thick as porridge."
},
{
  id:'c_et_1',
  name:"Doro Wat",
  category:"Meat",
  country:"Ethiopia",
  serves:"4",
  desc:"Ethiopia's national dish \u2014 slow-cooked chicken in spicy berbere and nit'ir qibe butter sauce.",
  cookTime:90,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Chicken pieces",qty:"1.2",unit:"kg"},
      {name:"Onion",qty:"3",unit:""},
      {name:"Berbere spice",qty:"3",unit:"tbsp"},
      {name:"Nit'ir qibe (spiced butter)",qty:"60",unit:"g"},
      {name:"Garlic",qty:"5",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Hard-boiled eggs",qty:"4",unit:""},
      {name:"Red wine or tej",qty:"100",unit:"ml"},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Dry cook chopped onions without oil 20 mins, stirring.\n2. Add spiced butter, garlic and ginger.\n3. Add berbere, fry 5 mins.\n4. Add chicken, wine and tomato pur\u00e9e.\n5. Cover and cook 50 mins.\n6. Add pierced eggs last 10 mins. Serve on injera."
},
{
  id:'c_et_2',
  name:"Misir Wat",
  category:"Vegetarian",
  country:"Ethiopia",
  serves:"4",
  desc:"Spiced red lentil stew with berbere \u2014 the most widely eaten everyday Ethiopian dish.",
  cookTime:40,
  onePot:true,
  calories:360,
  ingredients:[
      {name:"Red lentils",qty:"300",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Berbere spice",qty:"3",unit:"tbsp"},
      {name:"Spiced butter",qty:"40",unit:"g"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Vegetable stock",qty:"500",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Dry cook onion without oil 15 mins.\n2. Add spiced butter, garlic, ginger and berbere.\n3. Cook stirring 5 mins.\n4. Add tomato pur\u00e9e, lentils and stock.\n5. Simmer 25 mins, stirring, until very thick.\n6. Serve on injera with other dishes."
},
{
  id:'c_et_3',
  name:"Tibs",
  category:"Meat",
  country:"Ethiopia",
  serves:"4",
  desc:"Saut\u00e9ed lamb with onion, jalape\u00f1o and rosemary \u2014 quick, charred and deeply aromatic.",
  cookTime:25,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Lamb shoulder",qty:"600",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Jalape\u00f1o chilli",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Rosemary",qty:"2",unit:"sprigs"},
      {name:"Spiced butter (niter qibe)",qty:"40",unit:"g"},
      {name:"Berbere",qty:"1",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cut lamb into cubes.\n2. Heat spiced butter in a large pan until very hot.\n3. Add lamb, sear on high heat until charred outside.\n4. Add sliced onion, jalape\u00f1o and garlic.\n5. Add berbere and rosemary.\n6. Cook 10 mins until cooked through but still tender. Serve on injera."
},
{
  id:'c_et_4',
  name:"Shiro Wat",
  category:"Vegetarian",
  country:"Ethiopia",
  serves:"4",
  desc:"Thick chickpea flour stew spiced with berbere and garlic \u2014 a fasting day staple.",
  cookTime:30,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Chickpea flour (shiro)",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Berbere",qty:"2",unit:"tbsp"},
      {name:"Spiced butter",qty:"30",unit:"g"},
      {name:"Tomato pur\u00e9e",qty:"1",unit:"tbsp"},
      {name:"Water",qty:"600",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Dry-fry onion 15 mins until dark.\n2. Add spiced butter, garlic and berbere.\n3. Add tomato pur\u00e9e, stir 2 mins.\n4. Whisk in chickpea flour gradually.\n5. Add water slowly, whisking to avoid lumps.\n6. Simmer 15 mins, stirring constantly until thick and smooth."
},
{
  id:'c_et_5',
  name:"Gomen Be Siga",
  category:"Meat",
  country:"Ethiopia",
  serves:"4",
  desc:"Braised beef with collard greens in spiced butter \u2014 a deeply satisfying Ethiopian favourite.",
  cookTime:50,
  onePot:true,
  calories:420,
  ingredients:[
      {name:"Beef chuck",qty:"500",unit:"g"},
      {name:"Collard greens (gomen)",qty:"400",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Spiced butter",qty:"50",unit:"g"},
      {name:"Green chilli",qty:"2",unit:""},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cook beef in water until tender, about 30 mins.\n2. Shred or cube beef.\n3. Fry onion in spiced butter until golden.\n4. Add garlic, ginger and chilli.\n5. Add blanched, chopped collard greens.\n6. Add beef, toss together and cook 10 mins. Serve with injera."
},
{
  id:'c_us_1',
  name:"BBQ Beef Brisket",
  category:"Meat",
  country:"USA",
  serves:"8",
  desc:"Texas-style slow-smoked brisket with dry rub \u2014 the gold standard of American barbecue.",
  cookTime:360,
  onePot:false,
  calories:780,
  ingredients:[
      {name:"Beef brisket flat",qty:"2",unit:"kg"},
      {name:"Coarse black pepper",qty:"3",unit:"tbsp"},
      {name:"Coarse salt",qty:"2",unit:"tbsp"},
      {name:"Garlic powder",qty:"1",unit:"tbsp"},
      {name:"Onion powder",qty:"1",unit:"tbsp"},
      {name:"Smoked paprika",qty:"2",unit:"tsp"}
  ],
  steps:"1. Mix dry rub ingredients, coat brisket generously all over.\n2. Leave uncovered in fridge overnight.\n3. Smoke at 110\u00b0C with oak or hickory 6 hours.\n4. Wrap in butcher paper when bark is set.\n5. Continue smoking to internal temp of 95\u00b0C (about 2\u20134 more hrs).\n6. Rest 1 hour before slicing against the grain."
},
{
  id:'c_us_2',
  name:"Clam Chowder",
  category:"Soup",
  country:"USA",
  serves:"4",
  desc:"Creamy New England clam chowder with potatoes, bacon and thyme.",
  cookTime:40,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Clams",qty:"700",unit:"g"},
      {name:"Potato",qty:"3",unit:""},
      {name:"Bacon",qty:"150",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Double cream",qty:"200",unit:"ml"},
      {name:"Milk",qty:"300",unit:"ml"},
      {name:"Flour",qty:"3",unit:"tbsp"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Thyme",qty:"3",unit:"sprigs"},
      {name:"Bay leaf",qty:"1",unit:""}
  ],
  steps:"1. Steam clams, reserve liquor and chop meat.\n2. Fry bacon until crispy, remove.\n3. Saut\u00e9 onion, celery and garlic in bacon fat.\n4. Add flour, cook 2 mins.\n5. Add milk, cream, clam liquor, potato and thyme.\n6. Simmer 20 mins, add clams. Top with bacon."
},
{
  id:'c_us_3',
  name:"Shrimp and Grits",
  category:"Fish",
  country:"USA",
  serves:"4",
  desc:"Southern classic \u2014 creamy stone-ground grits with spicy saut\u00e9ed shrimp, bacon and peppers.",
  cookTime:35,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Large shrimp",qty:"500",unit:"g"},
      {name:"Stone-ground grits",qty:"200",unit:"g"},
      {name:"Bacon",qty:"150",unit:"g"},
      {name:"Cheddar cheese",qty:"100",unit:"g"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Green pepper",qty:"1",unit:""},
      {name:"Spring onions",qty:"4",unit:""},
      {name:"Cajun seasoning",qty:"2",unit:"tsp"},
      {name:"Chicken stock",qty:"700",unit:"ml"},
      {name:"Hot sauce",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cook grits in stock, stirring 25 mins until thick.\n2. Stir in butter and cheese.\n3. Fry bacon until crispy, saut\u00e9 peppers in fat.\n4. Season shrimp with Cajun spice.\n5. Add shrimp and garlic to pan, cook 3 mins.\n6. Serve shrimp mixture over creamy grits."
},
{
  id:'c_us_4',
  name:"Chicken and Waffles",
  category:"Meat",
  country:"USA",
  serves:"4",
  desc:"Crispy Southern fried chicken on fluffy buttermilk waffles with hot sauce and maple syrup.",
  cookTime:60,
  onePot:false,
  calories:820,
  ingredients:[
      {name:"Chicken thighs",qty:"4",unit:""},
      {name:"Buttermilk",qty:"300",unit:"ml"},
      {name:"Plain flour",qty:"200",unit:"g"},
      {name:"Cornstarch",qty:"50",unit:"g"},
      {name:"Cajun seasoning",qty:"2",unit:"tbsp"},
      {name:"Vegetable oil",qty:"1",unit:"l"},
      {name:"Self-raising flour",qty:"250",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Maple syrup",qty:"4",unit:"tbsp"},
      {name:"Hot sauce",qty:"2",unit:"tbsp"}
  ],
  steps:"1. Marinate chicken in buttermilk and half the seasoning overnight.\n2. Mix flour, cornstarch and remaining seasoning.\n3. Dredge chicken, fry at 165\u00b0C for 15 mins until cooked.\n4. Make waffle batter and cook in waffle iron.\n5. Plate waffle with chicken on top.\n6. Drizzle with maple syrup and hot sauce."
},
{
  id:'c_us_5',
  name:"Jambalaya",
  category:"Asian",
  country:"USA",
  serves:"6",
  desc:"Louisiana rice dish with chicken, andouille sausage, prawns and the Holy Trinity of veg.",
  cookTime:55,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Long grain rice",qty:"350",unit:"g"},
      {name:"Chicken thighs",qty:"500",unit:"g"},
      {name:"Andouille sausage",qty:"300",unit:"g"},
      {name:"Raw prawns",qty:"300",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Green pepper",qty:"1",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Chicken stock",qty:"500",unit:"ml"},
      {name:"Cajun seasoning",qty:"3",unit:"tsp"},
      {name:"Cayenne",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Brown chicken and sausage, set aside.\n2. Fry onion, celery and pepper \u2014 the Holy Trinity.\n3. Add garlic, Cajun seasoning and tomatoes.\n4. Add rice, stock and browned meats.\n5. Cover and cook 25 mins.\n6. Stir in prawns last 5 mins, serve from the pot."
},
{
  id:'c_pt_1',
  name:"Bacalhau \u00e0 Br\u00e1s",
  category:"Fish",
  country:"Portugal",
  serves:"4",
  desc:"Salted cod with onion, egg and matchstick potatoes \u2014 one of 365 ways to cook bacalhau.",
  cookTime:30,
  onePot:true,
  calories:540,
  ingredients:[
      {name:"Salt cod (bacalhau)",qty:"400",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Eggs",qty:"5",unit:""},
      {name:"Potato matchsticks (canned or fried)",qty:"300",unit:"g"},
      {name:"Olive oil",qty:"5",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Black olives",qty:"50",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Pepper",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Soak salt cod overnight, poach, flake.\n2. Slowly fry onion and garlic in plenty of olive oil.\n3. Add cod and potato straws, warm through.\n4. Beat eggs, pour over and scramble softly.\n5. Remove from heat while still creamy.\n6. Scatter olives and parsley, serve immediately."
},
{
  id:'c_pt_2',
  name:"Caldo Verde",
  category:"Soup",
  country:"Portugal",
  serves:"6",
  desc:"Portugal's most beloved soup \u2014 kale ribbons in silky potato broth with chouri\u00e7o.",
  cookTime:40,
  onePot:true,
  calories:340,
  ingredients:[
      {name:"Potato",qty:"600",unit:"g"},
      {name:"Cavolo nero or kale",qty:"300",unit:"g"},
      {name:"Chouri\u00e7o",qty:"200",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Chicken stock",qty:"1",unit:"l"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Simmer potato, onion and garlic in stock until soft.\n2. Blend until very smooth.\n3. Slice kale into very thin ribbons.\n4. Add kale to soup, cook 5 mins \u2014 it must stay bright green.\n5. Fry chouri\u00e7o slices.\n6. Serve with chouri\u00e7o on top and drizzle of olive oil."
},
{
  id:'c_pt_3',
  name:"Frango no Churrasco",
  category:"Meat",
  country:"Portugal",
  serves:"4",
  desc:"Piri-piri marinated grilled chicken \u2014 the Portuguese contribution to global cuisine.",
  cookTime:40,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Whole chicken",qty:"1.4",unit:"kg"},
      {name:"Piri-piri chillies",qty:"4",unit:""},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Lemon",qty:"2",unit:""},
      {name:"Olive oil",qty:"5",unit:"tbsp"},
      {name:"Paprika",qty:"2",unit:"tsp"},
      {name:"Oregano",qty:"1",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Spatchcock chicken by removing backbone.\n2. Blend piri-piri, garlic, lemon, oil, paprika and oregano.\n3. Slash chicken deeply, rub with marinade.\n4. Marinate at least 2 hours.\n5. Grill or roast at 200\u00b0C for 35 mins, basting.\n6. Rest 10 mins, serve with chips and salad."
},
{
  id:'c_pt_4',
  name:"Cataplana de Marisco",
  category:"Fish",
  country:"Portugal",
  serves:"4",
  desc:"Algarve seafood stew cooked in a copper cataplana with chouri\u00e7o, peppers and white wine.",
  cookTime:40,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Clams",qty:"500",unit:"g"},
      {name:"Prawns",qty:"400",unit:"g"},
      {name:"Mussels",qty:"300",unit:"g"},
      {name:"Chouri\u00e7o",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Red pepper",qty:"2",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"White wine",qty:"200",unit:"ml"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Coriander",qty:"1",unit:"handful"},
      {name:"Paprika",qty:"1",unit:"tsp"}
  ],
  steps:"1. Saut\u00e9 onion, garlic, pepper and chouri\u00e7o in oil.\n2. Add tomatoes, paprika and wine.\n3. Add clams and mussels, cover tightly.\n4. Cook 5 mins, add prawns.\n5. Cook 3 more mins until all shellfish open.\n6. Scatter coriander, serve from cataplana with bread."
},
{
  id:'c_pt_5',
  name:"Arroz de Pato",
  category:"Meat",
  country:"Portugal",
  serves:"4",
  desc:"Duck and rice baked in the oven with chouri\u00e7o and orange \u2014 a Portuguese Sunday masterpiece.",
  cookTime:90,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Duck legs",qty:"4",unit:""},
      {name:"Carnaroli or arborio rice",qty:"350",unit:"g"},
      {name:"Chouri\u00e7o",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"White wine",qty:"200",unit:"ml"},
      {name:"Orange",qty:"1",unit:""},
      {name:"Chicken stock",qty:"700",unit:"ml"},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"}
  ],
  steps:"1. Braise duck legs in wine, stock, onion and garlic 60 mins.\n2. Remove duck, shred meat. Reserve stock.\n3. Par-cook rice in duck stock 10 mins.\n4. Mix rice with duck meat and orange juice.\n5. Top with sliced chouri\u00e7o.\n6. Bake at 190\u00b0C for 20 mins until golden on top."
},
{
  id:'c_de_1',
  name:"Sauerbraten",
  category:"Meat",
  country:"Germany",
  serves:"6",
  desc:"Rhine-style marinated pot roast in a sweet-sour gingersnap gravy \u2014 Germany's national dish.",
  cookTime:300,
  onePot:false,
  calories:640,
  ingredients:[
      {name:"Beef rump",qty:"1.2",unit:"kg"},
      {name:"Red wine vinegar",qty:"250",unit:"ml"},
      {name:"Red wine",qty:"250",unit:"ml"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Juniper berries",qty:"6",unit:""},
      {name:"Cloves",qty:"4",unit:""},
      {name:"Bay leaves",qty:"3",unit:""},
      {name:"Gingersnap biscuits",qty:"60",unit:"g"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Butter",qty:"30",unit:"g"}
  ],
  steps:"1. Marinate beef in vinegar, wine and spices for 3\u20134 days in fridge.\n2. Brown meat in butter.\n3. Add marinade vegetables and liquid, braise at 160\u00b0C for 2.5 hrs.\n4. Remove beef, strain sauce into pan.\n5. Crumble in gingersnaps, simmer until thick.\n6. Slice beef, serve in gravy with red cabbage and dumplings."
},
{
  id:'c_de_2',
  name:"Eisbein",
  category:"Meat",
  country:"Germany",
  serves:"4",
  desc:"Slow-cooked pickled pork knuckle \u2014 crispy skin outside, tender meat inside.",
  cookTime:180,
  onePot:false,
  calories:780,
  ingredients:[
      {name:"Pork knuckles",qty:"2",unit:""},
      {name:"Onion",qty:"2",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"3",unit:"sticks"},
      {name:"Bay leaves",qty:"3",unit:""},
      {name:"Black peppercorns",qty:"10",unit:""},
      {name:"Juniper berries",qty:"6",unit:""},
      {name:"Salt",qty:"2",unit:"tbsp"},
      {name:"Sauerkraut",qty:"400",unit:"g"},
      {name:"Potato",qty:"4",unit:""},
      {name:"Beer",qty:"500",unit:"ml"}
  ],
  steps:"1. Simmer pork knuckles with vegetables, spices and beer for 2.5 hrs.\n2. Remove, let skin dry.\n3. Roast at 220\u00b0C for 30 mins for crackling.\n4. Reduce braising liquid for gravy.\n5. Serve with sauerkraut and boiled potatoes.\n6. Carve tableside."
},
{
  id:'c_de_3',
  name:"Beef Rouladen",
  category:"Meat",
  country:"Germany",
  serves:"4",
  desc:"Thin beef rolls stuffed with mustard, bacon and gherkin \u2014 a Sunday classic.",
  cookTime:90,
  onePot:false,
  calories:560,
  ingredients:[
      {name:"Thin beef escalopes",qty:"4",unit:""},
      {name:"German mustard",qty:"4",unit:"tbsp"},
      {name:"Bacon",qty:"8",unit:"slices"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Gherkins",qty:"4",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"2",unit:"sticks"},
      {name:"Red wine",qty:"200",unit:"ml"},
      {name:"Beef stock",qty:"300",unit:"ml"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Cornflour",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Spread escalopes with mustard, top with bacon and gherkin.\n2. Roll tightly and secure with cocktail sticks.\n3. Brown rouladen in butter all over.\n4. Add veg, wine and stock, braise 1 hour.\n5. Remove rouladen, strain and reduce sauce.\n6. Thicken sauce with cornflour, serve with potato dumplings."
},
{
  id:'c_de_4',
  name:"Flammkuchen",
  category:"Other",
  country:"Germany",
  serves:"4",
  desc:"Alsatian flame cake \u2014 thin crispy base with cr\u00e8me fra\u00eeche, onion and lardons.",
  cookTime:25,
  onePot:false,
  calories:440,
  ingredients:[
      {name:"Strong bread flour",qty:"300",unit:"g"},
      {name:"Water",qty:"160",unit:"ml"},
      {name:"Cr\u00e8me fra\u00eeche",qty:"200",unit:"ml"},
      {name:"Lardons",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"}
  ],
  steps:"1. Make dough with flour, water, oil and salt. Rest 15 mins.\n2. Roll very thin into a rectangle.\n3. Spread cr\u00e8me fra\u00eeche almost to edge.\n4. Top with thinly sliced onion and lardons.\n5. Season with nutmeg.\n6. Bake at highest oven temperature (250\u00b0C+) for 10\u201312 mins until edges char."
},
{
  id:'c_de_5',
  name:"Linsen mit Sp\u00e4tzle",
  category:"Vegetarian",
  country:"Germany",
  serves:"4",
  desc:"Swabian lentil soup with egg sp\u00e4tzle dumplings and vinegar \u2014 Swabia's most loved dish.",
  cookTime:50,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Brown lentils",qty:"300",unit:"g"},
      {name:"Sp\u00e4tzle",qty:"300",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celery",qty:"2",unit:"sticks"},
      {name:"Bacon",qty:"100",unit:"g"},
      {name:"Beef stock",qty:"1",unit:"l"},
      {name:"Apple cider vinegar",qty:"2",unit:"tbsp"},
      {name:"Bay leaves",qty:"2",unit:""},
      {name:"Thyme",qty:"2",unit:"sprigs"}
  ],
  steps:"1. Fry bacon and onion.\n2. Add carrot, celery and lentils.\n3. Cover with stock, add bay and thyme.\n4. Simmer 35 mins until lentils are tender.\n5. Add vinegar and season.\n6. Cook sp\u00e4tzle separately, serve in or alongside lentils."
},
{
  id:'c_ua_1',
  name:"Borscht",
  category:"Soup",
  country:"Ukraine",
  serves:"6",
  desc:"Deep crimson beetroot soup with beef and sour cream \u2014 the soul of Ukrainian cuisine.",
  cookTime:90,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Beetroot",qty:"500",unit:"g"},
      {name:"Beef chuck",qty:"400",unit:"g"},
      {name:"Cabbage",qty:"200",unit:"g"},
      {name:"Potato",qty:"2",unit:""},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"White wine vinegar",qty:"2",unit:"tbsp"},
      {name:"Beef stock",qty:"1.5",unit:"l"},
      {name:"Sour cream",qty:"150",unit:"ml"},
      {name:"Dill",qty:"1",unit:"handful"}
  ],
  steps:"1. Simmer beef in stock 45 mins until tender, shred.\n2. Add grated beetroot and carrot, cook 15 mins.\n3. Add potato, cabbage and tomato pur\u00e9e.\n4. Cook 20 mins, add vinegar and garlic.\n5. Season well \u2014 should be sweet, sour and earthy.\n6. Serve with a generous dollop of sour cream and dill."
},
{
  id:'c_ua_2',
  name:"Chicken Kyiv",
  category:"Meat",
  country:"Ukraine",
  serves:"4",
  desc:"Breaded chicken breast stuffed with cold garlic and herb butter \u2014 the original.",
  cookTime:45,
  onePot:false,
  calories:680,
  ingredients:[
      {name:"Chicken breasts",qty:"4",unit:""},
      {name:"Butter",qty:"120",unit:"g"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Tarragon",qty:"1",unit:"tbsp"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Breadcrumbs",qty:"150",unit:"g"},
      {name:"Plain flour",qty:"60",unit:"g"},
      {name:"Vegetable oil",qty:"500",unit:"ml"}
  ],
  steps:"1. Blend butter with garlic, parsley and tarragon. Freeze into cylinders.\n2. Butterfly chicken breasts, pound thin.\n3. Wrap each around a butter cylinder, chill 30 mins.\n4. Dust in flour, egg, breadcrumbs (twice).\n5. Deep fry at 170\u00b0C for 12\u201314 mins.\n6. Rest 5 mins \u2014 butter will pour out when cut."
},
{
  id:'c_ua_3',
  name:"Varenyky",
  category:"Vegetarian",
  country:"Ukraine",
  serves:"4",
  desc:"Boiled dumplings stuffed with potato and cheese \u2014 the Ukrainian pierogi.",
  cookTime:60,
  onePot:false,
  calories:480,
  ingredients:[
      {name:"Plain flour",qty:"400",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Water",qty:"150",unit:"ml"},
      {name:"Potato",qty:"500",unit:"g"},
      {name:"Cottage cheese",qty:"200",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Sour cream",qty:"150",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Make dough, rest 30 mins.\n2. Mash potato with cottage cheese and salt.\n3. Roll dough, cut circles.\n4. Fill with potato mixture, fold and pinch to seal.\n5. Boil 3\u20134 mins until floating.\n6. Fry caramelised onions in butter, pour over varenyky. Serve with sour cream."
},
{
  id:'c_ua_4',
  name:"Holubtsi",
  category:"Meat",
  country:"Ukraine",
  serves:"6",
  desc:"Stuffed cabbage rolls with pork and rice in tomato sauce \u2014 Ukrainian grandmother's dish.",
  cookTime:90,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Cabbage",qty:"1",unit:"head"},
      {name:"Pork mince",qty:"500",unit:"g"},
      {name:"Rice",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Sour cream",qty:"200",unit:"ml"},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Dill",qty:"1",unit:"handful"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Blanch cabbage leaves 2 mins, cut out thick stems.\n2. Mix pork with par-cooked rice, onion, garlic and seasoning.\n3. Roll tablespoon of filling in each leaf.\n4. Place in pot, mix tomatoes, sour cream and pur\u00e9e, pour over.\n5. Cook on low heat 1 hour.\n6. Serve with sour cream and fresh dill."
},
{
  id:'c_ua_5',
  name:"Pampushky",
  category:"Other",
  country:"Ukraine",
  serves:"6",
  desc:"Soft garlic-glazed bread rolls \u2014 the traditional accompaniment to borscht.",
  cookTime:60,
  onePot:false,
  calories:280,
  ingredients:[
      {name:"Strong bread flour",qty:"400",unit:"g"},
      {name:"Yeast",qty:"7",unit:"g"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Milk",qty:"200",unit:"ml"},
      {name:"Butter",qty:"40",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"}
  ],
  steps:"1. Make enriched dough with flour, yeast, milk, butter and eggs.\n2. Knead 10 mins, rest 1 hour.\n3. Shape into rolls, prove 30 mins.\n4. Bake at 200\u00b0C for 18 mins until golden.\n5. Make garlic oil with crushed garlic, oil and parsley.\n6. Brush hot rolls generously with garlic oil."
},
{
  id:'c_ru_1',
  name:"Beef Stroganoff",
  category:"Meat",
  country:"Russia",
  serves:"4",
  desc:"Tender strips of beef in a rich sour cream and mushroom sauce \u2014 a 19th-century Russian classic.",
  cookTime:30,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Beef sirloin",qty:"600",unit:"g"},
      {name:"Button mushrooms",qty:"250",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Sour cream",qty:"200",unit:"ml"},
      {name:"Beef stock",qty:"150",unit:"ml"},
      {name:"Dijon mustard",qty:"1",unit:"tbsp"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Paprika",qty:"1",unit:"tsp"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Egg tagliatelle",qty:"300",unit:"g"}
  ],
  steps:"1. Cut beef into thin strips against the grain.\n2. Sear in hot butter in batches, set aside.\n3. Fry onion and mushrooms until golden.\n4. Add garlic, stock and mustard, reduce slightly.\n5. Add sour cream and beef, heat gently (do not boil).\n6. Serve over egg noodles with parsley."
},
{
  id:'c_ru_2',
  name:"Pelmeni",
  category:"Meat",
  country:"Russia",
  serves:"4",
  desc:"Siberian meat dumplings \u2014 tiny, satisfying and eaten with sour cream and vinegar.",
  cookTime:60,
  onePot:false,
  calories:560,
  ingredients:[
      {name:"Plain flour",qty:"350",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Water",qty:"100",unit:"ml"},
      {name:"Pork mince",qty:"250",unit:"g"},
      {name:"Beef mince",qty:"150",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Dill",qty:"1",unit:"handful"},
      {name:"Sour cream",qty:"200",unit:"ml"},
      {name:"White wine vinegar",qty:"2",unit:"tbsp"},
      {name:"Butter",qty:"30",unit:"g"}
  ],
  steps:"1. Make stiff dough, rest 20 mins.\n2. Mix pork and beef mince with onion, garlic and dill.\n3. Roll dough thin, cut small circles.\n4. Fill and fold into half-moon, join tips to make round shape.\n5. Boil in salted water 5\u20136 mins.\n6. Serve with melted butter, sour cream and vinegar."
},
{
  id:'c_ru_3',
  name:"Shchi",
  category:"Soup",
  country:"Russia",
  serves:"6",
  desc:"Ancient Russian cabbage soup \u2014 made since the 9th century \u2014 with sauerkraut and pork.",
  cookTime:90,
  onePot:true,
  calories:340,
  ingredients:[
      {name:"Sauerkraut",qty:"400",unit:"g"},
      {name:"Pork ribs",qty:"500",unit:"g"},
      {name:"Potato",qty:"3",unit:""},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Bay leaves",qty:"2",unit:""},
      {name:"Allspice",qty:"4",unit:""},
      {name:"Sour cream",qty:"150",unit:"ml"},
      {name:"Dill",qty:"1",unit:"handful"},
      {name:"Beef stock",qty:"1.5",unit:"l"}
  ],
  steps:"1. Simmer pork ribs in stock 45 mins.\n2. Add sauerkraut and cook 20 mins.\n3. Add potato, carrot and onion.\n4. Add tomato pur\u00e9e, bay and allspice.\n5. Cook 30 more mins.\n6. Serve with sour cream and dill."
},
{
  id:'c_ru_4',
  name:"Solyanka",
  category:"Soup",
  country:"Russia",
  serves:"4",
  desc:"Rich, sour and smoky Russian meat soup with pickles, olives and lemon \u2014 deeply complex.",
  cookTime:50,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Mixed smoked meats",qty:"400",unit:"g"},
      {name:"Pickled gherkins",qty:"4",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Black olives",qty:"60",unit:"g"},
      {name:"Capers",qty:"2",unit:"tbsp"},
      {name:"Beef stock",qty:"1.2",unit:"l"},
      {name:"Butter",qty:"20",unit:"g"},
      {name:"Sour cream",qty:"150",unit:"ml"},
      {name:"Lemon",qty:"1",unit:""},
      {name:"Dill",qty:"1",unit:"handful"}
  ],
  steps:"1. Fry onion in butter, add tomatoes and pur\u00e9e.\n2. Add stock, smoked meats and chopped gherkins.\n3. Simmer 30 mins.\n4. Add olives and capers.\n5. Season \u2014 should be sour and smoky.\n6. Serve with sour cream, lemon slice and dill."
},
{
  id:'c_ru_5',
  name:"Plov",
  category:"Asian",
  country:"Russia",
  serves:"6",
  desc:"Central Asian pilaf with lamb, rice and carrots \u2014 perfumed with cumin and barberries.",
  cookTime:90,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Lamb shoulder",qty:"700",unit:"g"},
      {name:"Basmati rice",qty:"450",unit:"g"},
      {name:"Carrot",qty:"4",unit:""},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic head",qty:"1",unit:""},
      {name:"Barberries or raisins",qty:"3",unit:"tbsp"},
      {name:"Cumin seeds",qty:"2",unit:"tsp"},
      {name:"Coriander seeds",qty:"1",unit:"tsp"},
      {name:"Vegetable oil",qty:"100",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tbsp"}
  ],
  steps:"1. Heat oil until smoking, brown lamb pieces.\n2. Add onion, fry until golden.\n3. Add julienned carrot, cook 10 mins.\n4. Season with cumin and coriander.\n5. Add washed rice, level flat. Press whole garlic head in centre.\n6. Add hot water to cover 3cm above rice. Cook on high until water absorbed, then very low 25 mins."
},
{
  id:'c_ir_1',
  name:"Ghormeh Sabzi",
  category:"Meat",
  country:"Iran",
  serves:"4",
  desc:"Iran's national dish \u2014 slow-braised lamb with dried limes, kidney beans and a mountain of herbs.",
  cookTime:120,
  onePot:true,
  calories:560,
  ingredients:[
      {name:"Lamb shoulder",qty:"600",unit:"g"},
      {name:"Dried limes (limoo amani)",qty:"4",unit:""},
      {name:"Kidney beans",qty:"200",unit:"g"},
      {name:"Fenugreek leaves",qty:"4",unit:"tbsp"},
      {name:"Parsley",qty:"2",unit:"bunches"},
      {name:"Coriander",qty:"1",unit:"bunch"},
      {name:"Spring onions",qty:"1",unit:"bunch"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Turmeric",qty:"1",unit:"tsp"},
      {name:"Vegetable oil",qty:"4",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Fry chopped herb mixture (parsley, coriander, fenugreek) in oil until very dark and fragrant.\n2. Brown lamb with onion and turmeric.\n3. Pierce dried limes, add to pot with kidney beans.\n4. Add fried herbs and enough water to cover.\n5. Simmer covered 1.5 hrs until lamb is very tender.\n6. Adjust seasoning, serve with Persian rice."
},
{
  id:'c_ir_2',
  name:"Fesenjan",
  category:"Meat",
  country:"Iran",
  serves:"4",
  desc:"Persian walnut and pomegranate molasses duck stew \u2014 sweet, sour and deeply complex.",
  cookTime:90,
  onePot:true,
  calories:640,
  ingredients:[
      {name:"Duck legs or chicken",qty:"4",unit:""},
      {name:"Walnuts",qty:"300",unit:"g"},
      {name:"Pomegranate molasses",qty:"4",unit:"tbsp"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Cardamom",qty:"0.25",unit:"tsp"},
      {name:"Sugar",qty:"1",unit:"tbsp"},
      {name:"Chicken stock",qty:"300",unit:"ml"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Grind walnuts very finely in food processor.\n2. Fry onion in butter, add ground walnuts.\n3. Add stock, bring to simmer.\n4. Add pomegranate molasses, cinnamon and cardamom.\n5. Add browned duck or chicken.\n6. Simmer 1 hour, adjusting sweet-sour balance with sugar and molasses."
},
{
  id:'c_ir_3',
  name:"Ash Reshteh",
  category:"Soup",
  country:"Iran",
  serves:"6",
  desc:"Persian New Year noodle and herb soup with seven legumes and kashk \u2014 thick and fortifying.",
  cookTime:80,
  onePot:true,
  calories:420,
  ingredients:[
      {name:"Persian noodles or linguine",qty:"200",unit:"g"},
      {name:"Chickpeas",qty:"100",unit:"g"},
      {name:"Kidney beans",qty:"100",unit:"g"},
      {name:"Lentils",qty:"100",unit:"g"},
      {name:"Spinach",qty:"200",unit:"g"},
      {name:"Parsley",qty:"1",unit:"bunch"},
      {name:"Fenugreek",qty:"3",unit:"tbsp"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Kashk or sour cream",qty:"150",unit:"ml"},
      {name:"Turmeric",qty:"1",unit:"tsp"},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Fried onion and mint in oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Cook legumes until tender.\n2. Fry onion with turmeric and cinnamon.\n3. Add herbs, legumes and 1.5l water, simmer 30 mins.\n4. Add noodles and spinach, cook 10 mins.\n5. Blend small amount to thicken.\n6. Top with kashk, fried onion and dried mint in butter."
},
{
  id:'c_ir_4',
  name:"Joojeh Kabab",
  category:"Meat",
  country:"Iran",
  serves:"4",
  desc:"Saffron and lemon marinated chicken skewers \u2014 Iranian outdoor grilling at its most elegant.",
  cookTime:30,
  onePot:false,
  calories:420,
  ingredients:[
      {name:"Chicken pieces",qty:"1",unit:"kg"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Lemon juice",qty:"4",unit:"tbsp"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Yoghurt",qty:"150",unit:"ml"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Pepper",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Dissolve saffron in 2 tbsp hot water.\n2. Mix with lemon juice, grated onion, yoghurt and seasoning.\n3. Marinate chicken at least 4 hours.\n4. Thread onto skewers.\n5. Grill on high heat, basting with saffron butter.\n6. Serve with Persian rice, grilled tomatoes and fresh herbs."
},
{
  id:'c_ir_5',
  name:"Tahdig",
  category:"Vegetarian",
  country:"Iran",
  serves:"4",
  desc:"Crispy saffron rice crust \u2014 the most prized part of any Iranian meal, a national obsession.",
  cookTime:45,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Basmati rice",qty:"400",unit:"g"},
      {name:"Saffron",qty:"0.5",unit:"tsp"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Lavash bread or thin flatbread",qty:"2",unit:"sheets"},
      {name:"Salt",qty:"1",unit:"tbsp"},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Rinse rice, parboil in salted water 6 mins, drain.\n2. Dissolve saffron in warm water.\n3. Heat oil and butter in heavy-bottomed pot.\n4. Line bottom with lavash bread.\n5. Pile rice on top, pour saffron over.\n6. Cover with tea towel and lid, cook on high 2 mins then lowest heat 30 mins. Flip out to serve crust-side up."
},
{
  id:'c_id_1',
  name:"Rendang",
  category:"Meat",
  country:"Indonesia",
  serves:"6",
  desc:"Legendary Minangkabau dry beef curry cooked in coconut milk and spices for hours.",
  cookTime:180,
  onePot:true,
  calories:680,
  ingredients:[
      {name:"Beef chuck",qty:"800",unit:"g"},
      {name:"Coconut milk",qty:"800",unit:"ml"},
      {name:"Lemongrass",qty:"4",unit:"stalks"},
      {name:"Galangal",qty:"5",unit:"slices"},
      {name:"Lime leaves",qty:"8",unit:""},
      {name:"Turmeric leaf",qty:"1",unit:""},
      {name:"Toasted coconut (kerisik)",qty:"60",unit:"g"},
      {name:"Shallots",qty:"6",unit:""},
      {name:"Garlic",qty:"5",unit:"cloves"},
      {name:"Ginger",qty:"2",unit:"tsp"},
      {name:"Dried chilli",qty:"10",unit:""},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Blend shallots, garlic, ginger and chilli into paste.\n2. Fry paste with bruised lemongrass, galangal and lime leaves.\n3. Add beef and coconut milk, bring to boil.\n4. Simmer uncovered 3+ hours, stirring occasionally.\n5. When liquid evaporates, oil separates and beef fries in it.\n6. Add kerisik, keep cooking until beef is very dark and dry."
},
{
  id:'c_id_2',
  name:"Nasi Goreng",
  category:"Asian",
  country:"Indonesia",
  serves:"4",
  desc:"Indonesia's iconic fried rice with kecap manis, shrimp paste and fried egg \u2014 the national dish.",
  cookTime:25,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Cooked rice",qty:"600",unit:"g"},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Chicken breast",qty:"200",unit:"g"},
      {name:"Prawns",qty:"150",unit:"g"},
      {name:"Kecap manis",qty:"3",unit:"tbsp"},
      {name:"Shrimp paste (belacan)",qty:"1",unit:"tsp"},
      {name:"Shallots",qty:"4",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Red chilli",qty:"2",unit:""},
      {name:"Spring onions",qty:"3",unit:""},
      {name:"Cucumber",qty:"0.5",unit:""},
      {name:"Vegetable oil",qty:"3",unit:"tbsp"}
  ],
  steps:"1. Blend shallots, garlic, chilli and shrimp paste.\n2. Fry paste in oil until very fragrant.\n3. Add chicken and prawns, cook 3 mins.\n4. Add cold rice, stir-fry on high heat.\n5. Add kecap manis, toss until combined.\n6. Serve with fried egg, cucumber and spring onions."
},
{
  id:'c_id_3',
  name:"Soto Ayam",
  category:"Soup",
  country:"Indonesia",
  serves:"4",
  desc:"Fragrant turmeric chicken broth with glass noodles, hard-boiled egg and crispy shallots.",
  cookTime:50,
  onePot:true,
  calories:400,
  ingredients:[
      {name:"Chicken pieces",qty:"800",unit:"g"},
      {name:"Glass noodles",qty:"150",unit:"g"},
      {name:"Lemongrass",qty:"3",unit:"stalks"},
      {name:"Galangal",qty:"3",unit:"slices"},
      {name:"Turmeric",qty:"1",unit:"tsp"},
      {name:"Ginger",qty:"1",unit:"tsp"},
      {name:"Shallots",qty:"5",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Lime leaves",qty:"6",unit:""},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Bean sprouts",qty:"150",unit:"g"},
      {name:"Celery leaves",qty:"1",unit:"handful"}
  ],
  steps:"1. Simmer chicken with aromatics 35 mins, shred meat.\n2. Strain broth, season.\n3. Blend fried shallots, garlic, turmeric, ginger into paste, fry and add to broth.\n4. Soak glass noodles.\n5. Hard boil eggs, peel.\n6. Serve broth over noodles with chicken, egg, sprouts and crispy shallots."
},
{
  id:'c_id_4',
  name:"Gado Gado",
  category:"Vegetarian",
  country:"Indonesia",
  serves:"4",
  desc:"Indonesian salad of blanched vegetables with rich peanut sauce \u2014 satisfying and vibrant.",
  cookTime:30,
  onePot:false,
  calories:440,
  ingredients:[
      {name:"Peanut butter",qty:"150",unit:"g"},
      {name:"Coconut milk",qty:"100",unit:"ml"},
      {name:"Lime juice",qty:"2",unit:"tbsp"},
      {name:"Kecap manis",qty:"1",unit:"tbsp"},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Chilli",qty:"1",unit:""},
      {name:"Tofu",qty:"200",unit:"g"},
      {name:"Egg",qty:"4",unit:""},
      {name:"Potato",qty:"2",unit:""},
      {name:"Green beans",qty:"150",unit:"g"},
      {name:"Bean sprouts",qty:"100",unit:"g"},
      {name:"Cucumber",qty:"1",unit:""},
      {name:"Cabbage",qty:"150",unit:"g"}
  ],
  steps:"1. Make peanut sauce: blend peanut butter, coconut milk, lime, kecap manis, garlic and chilli.\n2. Boil potatoes and green beans separately.\n3. Fry tofu until golden.\n4. Hard boil eggs.\n5. Arrange all vegetables on a plate.\n6. Pour peanut sauce generously over everything."
},
{
  id:'c_id_5',
  name:"Ikan Bakar",
  category:"Fish",
  country:"Indonesia",
  serves:"4",
  desc:"Indonesian grilled fish in spicy sambal and banana leaf \u2014 the taste of the archipelago.",
  cookTime:35,
  onePot:false,
  calories:380,
  ingredients:[
      {name:"Whole snapper or sea bass",qty:"2",unit:""},
      {name:"Sambal oelek",qty:"3",unit:"tbsp"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Shallots",qty:"4",unit:""},
      {name:"Lemongrass",qty:"2",unit:"stalks"},
      {name:"Lime juice",qty:"3",unit:"tbsp"},
      {name:"Kecap manis",qty:"2",unit:"tbsp"},
      {name:"Coconut oil",qty:"2",unit:"tbsp"},
      {name:"Banana leaves",qty:"4",unit:"sheets"},
      {name:"Turmeric",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Score fish on both sides.\n2. Blend sambal, garlic, shallots, lemongrass and turmeric.\n3. Rub fish inside and out with sambal paste.\n4. Marinate 30 mins.\n5. Wrap in banana leaves and grill or roast 20 mins.\n6. Serve with kecap manis, lime and steamed rice."
},
{
  id:'c_pl_1',
  name:"Bigos",
  category:"Meat",
  country:"Poland",
  serves:"6",
  desc:"Hunter's stew \u2014 Poland's national dish of slow-braised sauerkraut, mixed meats and dried mushrooms.",
  cookTime:120,
  onePot:true,
  calories:520,
  ingredients:[
      {name:"Sauerkraut",qty:"500",unit:"g"},
      {name:"Fresh cabbage",qty:"200",unit:"g"},
      {name:"Pork shoulder",qty:"300",unit:"g"},
      {name:"Kielbasa sausage",qty:"250",unit:"g"},
      {name:"Bacon",qty:"150",unit:"g"},
      {name:"Dried porcini mushrooms",qty:"30",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Red wine",qty:"150",unit:"ml"},
      {name:"Bay leaves",qty:"3",unit:""},
      {name:"Allspice",qty:"4",unit:""},
      {name:"Juniper berries",qty:"4",unit:""}
  ],
  steps:"1. Soak mushrooms 30 mins, reserve liquid.\n2. Fry bacon and onion, add diced pork and sausage.\n3. Add sauerkraut, fresh cabbage, mushrooms and liquid.\n4. Add wine, tomato pur\u00e9e and spices.\n5. Simmer covered 1.5 hrs, stirring occasionally.\n6. Tastes better the next day \u2014 reheat to serve."
},
{
  id:'c_pl_2',
  name:"\u017burek",
  category:"Soup",
  country:"Poland",
  serves:"4",
  desc:"Sour rye soup with hard-boiled egg, smoked sausage and horseradish \u2014 unique and deeply satisfying.",
  cookTime:45,
  onePot:true,
  calories:400,
  ingredients:[
      {name:"Sour rye starter (\u017cur) or ready sour rye",qty:"500",unit:"ml"},
      {name:"Smoked kielbasa",qty:"250",unit:"g"},
      {name:"Potato",qty:"3",unit:""},
      {name:"Eggs",qty:"4",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Horseradish",qty:"2",unit:"tbsp"},
      {name:"Marjoram",qty:"1",unit:"tsp"},
      {name:"Chicken stock",qty:"600",unit:"ml"},
      {name:"Sour cream",qty:"100",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Simmer kielbasa slices and potatoes in stock.\n2. Add sour rye liquid, garlic and marjoram.\n3. Simmer 20 mins, season with salt and horseradish.\n4. Hard boil eggs separately, peel and halve.\n5. Place egg in bowl, ladle hot soup over.\n6. Swirl in sour cream, season with more horseradish."
},
{
  id:'c_pl_3',
  name:"Kotlet Schabowy",
  category:"Meat",
  country:"Poland",
  serves:"4",
  desc:"Polish pork schnitzel \u2014 breaded pork chop fried until golden, served with sauerkraut.",
  cookTime:25,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Pork loin chops",qty:"4",unit:""},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Breadcrumbs",qty:"100",unit:"g"},
      {name:"Plain flour",qty:"60",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Pepper",qty:"0.5",unit:"tsp"},
      {name:"Vegetable oil",qty:"5",unit:"tbsp"},
      {name:"Sauerkraut",qty:"300",unit:"g"},
      {name:"Potato",qty:"4",unit:""}
  ],
  steps:"1. Pound pork chops thin.\n2. Season, dust in flour, dip in egg, coat in breadcrumbs.\n3. Pan fry in oil 4 mins each side until golden.\n4. Drain on paper.\n5. Boil potatoes.\n6. Serve with sauerkraut and boiled potatoes."
},
{
  id:'c_pl_4',
  name:"Pierogi Ruskie",
  category:"Vegetarian",
  country:"Poland",
  serves:"4",
  desc:"Boiled potato and cheese dumplings served with fried onion and sour cream \u2014 Poland's comfort food.",
  cookTime:60,
  onePot:false,
  calories:520,
  ingredients:[
      {name:"Plain flour",qty:"400",unit:"g"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Potato",qty:"500",unit:"g"},
      {name:"Twar\u00f3g (curd cheese) or cottage cheese",qty:"200",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Sour cream",qty:"150",unit:"ml"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Make dough, rest 30 mins.\n2. Mash potato with cheese and salt.\n3. Roll dough, cut circles, fill with potato, fold and pinch.\n4. Boil in salted water until they float plus 2 mins.\n5. Fry caramelised onions in butter.\n6. Pour over pierogi, serve with sour cream."
},
{
  id:'c_pl_5',
  name:"Go\u0142\u0105bki",
  category:"Meat",
  country:"Poland",
  serves:"6",
  desc:"Stuffed cabbage rolls in tomato sauce \u2014 identical soul food to Ukrainian holubtsi, separately evolved.",
  cookTime:90,
  onePot:true,
  calories:460,
  ingredients:[
      {name:"Cabbage",qty:"1",unit:"head"},
      {name:"Beef mince",qty:"500",unit:"g"},
      {name:"Rice",qty:"150",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Sour cream",qty:"200",unit:"ml"},
      {name:"Carrot",qty:"1",unit:""},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Marjoram",qty:"1",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Blanch cabbage leaves, remove thick stems.\n2. Mix beef with par-cooked rice, onion, garlic, marjoram.\n3. Roll filling in leaves.\n4. Place rolls in pot, mix tomatoes, sour cream and pur\u00e9e, pour over.\n5. Simmer covered 1 hour on low heat.\n6. Serve with sour cream and bread."
},
{
  id:'c_za_1',
  name:"Braai Lamb Chops",
  category:"Meat",
  country:"South Africa",
  serves:"4",
  desc:"Butterflied lamb chops marinated in garlic and rosemary and grilled over hot coals \u2014 the South African braai essential.",
  cookTime:20,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Lamb loin chops",qty:"8",unit:""},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Rosemary",qty:"3",unit:"sprigs"},
      {name:"Olive oil",qty:"4",unit:"tbsp"},
      {name:"Lemon juice",qty:"2",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tbsp"},
      {name:"Black pepper",qty:"1",unit:"tsp"}
  ],
  steps:"1. Flatten chops slightly.\n2. Crush garlic with salt, mix with rosemary, oil and lemon.\n3. Rub marinade into chops.\n4. Leave 1\u20132 hours.\n5. Grill over hot coals 3\u20134 mins per side.\n6. Rest 5 mins, serve with pap or potato salad."
},
{
  id:'c_za_2',
  name:"Bobotie",
  category:"Meat",
  country:"South Africa",
  serves:"4",
  desc:"Cape Malay spiced beef mince with a golden egg custard topping \u2014 a flavour of the Cape.",
  cookTime:60,
  onePot:false,
  calories:560,
  ingredients:[
      {name:"Beef mince",qty:"600",unit:"g"},
      {name:"Onion",qty:"2",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Curry powder",qty:"2",unit:"tsp"},
      {name:"Turmeric",qty:"0.5",unit:"tsp"},
      {name:"Apricot jam",qty:"2",unit:"tbsp"},
      {name:"Chutney",qty:"2",unit:"tbsp"},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Milk",qty:"200",unit:"ml"},
      {name:"Bread",qty:"2",unit:"slices"},
      {name:"Raisins",qty:"40",unit:"g"},
      {name:"Almonds",qty:"30",unit:"g"},
      {name:"Bay leaves",qty:"3",unit:""}
  ],
  steps:"1. Soak bread in milk, squeeze and reserve milk.\n2. Fry onion and garlic with spices.\n3. Add mince, brown well.\n4. Add jam, chutney, raisins, almonds and bread.\n5. Press into dish, insert bay leaves.\n6. Mix eggs with reserved milk, pour over, bake at 180\u00b0C for 35 mins."
},
{
  id:'c_za_3',
  name:"Potjiekos",
  category:"Meat",
  country:"South Africa",
  serves:"6",
  desc:"Slow-cooked three-legged pot stew with lamb, vegetables and beer \u2014 outdoor South African cooking.",
  cookTime:180,
  onePot:true,
  calories:620,
  ingredients:[
      {name:"Lamb shoulder",qty:"800",unit:"g"},
      {name:"Sweet potato",qty:"2",unit:""},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Potato",qty:"2",unit:""},
      {name:"Baby onions",qty:"200",unit:"g"},
      {name:"Green beans",qty:"150",unit:"g"},
      {name:"Beer",qty:"330",unit:"ml"},
      {name:"Beef stock",qty:"300",unit:"ml"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Apricot chutney",qty:"3",unit:"tbsp"},
      {name:"Thyme",qty:"3",unit:"sprigs"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Brown lamb in pot over fire.\n2. Layer vegetables on top (do not stir \u2014 layer method).\n3. Add beer, stock, garlic and chutney.\n4. Cover tightly and cook over low coals 2.5 hrs.\n5. The layering and slow steam is the magic \u2014 never stir.\n6. Serve directly from the pot."
},
{
  id:'c_za_4',
  name:"Braaibroodjie",
  category:"Vegetarian",
  country:"South Africa",
  serves:"4",
  desc:"Toasted cheese, tomato and onion sandwiches on the braai \u2014 the most beloved South African side.",
  cookTime:15,
  onePot:false,
  calories:380,
  ingredients:[
      {name:"White bread",qty:"8",unit:"slices"},
      {name:"Cheddar cheese",qty:"200",unit:"g"},
      {name:"Tomatoes",qty:"3",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Butter",qty:"50",unit:"g"},
      {name:"Mrs Balls chutney",qty:"4",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Butter one side of each slice.\n2. Spread chutney on unbuttered side.\n3. Layer cheese, sliced tomato and onion.\n4. Close sandwiches butter-side out.\n5. Grill over medium coals 3 mins each side.\n6. Serve immediately \u2014 must be eaten at the braai."
},
{
  id:'c_za_5',
  name:"Umngqusho",
  category:"Vegetarian",
  country:"South Africa",
  serves:"4",
  desc:"Broken corn and sugar beans stew \u2014 a staple dish of the Xhosa people and Nelson Mandela's favourite.",
  cookTime:90,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Samp (broken hominy corn)",qty:"300",unit:"g"},
      {name:"Sugar beans",qty:"200",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Black pepper",qty:"0.5",unit:"tsp"}
  ],
  steps:"1. Soak samp and beans overnight together.\n2. Drain, cover with fresh water.\n3. Bring to boil, simmer 2 hours until both are tender.\n4. Fry onion and garlic in butter.\n5. Add to cooked samp and beans, season well.\n6. Serve as a main with chakalaka or braai meat."
},
{
  id:'c_at_1',
  name:"Wiener Schnitzel",
  category:"Meat",
  country:"Austria",
  serves:"4",
  desc:"The original \u2014 thinly pounded veal in breadcrumbs fried in clarified butter until puffed and golden.",
  cookTime:25,
  onePot:false,
  calories:620,
  ingredients:[
      {name:"Veal escalopes",qty:"4",unit:""},
      {name:"Eggs",qty:"2",unit:""},
      {name:"Breadcrumbs",qty:"100",unit:"g"},
      {name:"Plain flour",qty:"60",unit:"g"},
      {name:"Clarified butter",qty:"150",unit:"g"},
      {name:"Lemon",qty:"2",unit:""},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Parsley",qty:"1",unit:"sprig"}
  ],
  steps:"1. Pound veal to 4mm thickness.\n2. Season, dust in flour, coat in beaten egg, then breadcrumbs (loosely \u2014 do not press).\n3. Fry in generous clarified butter at 160\u00b0C, swirling pan so butter covers.\n4. Cook 2 mins each side until golden and puffed.\n5. Drain on paper.\n6. Serve with lemon wedge and potato salad or lingonberry jam."
},
{
  id:'c_at_2',
  name:"Tafelspitz",
  category:"Meat",
  country:"Austria",
  serves:"4",
  desc:"Emperor Franz Joseph's favourite \u2014 boiled beef rump in clear broth served with horseradish apple sauce.",
  cookTime:100,
  onePot:true,
  calories:480,
  ingredients:[
      {name:"Beef rump or silverside",qty:"1",unit:"kg"},
      {name:"Bone marrow",qty:"2",unit:"pieces"},
      {name:"Carrot",qty:"2",unit:""},
      {name:"Celeriac",qty:"0.5",unit:""},
      {name:"Onion",qty:"1",unit:""},
      {name:"Parsley root",qty:"2",unit:""},
      {name:"Leek",qty:"1",unit:""},
      {name:"Bay leaves",qty:"2",unit:""},
      {name:"Peppercorns",qty:"10",unit:""},
      {name:"Horseradish",qty:"3",unit:"tbsp"},
      {name:"Apple",qty:"1",unit:""},
      {name:"Sour cream",qty:"100",unit:"ml"}
  ],
  steps:"1. Bring water to boil with all vegetables and spices.\n2. Add beef, simmer gently 1.5 hrs.\n3. Remove beef, strain broth.\n4. Slice beef against grain.\n5. Mix grated horseradish with grated apple and sour cream.\n6. Serve beef in broth with horseradish sauce, roast potatoes and spinach."
},
{
  id:'c_at_3',
  name:"Goulash",
  category:"Meat",
  country:"Austria",
  serves:"6",
  desc:"Viennese paprika beef stew \u2014 darker and richer than the Hungarian original, served with bread dumplings.",
  cookTime:120,
  onePot:true,
  calories:580,
  ingredients:[
      {name:"Beef chuck",qty:"800",unit:"g"},
      {name:"Onion",qty:"4",unit:""},
      {name:"Sweet paprika",qty:"4",unit:"tbsp"},
      {name:"Caraway seeds",qty:"1",unit:"tsp"},
      {name:"Marjoram",qty:"1",unit:"tsp"},
      {name:"Garlic",qty:"3",unit:"cloves"},
      {name:"Tomato pur\u00e9e",qty:"2",unit:"tbsp"},
      {name:"Beef stock",qty:"400",unit:"ml"},
      {name:"Red wine vinegar",qty:"1",unit:"tbsp"},
      {name:"Lard or oil",qty:"3",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Fry large amount of onion in lard until very deep golden \u2014 this is key.\n2. Add paprika and caraway, cook 1 min.\n3. Add beef cubes, tomato pur\u00e9e, garlic and marjoram.\n4. Add just enough stock to barely cover.\n5. Simmer covered 1.5\u20132 hrs.\n6. Sauce should be thick and glossy. Serve with semmel kn\u00f6del."
},
{
  id:'c_at_4',
  name:"Zwiebelrostbraten",
  category:"Meat",
  country:"Austria",
  serves:"4",
  desc:"Roast sirloin with crispy onion rings in a dark beer gravy \u2014 a Viennese pub classic.",
  cookTime:35,
  onePot:false,
  calories:640,
  ingredients:[
      {name:"Beef sirloin steaks",qty:"4",unit:""},
      {name:"Onion",qty:"3",unit:""},
      {name:"Flour",qty:"4",unit:"tbsp"},
      {name:"Dark beer",qty:"200",unit:"ml"},
      {name:"Beef stock",qty:"200",unit:"ml"},
      {name:"Butter",qty:"40",unit:"g"},
      {name:"Caraway seeds",qty:"0.5",unit:"tsp"},
      {name:"Marjoram",qty:"0.5",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Vegetable oil",qty:"4",unit:"tbsp"}
  ],
  steps:"1. Dust onion rings in flour, fry until very crispy. Set aside.\n2. Pan-fry steaks to desired doneness. Rest.\n3. Deglaze pan with beer and stock.\n4. Add caraway and marjoram, reduce by half.\n5. Swirl in butter for gloss.\n6. Plate steak topped with crispy onions and dark gravy."
},
{
  id:'c_at_5',
  name:"Kaspresskn\u00f6del Suppe",
  category:"Soup",
  country:"Austria",
  serves:"4",
  desc:"Tyrolean cheese dumplings floating in clear beef broth \u2014 rustic Alpine comfort.",
  cookTime:45,
  onePot:true,
  calories:440,
  ingredients:[
      {name:"Stale bread",qty:"200",unit:"g"},
      {name:"Mountain cheese (Bergk\u00e4se or Gruy\u00e8re)",qty:"150",unit:"g"},
      {name:"Eggs",qty:"3",unit:""},
      {name:"Milk",qty:"100",unit:"ml"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Chives",qty:"1",unit:"bunch"},
      {name:"Beef broth",qty:"1.2",unit:"l"},
      {name:"Butter",qty:"20",unit:"g"},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cube stale bread, soak in warm milk.\n2. Fry onion in butter until soft.\n3. Mix bread with eggs, cheese, onion, chives and nutmeg.\n4. Form into flat discs.\n5. Pan-fry dumplings in butter until golden on both sides.\n6. Serve floating in hot clear beef broth."
},
{
  id:'c_eg_1',
  name:"Kushari",
  category:"Vegetarian",
  country:"Egypt",
  serves:"4",
  desc:"Cairo's national street food \u2014 rice, lentils and macaroni with crispy onion and spicy tomato sauce.",
  cookTime:50,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Basmati rice",qty:"200",unit:"g"},
      {name:"Brown lentils",qty:"150",unit:"g"},
      {name:"Macaroni",qty:"150",unit:"g"},
      {name:"Vermicelli",qty:"50",unit:"g"},
      {name:"Onion",qty:"3",unit:""},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"White vinegar",qty:"3",unit:"tbsp"},
      {name:"Cumin",qty:"2",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Chilli",qty:"1",unit:""},
      {name:"Vegetable oil",qty:"6",unit:"tbsp"}
  ],
  steps:"1. Cook lentils, rice and pasta separately.\n2. Mix rice with browned vermicelli.\n3. Deep-fry onion rings until very crispy (dakka).\n4. Make tomato sauce with garlic, cumin, vinegar and chilli.\n5. Layer lentils, rice mix, then macaroni in bowl.\n6. Top with crispy onions and tomato sauce."
},
{
  id:'c_eg_2',
  name:"Ful Medames",
  category:"Vegetarian",
  country:"Egypt",
  serves:"4",
  desc:"Slow-cooked fava beans with lemon, garlic and cumin \u2014 Egypt's most ancient and daily breakfast-dinner.",
  cookTime:30,
  onePot:true,
  calories:320,
  ingredients:[
      {name:"Fava beans (dried or tinned)",qty:"400",unit:"g"},
      {name:"Garlic",qty:"4",unit:"cloves"},
      {name:"Lemon juice",qty:"3",unit:"tbsp"},
      {name:"Cumin",qty:"2",unit:"tsp"},
      {name:"Olive oil",qty:"5",unit:"tbsp"},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Tomatoes",qty:"2",unit:""},
      {name:"Egg",qty:"4",unit:""},
      {name:"Salt",qty:"1",unit:"tsp"},
      {name:"Flatbread",qty:"4",unit:""}
  ],
  steps:"1. If dried, soak and cook beans 2 hours. If tinned, drain.\n2. Mash beans roughly with lemon juice, garlic and cumin.\n3. Heat in pan, add olive oil generously.\n4. Fry or hard boil eggs separately.\n5. Top beans with chopped tomato, parsley and extra olive oil.\n6. Serve with flatbread and fried egg."
},
{
  id:'c_eg_3',
  name:"Hawawshi",
  category:"Meat",
  country:"Egypt",
  serves:"4",
  desc:"Egyptian spiced minced meat stuffed in bread and grilled in a cast iron pan \u2014 Alexandria's street food.",
  cookTime:35,
  onePot:false,
  calories:540,
  ingredients:[
      {name:"Beef and lamb mince mix",qty:"500",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Green pepper",qty:"1",unit:""},
      {name:"Red pepper",qty:"1",unit:""},
      {name:"Parsley",qty:"1",unit:"handful"},
      {name:"Cumin",qty:"1",unit:"tsp"},
      {name:"Coriander",qty:"1",unit:"tsp"},
      {name:"Chilli",qty:"1",unit:""},
      {name:"Egyptian flatbread",qty:"4",unit:""},
      {name:"Olive oil",qty:"3",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Mix meat with finely chopped onion, peppers, parsley and spices.\n2. Stuff mixture between two layers of flatbread.\n3. Brush outside with olive oil.\n4. Cook in cast iron pan or griddle 5 mins each side.\n5. Cut into wedges.\n6. Serve with pickles and hot sauce."
},
{
  id:'c_eg_4',
  name:"Molokhia",
  category:"Meat",
  country:"Egypt",
  serves:"4",
  desc:"Silky jute leaf soup with rabbit or chicken \u2014 Egypt's green jewel with a unique gelatinous texture.",
  cookTime:50,
  onePot:true,
  calories:380,
  ingredients:[
      {name:"Frozen or fresh molokhia leaves",qty:"400",unit:"g"},
      {name:"Chicken pieces",qty:"800",unit:"g"},
      {name:"Garlic",qty:"6",unit:"cloves"},
      {name:"Coriander",qty:"2",unit:"tsp"},
      {name:"Chicken stock",qty:"1",unit:"l"},
      {name:"Butter",qty:"30",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Lemon juice",qty:"2",unit:"tbsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Simmer chicken in stock with onion until tender.\n2. Remove chicken, strain stock.\n3. Fry garlic with coriander in butter until golden and fragrant.\n4. Add molokhia leaves to hot stock, stir until dissolved and soup becomes viscous.\n5. Add garlic-coriander sizzle to soup.\n6. Serve over rice with chicken on the side and lemon."
},
{
  id:'c_eg_5',
  name:"Feseekh Macarona",
  category:"Pasta",
  country:"Egypt",
  serves:"4",
  desc:"Baked pasta with b\u00e9chamel \u2014 the Egyptian everyday pasta dish for celebrations.",
  cookTime:60,
  onePot:false,
  calories:580,
  ingredients:[
      {name:"Penne",qty:"400",unit:"g"},
      {name:"Beef mince",qty:"400",unit:"g"},
      {name:"Onion",qty:"1",unit:""},
      {name:"Garlic",qty:"2",unit:"cloves"},
      {name:"Chopped tomatoes",qty:"400",unit:"g"},
      {name:"Butter",qty:"60",unit:"g"},
      {name:"Plain flour",qty:"60",unit:"g"},
      {name:"Milk",qty:"500",unit:"ml"},
      {name:"Egg",qty:"2",unit:""},
      {name:"Cinnamon",qty:"0.5",unit:"tsp"},
      {name:"Nutmeg",qty:"0.25",unit:"tsp"},
      {name:"Salt",qty:"1",unit:"tsp"}
  ],
  steps:"1. Cook pasta, drain.\n2. Brown beef with onion, garlic, tomatoes and cinnamon.\n3. Make b\u00e9chamel with butter, flour and milk. Beat in eggs.\n4. Layer pasta, meat sauce, pasta in baking dish.\n5. Pour b\u00e9chamel over top.\n6. Bake at 190\u00b0C for 35 mins until golden."
}
];


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const API   = 'https://d1-template.exposurephotographer0.workers.dev';
const DAYS  = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UNIT OPTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UNIT_OPTIONS = [
  { value: '',          label: '‚Äî (single piece)' },
  { value: 'g',         label: 'g' },
  { value: 'kg',        label: 'kg' },
  { value: 'cup(s)',    label: 'cup(s)' },
  { value: 'ml',        label: 'ml' },
  { value: 'l',         label: 'l' },
  { value: 'tsp',       label: 'tsp' },
  { value: 'tbsp',      label: 'tbsp' },
  { value: 'tin(s)',    label: 'tin(s)' },
  { value: 'jar(s)',    label: 'jar(s)' },
  { value: 'pack(s)',   label: 'pack(s)' },
  { value: 'slice(s)',  label: 'slice(s)' },
  { value: 'cloves',    label: 'cloves' },
  { value: 'sprigs',    label: 'sprigs' },
  { value: 'sticks',    label: 'sticks' },
  { value: 'heads',     label: 'heads' },
  { value: 'handful',   label: 'handful' },
  { value: 'sheets',    label: 'sheets' },
  { value: 'stalks',    label: 'stalks' },
  { value: 'bunch',     label: 'bunch' },
  { value: '__other__', label: 'Other‚Ä¶' },
];

// Aliases map old/variant unit strings to canonical dropdown values
const UNIT_ALIASES = {
  'slices':'slice(s)', 'slice':'slice(s)',
  'tins':'tin(s)', 'tin':'tin(s)',
  'jars':'jar(s)', 'jar':'jar(s)',
  'packs':'pack(s)', 'pack':'pack(s)',
  'cups':'cup(s)', 'cup':'cup(s)',
  'clove':'cloves',
  'sprig':'sprigs',
  'stick':'sticks',
  'stalk':'stalks',
  'head':'heads',
  'sheet':'sheets',
  'loaf':'', // treat as single piece
  'pieces':'', 'piece':'',
};

// Normalize a unit string to canonical dropdown value (handling aliases)
function canonicalUnit(unit) {
  const s = (unit || '').trim();
  if (UNIT_ALIASES.hasOwnProperty(s.toLowerCase())) return UNIT_ALIASES[s.toLowerCase()];
  return s;
}

// Build a <select> options HTML from UNIT_OPTIONS, with a currently selected value
function buildUnitSelectHTML(selectedUnit) {
  const su = canonicalUnit(selectedUnit || '');
  const knownValues = UNIT_OPTIONS.filter(o => o.value !== '__other__').map(o => o.value);
  const isKnown = knownValues.includes(su);
  return UNIT_OPTIONS.map(opt => {
    const sel = (!isKnown && su && opt.value === '__other__') ? ' selected' : (opt.value === su ? ' selected' : '');
    return `<option value="${opt.value}"${sel}>${opt.label}</option>`;
  }).join('');
}

// Get the actual unit value from a unit select + other input pair
function getUnitValue(selectId, otherId) {
  const sel = document.getElementById(selectId);
  if (!sel) return '';
  if (sel.value === '__other__') {
    const other = document.getElementById(otherId);
    return other ? other.value.trim() : '';
  }
  return sel.value; // already canonical
}

// Set unit select + other input from a stored value
function setUnitSelect(selectId, otherId, value) {
  const sel = document.getElementById(selectId);
  if (!sel) return;
  const v = canonicalUnit(value || '');
  const knownValues = UNIT_OPTIONS.filter(o => o.value !== '__other__').map(o => o.value);
  if (knownValues.includes(v)) {
    sel.value = v;
    const other = document.getElementById(otherId);
    if (other) other.style.display = 'none';
  } else if (v) {
    sel.value = '__other__';
    const other = document.getElementById(otherId);
    if (other) { other.value = v; other.style.display = 'block'; }
  } else {
    sel.value = '';
    const other = document.getElementById(otherId);
    if (other) other.style.display = 'none';
  }
}

// Wire up "Other‚Ä¶" reveal for a select+other pair
function wireUnitSelect(selectId, otherId) {
  const sel = document.getElementById(selectId);
  const other = document.getElementById(otherId);
  if (!sel || !other) return;
  sel.addEventListener('change', () => {
    other.style.display = sel.value === '__other__' ? 'block' : 'none';
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INGREDIENT NAME NORMALISATION (singular/plural) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Returns a canonical lowercase key for an ingredient name so that
// "onion" and "onions" (etc.) map to the same bucket.
const IRREGULAR_PLURALS = {
  'tomatoes':'tomato','potatoes':'potato','leaves':'leaf','halves':'half',
  'loaves':'loaf','knives':'knife','shelves':'shelf',
};
function normalizeIngName(name) {
  const s = (name || '').toLowerCase().trim();
  if (IRREGULAR_PLURALS[s]) return IRREGULAR_PLURALS[s];
  // Strip common suffixes: -es, -s (but not -ss)
  if (s.endsWith('ies') && s.length > 4) return s.slice(0, -3) + 'y'; // berries‚Üíberry
  if (s.endsWith('oes') && s.length > 4) return s.slice(0, -2);       // tomatoes‚Üítomato
  if (s.endsWith('es') && s.length > 4 && !s.endsWith('ses') && !s.endsWith('xes') && !s.endsWith('zes') && !s.endsWith('ches') && !s.endsWith('shes')) return s.slice(0, -1); // cloves‚Üíclove (careful)
  if (s.endsWith('s') && s.length > 3 && !s.endsWith('ss')) return s.slice(0, -1);
  return s;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let state = { meals:{}, recipes:[], shoppingList:[], pantry:[] };
let editingDay = null, pickerDay = null;
let ingredientCount = 0, recIngCount = 0;
let editingRecipeId = null, editingPantryIdx = null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê API LAYER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function apiFetch(path, opts = {}) {
  const resp = await fetch(API + path, {
    headers: { 'Content-Type': 'application/json' },
    ...opts,
  });
  if (!resp.ok) {
    const body = await resp.text().catch(() => '');
    throw new Error(`Worker error ${resp.status} on ${path}: ${body}`);
  }
  return resp.json();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', async () => {
  // Wire up modal close-on-backdrop-click
  document.querySelectorAll('.modal-overlay').forEach(el => {
    el.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('open'); });
  });

  // Pre-populate pantry unit select
  const pantryUnitSel = document.getElementById('pantry-item-unit');
  if (pantryUnitSel) {
    pantryUnitSel.innerHTML = buildUnitSelectHTML('');
    wireUnitSelect('pantry-item-unit', 'pantry-item-unit-other');
  }

  showLoading(true);
  try {
    const [recipes, meals, pantry, shopping, deletedSeedIds] = await Promise.all([
      apiFetch('/api/recipes'),
      apiFetch('/api/meals'),
      apiFetch('/api/pantry'),
      apiFetch('/api/shopping'),
      apiFetch('/api/deleted-seeds').catch(() => []),
    ]);

    // Seed / sync recipes ‚Äî never re-add seeds the user has deliberately deleted
    const deletedSeedSet = new Set(deletedSeedIds);
    const ALL_SEED_RECIPES = [...DEFAULT_RECIPES, ...WORLD_RECIPES]
      .filter(r => !deletedSeedSet.has(r.id));
    if (!recipes.length) {
      // Fresh DB ‚Äî seed everything in batches
      for (let i = 0; i < ALL_SEED_RECIPES.length; i += 20) {
        await Promise.all(ALL_SEED_RECIPES.slice(i, i + 20).map(r =>
          apiFetch('/api/recipes', { method:'POST', body: JSON.stringify(r) })
        ));
      }
      state.recipes = ALL_SEED_RECIPES.map(r => ({...r}));
    } else {
      // DB has some recipes ‚Äî add any seeds that are genuinely missing (not deleted)
      const existingIds = new Set(recipes.map(r => r.id));
      const missing = ALL_SEED_RECIPES.filter(r => !existingIds.has(r.id));
      if (missing.length) {
        for (let i = 0; i < missing.length; i += 20) {
          await Promise.all(missing.slice(i, i + 20).map(r =>
            apiFetch('/api/recipes', { method:'POST', body: JSON.stringify(r) })
          ));
        }
        state.recipes = [...recipes, ...missing];
      } else {
        state.recipes = recipes;
      }
    }

    // meals comes back as {dayIndex: meal} with string keys ‚Äî normalise to numbers
    state.meals = {};
    Object.entries(meals).forEach(([k, v]) => { state.meals[Number(k)] = v; });

    state.pantry = pantry;

    // shopping: meals field comes from D1 as JSON string ‚Äî parse it
    state.shoppingList = shopping.map(s => ({
      ...s,
      meals: typeof s.meals === 'string' ? JSON.parse(s.meals) : (s.meals || []),
      checked: !!s.checked,
    }));

  } catch(e) {
    console.error(e);
    showGlobalError('Could not connect to your Cloudflare Worker: ' + e.message);
  } finally {
    showLoading(false);
  }

  renderWeek();
  applyRecipeFilters();
  renderShopping();
  renderPantry();
  updateBadges();

  // Restore last tab from URL hash
  const validViews = ['planner','recipes','shopping','pantry'];
  const hash = location.hash.replace('#','');
  if (validViews.includes(hash)) showView(hash);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UI HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showLoading(on) {
  document.getElementById('loading-overlay').style.display = on ? 'flex' : 'none';
}
function showGlobalError(msg) {
  const el = document.getElementById('global-error');
  el.textContent = msg;
  el.style.display = msg ? 'block' : 'none';
}
function showView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  const names = ['planner','recipes','shopping','pantry'];
  document.querySelectorAll('nav button').forEach((b,i) => b.classList.toggle('active', names[i] === name));
  location.hash = name;
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function updateBadges() {
  const shopCount = (state.shoppingList||[]).filter(i => !i.checked).length;
  const pantryCount = (state.pantry||[]).length;
  const recCount = (state.recipes||[]).length;
  const sb = document.getElementById('shop-badge');   sb.textContent = shopCount;   sb.style.display = shopCount   > 0 ? 'inline' : 'none';
  const pb = document.getElementById('pantry-badge'); pb.textContent = pantryCount; pb.style.display = pantryCount > 0 ? 'inline' : 'none';
  const rb = document.getElementById('rec-badge');    rb.textContent = recCount;    rb.style.display = recCount    > 0 ? 'inline' : 'none';
}
function collectIngredients(prefix) {
  const ings = [];
  document.querySelectorAll(`[id^="${prefix}-row-"]`).forEach(row => {
    const id = row.id.replace(`${prefix}-row-`, '');
    const n = document.getElementById(`${prefix}-name-${id}`);
    if (n && n.value.trim()) {
      // Support both old text inputs and new select+other pattern
      let unit = '';
      const selEl = document.getElementById(`${prefix}-unit-${id}`);
      if (selEl && selEl.tagName === 'SELECT') {
        unit = getUnitValue(`${prefix}-unit-${id}`, `${prefix}-unit-other-${id}`);
      } else if (selEl) {
        unit = selEl.value.trim();
      }
      const ingObj = {
        name: n.value.trim(),
        qty:  (document.getElementById(`${prefix}-qty-${id}`)?.value  || '').trim(),
        unit,
      };
      // Collect calories if present (ring prefix = recipe ingredient rows)
      const calEl = document.getElementById(`${prefix}-cal-${id}`);
      if (calEl) {
        const calVal = parseFloat(calEl.value);
        if (!isNaN(calVal) && calVal > 0) ingObj.calories = calVal;
      }
      ings.push(ingObj);
    }
  });
  return ings;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WEEK PLANNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let dragSourceDay = null;

function renderWeek() {
  const grid = document.getElementById('week-grid');
  grid.innerHTML = '';
  DAYS.forEach((day, i) => {
    const meal = state.meals[i];
    const card = document.createElement('div');
    card.className = 'day-card';
    card.dataset.dayIndex = i;

    // Only allow drag if meal exists
    if (meal) {
      card.setAttribute('draggable', 'true');
      card.addEventListener('dragstart', e => {
        dragSourceDay = i;
        card.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', String(i));
      });
      card.addEventListener('dragend', () => {
        card.classList.remove('dragging');
        dragSourceDay = null;
      });
    }

    card.addEventListener('dragover', e => {
      if (dragSourceDay === null || dragSourceDay === i) return;
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      card.classList.add('drag-over');
    });
    card.addEventListener('dragleave', () => card.classList.remove('drag-over'));
    card.addEventListener('drop', e => {
      e.preventDefault();
      card.classList.remove('drag-over');
      if (dragSourceDay === null || dragSourceDay === i) return;
      swapMeals(dragSourceDay, i);
    });

    card.innerHTML = `
      <div class="day-label">${day}</div>
      <div class="day-meal ${meal ? '' : 'empty'}">${meal ? meal.name : 'No meal planned'}</div>
      ${meal ? `<div style="font-size:0.73rem;color:var(--text-muted)">${(meal.ingredients||[]).length} ingredient${(meal.ingredients||[]).length !== 1 ? 's' : ''}</div>` : ''}
      ${meal && meal.recipeId ? (() => { const rec = state.recipes.find(r => r.id === meal.recipeId); const badges = []; if (rec && rec.calories) badges.push(`<div class="day-cal-badge">üî• ${rec.calories} kcal</div>`); const tc = rec ? calcTotalCost(rec) : 0; if (tc) { const sv = parseInt(rec.serves)||4; badges.push(`<div class="day-cost-badge">üí∑ ¬£${(tc/sv).toFixed(2)}/portion</div>`); } return badges.join(''); })() : ''}
      <div class="day-actions">
        ${!meal
          ? `<button class="btn-sm" onclick="openPickerModal(${i})">+ Add</button>
             <button class="ai-btn" onclick="aiSuggestDay(${i})" title="AI suggestions" style="font-size:0.65rem;padding:4px 8px">‚ú®</button>`
          : `<button class="btn-sm" onclick="openPickerModal(${i})">Change</button>
             <button class="btn-sm" onclick="openMealModal(${i})">Edit</button>
             ${meal.recipeId ? `<button class="btn-sm" onclick="viewRecipe('${meal.recipeId}')">üìñ Recipe</button>` : ''}
             <button class="btn-sm danger" onclick="removeMeal(${i})">Remove</button>
             <button class="btn-sm" style="border-color:var(--success)33;color:var(--success)" onclick="openCookedModal(${i})" title="I cooked this!">‚úì Cooked</button>`
        }
      </div>`;
    grid.appendChild(card);
  });
}

async function swapMeals(fromDay, toDay) {
  const fromMeal = state.meals[fromDay] || null;
  const toMeal   = state.meals[toDay]   || null;
  // Swap in state
  if (toMeal)   state.meals[fromDay] = toMeal;
  else          delete state.meals[fromDay];
  if (fromMeal) state.meals[toDay]   = fromMeal;
  else          delete state.meals[toDay];
  // Persist both
  await Promise.all([
    apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: fromDay, meal: toMeal || null }) }),
    apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: toDay,   meal: fromMeal || null }) }),
  ]);
  renderWeek();
  showToast(`Swapped ${DAYS[fromDay]} ‚Üî ${DAYS[toDay]}`);
}

function openPickerModal(dayIndex) {
  pickerDay = dayIndex;
  document.getElementById('picker-day-title').textContent = DAYS[dayIndex];
  document.getElementById('picker-search').value = '';
  renderPicker('');
  document.getElementById('picker-modal').classList.add('open');
}
function renderPicker(search) {
  const list = document.getElementById('picker-list');
  const q = (search || '').toLowerCase();
  const filtered = state.recipes.filter(r =>
    r.name.toLowerCase().includes(q) || (r.category||'').toLowerCase().includes(q));
  if (!filtered.length) {
    list.innerHTML = '<div style="color:var(--text-muted);font-size:0.85rem;padding:12px">No recipes match.</div>';
    return;
  }
  list.innerHTML = filtered.map(r => `
    <div class="recipe-picker-item" onclick="pickRecipe('${r.id}')">
      <div class="r-name">${r.name}</div>
      <div class="r-meta">${r.category} ¬∑ Serves ${r.serves} ¬∑ ${(r.ingredients||[]).length} ingredients</div>
    </div>`).join('');
}
function pickRecipe(recipeId) {
  const recipe = state.recipes.find(r => r.id === recipeId);
  if (!recipe) return;
  const meal = { name: recipe.name, notes: recipe.steps||'', ingredients: (recipe.ingredients||[]).map(i => ({...i})), recipeId: recipe.id };
  state.meals[pickerDay] = meal;
  apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: pickerDay, meal }) });
  closeModal('picker-modal');
  renderWeek();
}
function openManualFromPicker() { closeModal('picker-modal'); openMealModal(pickerDay); }

function openMealModal(dayIndex) {
  editingDay = dayIndex;
  const meal = state.meals[dayIndex];
  document.getElementById('modal-day-title').textContent = DAYS[dayIndex];
  document.getElementById('meal-name').value  = meal ? meal.name : '';
  document.getElementById('meal-notes').value = meal ? (meal.notes || '') : '';
  const container = document.getElementById('ingredients-container');
  container.innerHTML = '';
  ingredientCount = 0;
  if (meal && meal.ingredients && meal.ingredients.length > 0)
    meal.ingredients.forEach(ing => addIngredientRow(ing));
  else
    addIngredientRow();
  document.getElementById('meal-modal').classList.add('open');
  setTimeout(() => document.getElementById('meal-name').focus(), 50);
}
function addIngredientRow(ing = null) {
  const id  = ingredientCount++;
  const row = document.createElement('div');
  row.className = 'ingredient-row';
  row.id = `ing-row-${id}`;
  const rawUnit = ing ? (ing.unit || '') : '';
  const canonUnit = canonicalUnit(rawUnit);
  const knownValues = UNIT_OPTIONS.filter(o => o.value !== '__other__').map(o => o.value);
  const isKnown = knownValues.includes(canonUnit);
  const otherVal = (!isKnown && rawUnit) ? esc(rawUnit) : '';
  const showOther = (!isKnown && rawUnit) ? '' : 'none';
  row.innerHTML = `
    <input type="text" placeholder="Ingredient" value="${ing ? esc(ing.name) : ''}" id="ing-name-${id}">
    <input type="text" placeholder="Qty"        value="${ing ? esc(ing.qty)  : ''}" id="ing-qty-${id}" style="max-width:75px">
    <div style="display:flex;flex-direction:column;gap:3px">
      <select id="ing-unit-${id}" style="margin:0;font-size:0.82rem;padding:7px 8px">${buildUnitSelectHTML(rawUnit)}</select>
      <input type="text" id="ing-unit-other-${id}" placeholder="Type unit‚Ä¶" style="display:${showOther};font-size:0.82rem;padding:6px 8px;margin:0" value="${otherVal}">
    </div>
    <button class="icon-btn" onclick="document.getElementById('ing-row-${id}').remove()">√ó</button>`;
  document.getElementById('ingredients-container').appendChild(row);
  wireUnitSelect(`ing-unit-${id}`, `ing-unit-other-${id}`);
}
function saveMeal() {
  const name = document.getElementById('meal-name').value.trim();
  if (!name) { alert('Please enter a meal name.'); return; }
  const meal = { name, notes: document.getElementById('meal-notes').value.trim(), ingredients: collectIngredients('ing') };
  state.meals[editingDay] = meal;
  apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: editingDay, meal }) });
  closeModal('meal-modal');
  renderWeek();
}
function removeMeal(dayIndex) {
  delete state.meals[dayIndex];
  apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex, meal: null }) });
  renderWeek();
}
function clearWeek() {
  if (!confirm('Clear all meals this week?')) return;
  state.meals = {};
  apiFetch('/api/meals/clear', { method:'POST' });
  renderWeek();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RECIPES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RECIPE FILTERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const activeFilters = { time: null, ingredients: null, cuisine: null, special: new Set(), calories: null, cost: null };

function toggleFilter(btn) {
  const filter = btn.dataset.filter;
  const value  = btn.dataset.value;

  if (filter === 'special') {
    // Special filters are independent toggles
    if (activeFilters.special.has(value)) {
      activeFilters.special.delete(value);
      btn.classList.remove('active');
    } else {
      activeFilters.special.add(value);
      btn.classList.add('active');
    }
  } else {
    // Radio-style: one active per group
    const siblings = document.querySelectorAll(`[data-filter="${filter}"]`);
    if (activeFilters[filter] === value) {
      // Deselect
      activeFilters[filter] = null;
      btn.classList.remove('active');
    } else {
      siblings.forEach(s => s.classList.remove('active'));
      activeFilters[filter] = value;
      btn.classList.add('active');
    }
  }
  applyRecipeFilters();
}

function estimateCookTime(recipe) {
  // Use stored cookTime first
  if (recipe.cookTime && !isNaN(Number(recipe.cookTime))) return Number(recipe.cookTime);
  // Infer from steps text
  const text = (recipe.steps || '') + ' ' + (recipe.desc || '');
  const mins = [];
  const hourMatches = text.match(/(\d+)\s*(?:hour|hr)/gi) || [];
  hourMatches.forEach(m => { const n = parseInt(m); if (!isNaN(n)) mins.push(n * 60); });
  const minMatches = text.match(/(\d+)\s*(?:min|minute)/gi) || [];
  minMatches.forEach(m => { const n = parseInt(m); if (!isNaN(n)) mins.push(n); });
  if (!mins.length) return null;
  return Math.max(...mins);
}

function canMakeFromPantry(recipe) {
  if (!state.pantry || !state.pantry.length) return false;
  const pantryNorms = state.pantry.map(p => normalizeIngName(p.name));
  const ings = (recipe.ingredients || []).map(i => normalizeIngName(i.name));
  if (!ings.length) return false;
  const matches = ings.filter(ing => pantryNorms.some(p => p.includes(ing) || ing.includes(p)));
  // "Can make now" = 70%+ of ingredients in pantry
  return matches.length / ings.length >= 0.7;
}

const COUNTRY_FLAGS = {
  'Italy':'üáÆüáπ','Japan':'üáØüáµ','Mexico':'üá≤üáΩ','India':'üáÆüá≥','China':'üá®üá≥',
  'France':'üá´üá∑','Spain':'üá™üá∏','Thailand':'üáπüá≠','Greece':'üá¨üá∑','Morocco':'üá≤üá¶',
  'Peru':'üáµüá™','Turkey':'üáπüá∑','Lebanon':'üá±üáß','Nigeria':'üá≥üá¨','Korea':'üá∞üá∑',
  'Vietnam':'üáªüá≥','Brazil':'üáßüá∑','Argentina':'üá¶üá∑','Ethiopia':'üá™üáπ','USA':'üá∫üá∏',
  'Portugal':'üáµüáπ','Germany':'üá©üá™','Ukraine':'üá∫üá¶','Russia':'üá∑üá∫','Iran':'üáÆüá∑',
  'Indonesia':'üáÆüá©','Poland':'üáµüá±','South Africa':'üáøüá¶','Austria':'üá¶üáπ','Egypt':'üá™üá¨'
};
const COUNTRY_ADJECTIVES = {
  'Italy':'Italian','Japan':'Japanese','Mexico':'Mexican','India':'Indian','China':'Chinese',
  'France':'French','Spain':'Spanish','Thailand':'Thai','Greece':'Greek','Morocco':'Moroccan',
  'Peru':'Peruvian','Turkey':'Turkish','Lebanon':'Lebanese','Nigeria':'Nigerian','Korea':'Korean',
  'Vietnam':'Vietnamese','Brazil':'Brazilian','Argentina':'Argentine','Ethiopia':'Ethiopian',
  'USA':'American','Portugal':'Portuguese','Germany':'German','Ukraine':'Ukrainian',
  'Russia':'Russian','Iran':'Iranian','Indonesia':'Indonesian','Poland':'Polish',
  'South Africa':'South African','Austria':'Austrian','Egypt':'Egyptian',
  'UK':'British','Jamaica':'Jamaican','Malaysia':'Malaysian','Taiwan':'Taiwanese',
  'Cambodia':'Cambodian','Laos':'Laotian','Myanmar':'Burmese','Nepal':'Nepali',
  'Pakistan':'Pakistani','Philippines':'Filipino','Sri Lanka':'Sri Lankan',
  'Sweden':'Swedish','Netherlands':'Dutch','Belgium':'Belgian','Colombia':'Colombian',
  'Chile':'Chilean','Venezuela':'Venezuelan','Cuba':'Cuban','Ghana':'Ghanaian',
  'Kenya':'Kenyan','Senegal':'Senegalese','Uzbekistan':'Uzbek','Jordan':'Jordanian',
  'Israel':'Israeli','Saudi Arabia':'Saudi','Georgia':'Georgian','Hungary':'Hungarian',
  'Tunisia':'Tunisian','Yemen':'Yemeni','Iraq':'Iraqi',
};
function countryFlag(country) { return country ? (COUNTRY_FLAGS[country] || 'üåç') : ''; }
function countryAdjective(country) { return country ? (COUNTRY_ADJECTIVES[country] || country) : ''; }

function applyRecipeFilters() {
  const q = (document.getElementById('recipe-search')?.value || '').toLowerCase();
  let filtered = state.recipes.filter(r =>
    !q ||
    r.name.toLowerCase().includes(q) ||
    (r.category||'').toLowerCase().includes(q) ||
    (r.country||'').toLowerCase().includes(q) ||
    (countryAdjective(r.country)||'').toLowerCase().includes(q) ||
    (r.desc||'').toLowerCase().includes(q)
  );

  if (activeFilters.time === 'under30') {
    filtered = filtered.filter(r => { const t = estimateCookTime(r); return t !== null && t <= 30; });
  } else if (activeFilters.time === 'under60') {
    filtered = filtered.filter(r => { const t = estimateCookTime(r); return t !== null && t <= 60; });
  }

  if (activeFilters.ingredients === 'few') {
    filtered = filtered.filter(r => (r.ingredients||[]).length < 6);
  }

  if (activeFilters.cuisine) {
    filtered = filtered.filter(r => (r.category||'') === activeFilters.cuisine);
  }

  if (activeFilters.special.has('onepot')) {
    filtered = filtered.filter(r => r.onePot === true || r.onePot === 1);
  }
  if (activeFilters.special.has('pantry')) {
    filtered = filtered.filter(r => canMakeFromPantry(r));
  }
  if (activeFilters.special.has('favourites')) {
    filtered = filtered.filter(r => r.favourite === true || r.favourite === 1);
  }

  if (activeFilters.calories === 'under600') {
    filtered = filtered.filter(r => r.calories && Number(r.calories) < 600);
  }

  if (activeFilters.cost === 'under5') {
    filtered = filtered.filter(r => {
      const tc = calcTotalCost(r);
      if (!tc) return false;
      // Budget: total meal cost under ¬£5
      return tc < 5;
    });
  }

  // Sorting
  const sortBy = document.getElementById('recipe-sort')?.value || 'added';
  if (sortBy === 'name') filtered.sort((a,b) => a.name.localeCompare(b.name));
  else if (sortBy === 'name-desc') filtered.sort((a,b) => b.name.localeCompare(a.name));
  else if (sortBy === 'cooktime') filtered.sort((a,b) => {
    const ta = estimateCookTime(a) ?? 9999, tb = estimateCookTime(b) ?? 9999;
    return ta - tb;
  });
  else if (sortBy === 'calories') filtered.sort((a,b) => (Number(a.calories)||9999) - (Number(b.calories)||9999));
  else if (sortBy === 'cost') filtered.sort((a,b) => {
    const ca = calcTotalCost(a) || 9999, cb = calcTotalCost(b) || 9999;
    return ca - cb;
  });
  else if (sortBy === 'country') filtered.sort((a,b) => (countryAdjective(a.country)||'zzz').localeCompare(countryAdjective(b.country)||'zzz'));
  // 'added' = default order from API (newest first) ‚Äî no sort needed

  renderRecipes(filtered);
}

function renderRecipes(recipesOrSearch) {
  const grid = document.getElementById('recipes-grid');
  // Accept either a pre-filtered array or a search string (for back-compat)
  let filtered;
  if (Array.isArray(recipesOrSearch)) {
    filtered = recipesOrSearch;
  } else {
    const q = (recipesOrSearch || '').toLowerCase();
    filtered = state.recipes.filter(r =>
      !q ||
      r.name.toLowerCase().includes(q) ||
      (r.category||'').toLowerCase().includes(q) ||
      (r.desc||'').toLowerCase().includes(q)
    );
  }

  const countEl = document.getElementById('recipe-filter-count');
  if (countEl) countEl.textContent = `${filtered.length} recipe${filtered.length !== 1 ? 's' : ''}`;

  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="big">üìñ</div><h3>No recipes match</h3><p>Try clearing some filters.</p></div>`;
    return;
  }

  grid.innerHTML = filtered.map(r => {
    const cookTime  = estimateCookTime(r);
    const inPantry  = canMakeFromPantry(r);
    const totalCost = calcTotalCost(r);
    const totalCals = calcTotalCalories(r);
    const serves    = parseInt(r.serves) || 4;
    const isFav     = r.favourite === true || r.favourite === 1;
    // Use bottom-up calories if available, else legacy r.calories
    const displayCals = totalCals > 0 ? Math.round(totalCals / serves) : r.calories;
    const tags = [];
    if (cookTime) tags.push(`<span class="cook-time-tag">‚è± ${cookTime < 60 ? cookTime+'m' : Math.round(cookTime/60)+'h'}</span>`);
    if (r.onePot) tags.push(`<span class="one-pot-tag">ü•ò 1-pot</span>`);
    if (inPantry) tags.push(`<span class="pantry-match-tag">‚úì Can make now</span>`);
    if (displayCals) tags.push(`<span class="cook-time-tag calorie-tag">üî• ${displayCals} kcal/portion</span>`);
    if (totalCost) tags.push(`<span class="cook-time-tag cost-tag">üí∑ ¬£${(totalCost/serves).toFixed(2)}/portion</span>`);
    if (r.country) tags.push(`<span class="cook-time-tag" style="color:#5c4433">${countryFlag(r.country)} ${countryAdjective(r.country)}</span>`);
    return `
    <div class="recipe-card">
      <div class="recipe-card-header">
        <div class="recipe-name">${r.name}</div>
        <div style="display:flex;align-items:center;gap:4px;flex-shrink:0">
          <button class="fav-btn ${isFav ? 'is-fav' : ''}" onclick="toggleFavourite('${r.id}')" title="${isFav ? 'Remove from favourites' : 'Add to favourites'}">${isFav ? '‚≠ê' : '‚òÜ'}</button>
          <span class="recipe-tag">${r.category||''}</span>
        </div>
      </div>
      <div class="recipe-desc">${r.desc||''}</div>
      ${tags.length ? `<div style="display:flex;gap:5px;flex-wrap:wrap">${tags.join('')}</div>` : ''}
      <div class="recipe-meta">Serves ${r.serves} ¬∑ ${(r.ingredients||[]).length} ingredients${totalCost ? ` ¬∑ ¬£${totalCost.toFixed(2)} total` : ''}</div>
      <div class="recipe-actions">
        <button class="btn-sm" onclick="viewRecipe('${r.id}')">View</button>
        <button class="btn-sm" onclick="openRecipeModal('${r.id}')">Edit</button>
        <button class="btn-sm danger" onclick="deleteRecipe('${r.id}')">Delete</button>
      </div>
    </div>`;
  }).join('');
  updateBadges();
}

function viewRecipe(id) {
  const r = state.recipes.find(x => x.id === id);
  if (!r) return;
  const steps = (r.steps||'').split('\n').filter(s => s.trim());
  const serves    = parseInt(r.serves) || 4;
  const totalCost = calcTotalCost(r);
  const totalCals = calcTotalCalories(r);
  const hasCosts  = (r.ingredients||[]).some(i => i.cost);
  const hasCals   = (r.ingredients||[]).some(i => i.calories);

  // Build calorie breakdown table (bottom-up)
  let calSection = '';
  if (hasCals) {
    const calRows = (r.ingredients||[]).map(i =>
      `<div class="cal-ing-row">
        <span class="cal-ing-name">${i.name}${i.qty ? ` ‚Äî ${i.qty} ${i.unit||''}` : ''}</span>
        <span class="cal-ing-val">${i.calories ? Math.round(Number(i.calories))+' kcal' : '‚Äî'}</span>
      </div>`
    ).join('');
    calSection = `
      <div class="cal-breakdown">
        <div class="cal-breakdown-title">üî• Calorie Breakdown</div>
        ${calRows}
        <div class="cal-total-row">
          <span class="cal-total-label">Total calories</span>
          <span class="cal-total-val">${Math.round(totalCals)} kcal</span>
        </div>
        <div style="text-align:right;margin-top:4px">
          <span class="cal-per-portion">‚âà ${Math.round(totalCals/serves)} kcal per portion</span>
        </div>
      </div>`;
  }

  // Build cost breakdown table
  let costSection = '';
  if (hasCosts) {
    const costRows = (r.ingredients||[]).map(i =>
      `<div class="cost-ing-row">
        <span class="cost-ing-name">${i.name}${i.qty ? ` ‚Äî ${i.qty} ${i.unit||''}` : ''}</span>
        <span class="cost-ing-price">${i.cost ? '¬£'+Number(i.cost).toFixed(2) : '‚Äî'}</span>
      </div>`
    ).join('');
    costSection = `
      <div class="cost-breakdown">
        <div class="cost-breakdown-title">
          <span>üí∑ Ingredient Costs <span style="font-size:0.65rem;color:var(--border)">(Sainsbury's approx.)</span></span>
        </div>
        ${costRows}
        <div class="cost-total-row">
          <span class="cost-total-label">Total recipe cost</span>
          <span class="cost-total-val">¬£${totalCost.toFixed(2)}</span>
        </div>
        <div style="text-align:right;margin-top:4px">
          <span class="cost-per-portion">‚âà ¬£${(totalCost/serves).toFixed(2)} per portion</span>
        </div>
      </div>`;
  }

  // Use bottom-up calorie total if available, otherwise fall back to recipe.calories
  const displayCals = hasCals ? Math.round(totalCals / serves) : r.calories;

  document.getElementById('recipe-detail-content').innerHTML = `
    <div style="display:flex;align-items:flex-start;gap:10px;margin-bottom:4px">
      <h2 style="flex:1;margin-bottom:0">${r.name}</h2>
      <button class="fav-btn ${r.favourite ? 'is-fav' : ''}" onclick="toggleFavourite('${r.id}');document.querySelector('#recipe-detail-modal h2').textContent='${r.name.replace(/'/g,"\\'")}';this.classList.toggle('is-fav');this.textContent=this.classList.contains('is-fav')?'‚≠ê':'‚òÜ'" title="${r.favourite ? 'Remove from favourites' : 'Add to favourites'}" style="font-size:1.4rem;margin-top:2px">${r.favourite ? '‚≠ê' : '‚òÜ'}</button>
    </div>
    <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap">
      <span class="recipe-tag">${r.category||''}</span>
      <span class="recipe-tag">Serves ${r.serves}</span>
      ${r.country ? `<span class="recipe-tag">${countryFlag(r.country)} ${countryAdjective(r.country)}</span>` : ''}
      ${r.cookTime ? `<span class="cook-time-tag" style="display:inline-block;border-radius:20px;font-size:0.65rem;padding:3px 8px">‚è± ${r.cookTime}m</span>` : ''}
      ${displayCals ? `<span class="calorie-pill">üî• ${displayCals} kcal/portion</span>` : ''}
      ${totalCost ? `<span class="cost-pill">üí∑ ¬£${(totalCost/serves).toFixed(2)}/portion</span>` : ''}
    </div>
    ${r.desc ? `<p style="color:var(--text-muted);font-size:0.87rem;margin-bottom:18px;line-height:1.6">${r.desc}</p>` : ''}
    <div style="font-size:0.73rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-muted);margin-bottom:8px">Ingredients</div>
    <div class="ing-chips" style="margin-bottom:${(hasCosts||hasCals) ? '10px' : '22px'}">
      ${(r.ingredients||[]).map(i => `<span class="ing-chip">${i.name}${i.qty ? ' ‚Äî '+i.qty+' '+(i.unit||'') : ''}${i.calories ? ' <span style="color:#c97a3a;font-size:0.75em">'+Math.round(Number(i.calories))+' kcal</span>' : ''}${i.cost ? ' <span style="color:#7dd3a8;font-size:0.75em">¬£'+Number(i.cost).toFixed(2)+'</span>' : ''}</span>`).join('')}
    </div>
    ${calSection}
    ${costSection}
    ${steps.length ? `
      <div style="font-size:0.73rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-muted);margin-bottom:8px;margin-top:18px">Method</div>
      <div class="recipe-steps"><ol>${steps.map(s => `<li>${s.replace(/^\d+\.\s*/,'')}</li>`).join('')}</ol></div>
    ` : ''}`;
  document.getElementById('recipe-detail-actions').innerHTML = `
    <button class="btn-secondary" onclick="closeModal('recipe-detail-modal')">Close</button>
    <button class="btn-secondary" onclick="closeModal('recipe-detail-modal');openRecipeModal('${r.id}')">Edit</button>
    <button class="btn-primary" onclick="addRecipeToNextDay('${r.id}')">+ Add to Planner</button>`;
  document.getElementById('recipe-detail-modal').classList.add('open');
}

function openRecipeModal(id) {
  editingRecipeId = id || null;
  const r = id ? state.recipes.find(x => x.id === id) : null;
  document.getElementById('recipe-modal-title').textContent = r ? 'Edit Recipe' : 'New Recipe';
  document.getElementById('rec-name').value     = r ? r.name : '';
  document.getElementById('rec-cat').value      = r ? r.category : 'Pasta';
  document.getElementById('rec-country').value  = r ? (r.country || '') : '';
  document.getElementById('rec-serves').value   = r ? r.serves : '4';
  document.getElementById('rec-desc').value     = r ? (r.desc||'') : '';
  document.getElementById('rec-steps').value    = r ? (r.steps||'') : '';
  document.getElementById('rec-cooktime').value = r ? (r.cookTime||'') : '';
  document.getElementById('rec-onepot').checked = r ? !!(r.onePot) : false;
  const container = document.getElementById('rec-ingredients-container');
  container.innerHTML = '';
  recIngCount = 0;
  if (r && r.ingredients && r.ingredients.length > 0)
    r.ingredients.forEach(ing => addRecipeIngRow(ing));
  else
    addRecipeIngRow();
  updateRecipeCaloriesDisplay();
  document.getElementById('recipe-modal').classList.add('open');
  setTimeout(() => document.getElementById('rec-name').focus(), 50);
}
function addRecipeIngRow(ing = null) {
  const id  = recIngCount++;
  const row = document.createElement('div');
  row.className = 'ingredient-row';
  row.id = `ring-row-${id}`;
  const rawUnit = ing ? (ing.unit || '') : '';
  const canonUnit = canonicalUnit(rawUnit);
  const knownValues = UNIT_OPTIONS.filter(o => o.value !== '__other__').map(o => o.value);
  const isKnown = knownValues.includes(canonUnit);
  const otherVal = (!isKnown && rawUnit) ? esc(rawUnit) : '';
  const showOther = (!isKnown && rawUnit) ? '' : 'none';
  row.innerHTML = `
    <input type="text" placeholder="Ingredient" value="${ing ? esc(ing.name) : ''}" id="ring-name-${id}">
    <input type="text" placeholder="Qty"        value="${ing ? esc(ing.qty)  : ''}" id="ring-qty-${id}" style="max-width:75px">
    <div style="display:flex;flex-direction:column;gap:3px">
      <select id="ring-unit-${id}" style="margin:0;font-size:0.82rem;padding:7px 8px">${buildUnitSelectHTML(rawUnit)}</select>
      <input type="text" id="ring-unit-other-${id}" placeholder="Type unit‚Ä¶" style="display:${showOther};font-size:0.82rem;padding:6px 8px;margin:0" value="${otherVal}">
    </div>
    <input type="number" placeholder="kcal" value="${ing && ing.calories ? ing.calories : ''}" id="ring-cal-${id}" min="0" style="max-width:65px;font-size:0.82rem;padding:7px 8px" oninput="updateRecipeCaloriesDisplay()" title="Calories for this ingredient">
    <button class="icon-btn" onclick="document.getElementById('ring-row-${id}').remove();updateRecipeCaloriesDisplay()">√ó</button>`;
  document.getElementById('rec-ingredients-container').appendChild(row);
  wireUnitSelect(`ring-unit-${id}`, `ring-unit-other-${id}`);
}
function saveRecipe() {
  const name = document.getElementById('rec-name').value.trim();
  if (!name) { alert('Please enter a recipe name.'); return; }
  const cookTimeVal = document.getElementById('rec-cooktime').value.trim();
  // Collect ingredients from form, but preserve any existing cost data
  const existingRecipe = editingRecipeId ? state.recipes.find(r => r.id === editingRecipeId) : null;
  const formIngredients = collectIngredients('ring');
  // Try to merge costs AND calories from existing ingredients by name match
  const mergedIngredients = formIngredients.map(ing => {
    if (!existingRecipe) return ing;
    const existing = (existingRecipe.ingredients||[]).find(e =>
      e.name.toLowerCase() === ing.name.toLowerCase()
    );
    const merged = { ...ing };
    if (existing && existing.cost !== undefined) merged.cost = existing.cost;
    // calories come from the form itself (ring-cal-N), already collected in formIngredients
    return merged;
  });
  // Compute total calories from ingredient kcal values (bottom-up)
  const ingCalTotal = mergedIngredients.reduce((s, i) => s + (i.calories ? Number(i.calories) : 0), 0);
  const serves = parseInt(document.getElementById('rec-serves').value.trim()) || 4;
  const derivedCaloriesPerServing = ingCalTotal > 0 ? Math.round(ingCalTotal / serves) : null;
  const recipe = {
    id:          editingRecipeId || 'r_' + Date.now(),
    name,
    category:    document.getElementById('rec-cat').value,
    country:     document.getElementById('rec-country').value || null,
    serves:      document.getElementById('rec-serves').value.trim(),
    desc:        document.getElementById('rec-desc').value.trim(),
    steps:       document.getElementById('rec-steps').value.trim(),
    ingredients: mergedIngredients,
    cookTime:    cookTimeVal ? Number(cookTimeVal) : null,
    calories:    derivedCaloriesPerServing,
    onePot:      document.getElementById('rec-onepot').checked,
    favourite:   existingRecipe ? (existingRecipe.favourite || false) : false,
  };
  if (editingRecipeId) {
    const idx = state.recipes.findIndex(r => r.id === editingRecipeId);
    if (idx > -1) state.recipes[idx] = recipe; else state.recipes.push(recipe);
  } else {
    state.recipes.push(recipe);
  }
  apiFetch('/api/recipes', { method:'POST', body: JSON.stringify(recipe) });
  closeModal('recipe-modal');
  const searchEl = document.querySelector('#view-recipes input');
  applyRecipeFilters();
  updateBadges();
}
function deleteRecipe(id) {
  if (!confirm('Delete this recipe?')) return;
  state.recipes = state.recipes.filter(r => r.id !== id);
  apiFetch('/api/recipes/' + id, { method:'DELETE' });
  const searchEl = document.querySelector('#view-recipes input');
  applyRecipeFilters();
  updateBadges();
}

function toggleFavourite(id) {
  const recipe = state.recipes.find(r => r.id === id);
  if (!recipe) return;
  recipe.favourite = !recipe.favourite;
  apiFetch('/api/recipes', { method: 'POST', body: JSON.stringify(recipe) });
  applyRecipeFilters(); // re-render cards to update star
}

function addRecipeToNextDay(recipeId) {
  const recipe = state.recipes.find(r => r.id === recipeId);
  if (!recipe) return;
  // Find first empty day (0‚Äì6)
  const nextFree = DAYS.findIndex((_, i) => !state.meals[i]);
  if (nextFree === -1) {
    alert('Your week is fully planned! Clear a day first to add more meals.');
    return;
  }
  const meal = { name: recipe.name, notes: recipe.steps||'', ingredients: (recipe.ingredients||[]).map(i => ({...i})), recipeId: recipe.id };
  state.meals[nextFree] = meal;
  apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: nextFree, meal }) });
  closeModal('recipe-detail-modal');
  renderWeek();
  // Brief confirmation toast
  showToast(`Added "${recipe.name}" to ${DAYS[nextFree]}`);
}

function showToast(msg) {
  let toast = document.getElementById('app-toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'app-toast';
    toast.style.cssText = 'position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:11px 22px;border-radius:10px;font-size:0.88rem;font-family:DM Sans,sans-serif;z-index:999;box-shadow:0 4px 16px rgba(45,33,24,0.25);transition:opacity 0.4s;pointer-events:none;white-space:nowrap';
    document.body.appendChild(toast);
  }
  toast.textContent = msg;
  toast.style.opacity = '1';
  clearTimeout(toast._timeout);
  toast._timeout = setTimeout(() => { toast.style.opacity = '0'; }, 2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHOPPING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// UK supermarket pack sizes ‚Äî what you can actually buy in store.
const UK_PACK_RULES = [
  // Produce by count
  { match: ['egg'],                                              soldAs: 'count', packs: [6, 12] },
  { match: ['onion', 'shallot'],                                 soldAs: 'count', packs: [1, 3, 6] },
  { match: ['garlic clove', 'clove of garlic'],                  soldAs: 'count', packs: [1] },
  { match: ['garlic bulb', 'garlic head', 'garlic'],             soldAs: 'count', packs: [1, 3] },
  { match: ['lemon', 'lime'],                                    soldAs: 'count', packs: [1, 2, 4] },
  { match: ['avocado'],                                          soldAs: 'count', packs: [1, 2, 4] },
  { match: ['red pepper', 'green pepper', 'yellow pepper', 'pepper'], soldAs: 'count', packs: [1, 3] },
  { match: ['courgette', 'zucchini'],                            soldAs: 'count', packs: [1, 2, 3] },
  { match: ['carrot'],                                           soldAs: 'count', packs: [1, 3, 6] },
  { match: ['sweet potato'],                                     soldAs: 'count', packs: [1, 2, 4] },
  { match: ['potato'],                                           soldAs: 'count', packs: [1, 4, 8] },
  { match: ['iceberg lettuce', 'cos lettuce', 'romaine lettuce', 'lettuce'], soldAs: 'count', packs: [1] },
  { match: ['pak choi', 'bok choy'],                             soldAs: 'count', packs: [1, 2] },
  { match: ['spring onion'],                                     soldAs: 'bunch', packs: [1] },
  { match: ['banana'],                                           soldAs: 'count', packs: [1, 5] },
  { match: ['apple', 'orange', 'pear'],                          soldAs: 'count', packs: [1, 4, 6] },
  { match: ['lemongrass'],                                       soldAs: 'stalk', packs: [1, 2] },
  { match: ['lime leaf', 'kaffir lime leaf'],                    soldAs: 'pack',  packs: [1] },
  { match: ['celery'],                                           soldAs: 'head',  packs: [1] },
  { match: ['leek'],                                             soldAs: 'count', packs: [1, 2, 4] },
  { match: ['cucumber'],                                         soldAs: 'count', packs: [1] },
  { match: ['corn on the cob', 'sweetcorn cob'],                 soldAs: 'count', packs: [2, 4] },
  // Fresh herbs
  { match: ['basil', 'coriander', 'parsley', 'mint', 'dill', 'sage', 'thyme', 'rosemary', 'chives'], soldAs: 'bunch', packs: [1] },
  // Meat & fish by weight (g)
  { match: ['chicken breast', 'chicken fillet'],  soldAs: 'g', packs: [300, 600, 900] },
  { match: ['chicken thigh', 'chicken leg'],      soldAs: 'g', packs: [500, 1000] },
  { match: ['minced beef', 'beef mince', 'mince beef', 'mince'], soldAs: 'g', packs: [500, 750] },
  { match: ['minced lamb', 'lamb mince'],         soldAs: 'g', packs: [500] },
  { match: ['minced pork', 'pork mince'],         soldAs: 'g', packs: [500] },
  { match: ['salmon fillet', 'salmon'],           soldAs: 'g', packs: [240, 480] },
  { match: ['cod', 'haddock', 'sea bass'],        soldAs: 'g', packs: [300, 500] },
  { match: ['king prawn', 'prawn'],               soldAs: 'g', packs: [180, 300, 500] },
  { match: ['bacon'],                             soldAs: 'g', packs: [200, 400] },
  { match: ['chorizo'],                           soldAs: 'g', packs: [200] },
  { match: ['pancetta'],                          soldAs: 'g', packs: [130, 200] },
  { match: ['sausage'],                           soldAs: 'count', packs: [6, 8] },
  { match: ['ham'],                               soldAs: 'g', packs: [100, 200, 400] },
  // Dairy
  { match: ['butter'],                            soldAs: 'g', packs: [250, 500] },
  { match: ['parmesan', 'parmigiano'],            soldAs: 'g', packs: [100, 200] },
  { match: ['cheddar'],                           soldAs: 'g', packs: [200, 400, 750] },
  { match: ['mozzarella'],                        soldAs: 'g', packs: [125, 250] },
  { match: ['feta'],                              soldAs: 'g', packs: [200, 400] },
  { match: ['halloumi'],                          soldAs: 'g', packs: [225] },
  { match: ['double cream'],                      soldAs: 'ml', packs: [150, 300, 600] },
  { match: ['single cream'],                      soldAs: 'ml', packs: [150, 300] },
  { match: ['sour cream'],                        soldAs: 'ml', packs: [150, 300] },
  { match: ['creme fraiche', 'cr√®me fra√Æche'],    soldAs: 'ml', packs: [200, 300] },
  { match: ['plain yoghurt', 'greek yoghurt', 'yoghurt', 'yogurt'], soldAs: 'g', packs: [150, 450, 1000] },
  { match: ['milk'],                              soldAs: 'ml', packs: [568, 1136, 2272] },
  // Dry goods
  { match: ['spaghetti', 'pasta', 'penne', 'fusilli', 'tagliatelle', 'rigatoni', 'linguine', 'lasagne', 'orzo'], soldAs: 'g', packs: [500] },
  { match: ['basmati rice', 'jasmine rice', 'arborio rice', 'rice'], soldAs: 'g', packs: [500, 1000] },
  { match: ['egg noodle', 'noodle'],              soldAs: 'g', packs: [300, 500] },
  { match: ['couscous', 'quinoa', 'bulgur'],      soldAs: 'g', packs: [500] },
  // Tinned & jarred
  { match: ['chopped tomato', 'tinned tomato', 'canned tomato'], soldAs: 'tin', packs: [1, 2] },
  { match: ['coconut milk'],                      soldAs: 'tin', packs: [1, 2] },
  { match: ['chickpea', 'kidney bean', 'black bean', 'mixed bean'], soldAs: 'tin', packs: [1, 2] },
  { match: ['baked bean'],                        soldAs: 'tin', packs: [1, 2] },
  { match: ['tomato puree', 'tomato pur√©e', 'tomato paste'], soldAs: 'tube', packs: [1] },
  { match: ['passata'],                           soldAs: 'carton', packs: [1] },
  // Stock
  { match: ['vegetable stock', 'chicken stock', 'beef stock', 'fish stock', 'stock'], soldAs: 'carton', packs: [1] },
  // Sauces & condiments (whole bottle/jar)
  { match: ['soy sauce', 'fish sauce', 'oyster sauce', 'worcestershire sauce'], soldAs: 'bottle', packs: [1] },
  { match: ['olive oil', 'vegetable oil', 'sesame oil', 'sunflower oil'],       soldAs: 'bottle', packs: [1] },
  { match: ['curry paste', 'green curry paste', 'tikka masala paste', 'masala paste'], soldAs: 'jar', packs: [1] },
  // Bakery
  { match: ['flour tortilla', 'tortilla wrap', 'tortilla', 'small tortilla'],   soldAs: 'pack', packs: [8] },
  { match: ['bread', 'loaf'],                     soldAs: 'loaf', packs: [1] },
  { match: ['naan'],                              soldAs: 'pack', packs: [4] },
  { match: ['pitta', 'pita'],                     soldAs: 'pack', packs: [6] },
  // Other produce by weight
  { match: ['cherry tomato'],                     soldAs: 'g', packs: [250, 400] },
  { match: ['sugar snap pea', 'mangetout'],        soldAs: 'g', packs: [150, 200] },
  { match: ['mushroom'],                          soldAs: 'g', packs: [250, 500] },
  { match: ['spinach', 'kale', 'rocket'],         soldAs: 'g', packs: [100, 200] },
  { match: ['tomato'],                            soldAs: 'g', packs: [250, 500] },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UNIT CONVERSION UTILITIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Converts a quantity+unit pair to a canonical base amount (grams for weight, ml for volume)
// Returns { base: number, type: 'weight'|'volume'|'count'|'other', normalUnit: string }
// so we can compare and combine cross-unit values.

const UNIT_CONVERSIONS = {
  // Weight ‚Üí grams
  'g':        { factor: 1,      type: 'weight', base: 'g'  },
  'gram':     { factor: 1,      type: 'weight', base: 'g'  },
  'grams':    { factor: 1,      type: 'weight', base: 'g'  },
  'kg':       { factor: 1000,   type: 'weight', base: 'g'  },
  'kilogram': { factor: 1000,   type: 'weight', base: 'g'  },
  'kilograms':{ factor: 1000,   type: 'weight', base: 'g'  },
  'oz':       { factor: 28.35,  type: 'weight', base: 'g'  },
  'ounce':    { factor: 28.35,  type: 'weight', base: 'g'  },
  'ounces':   { factor: 28.35,  type: 'weight', base: 'g'  },
  'lb':       { factor: 453.59, type: 'weight', base: 'g'  },
  'lbs':      { factor: 453.59, type: 'weight', base: 'g'  },
  'pound':    { factor: 453.59, type: 'weight', base: 'g'  },
  'pounds':   { factor: 453.59, type: 'weight', base: 'g'  },
  // Volume ‚Üí ml
  'ml':       { factor: 1,      type: 'volume', base: 'ml' },
  'millilitre':{ factor: 1,     type: 'volume', base: 'ml' },
  'millilitres':{ factor: 1,    type: 'volume', base: 'ml' },
  'l':        { factor: 1000,   type: 'volume', base: 'ml' },
  'litre':    { factor: 1000,   type: 'volume', base: 'ml' },
  'litres':   { factor: 1000,   type: 'volume', base: 'ml' },
  'liter':    { factor: 1000,   type: 'volume', base: 'ml' },
  'liters':   { factor: 1000,   type: 'volume', base: 'ml' },
  'fl oz':    { factor: 29.57,  type: 'volume', base: 'ml' },
  'fl. oz':   { factor: 29.57,  type: 'volume', base: 'ml' },
  'cup':      { factor: 240,    type: 'volume', base: 'ml' },
  'cups':     { factor: 240,    type: 'volume', base: 'ml' },
  'cup(s)':   { factor: 240,    type: 'volume', base: 'ml' },
  'tbsp':     { factor: 15,     type: 'volume', base: 'ml' },
  'tablespoon':{ factor: 15,    type: 'volume', base: 'ml' },
  'tablespoons':{ factor: 15,   type: 'volume', base: 'ml' },
  'tsp':      { factor: 5,      type: 'volume', base: 'ml' },
  'teaspoon': { factor: 5,      type: 'volume', base: 'ml' },
  'teaspoons':{ factor: 5,      type: 'volume', base: 'ml' },
};

// Convert qty+unit to base value (grams or ml). Returns null if not convertible.
function toBase(qty, unit) {
  const q = parseFloat(qty);
  if (isNaN(q)) return null;
  const conv = UNIT_CONVERSIONS[(unit||'').toLowerCase().trim()];
  if (!conv) return null;
  return { value: q * conv.factor, type: conv.type, baseUnit: conv.base };
}

// Format a base value back to a friendly display (e.g. 1800g ‚Üí "1.8 kg")
function fromBase(value, type) {
  if (type === 'weight') {
    if (value >= 1000) return { qty: parseFloat((value / 1000).toFixed(3)).toString(), unit: 'kg' };
    return { qty: parseFloat(value.toFixed(1)).toString(), unit: 'g' };
  }
  if (type === 'volume') {
    if (value >= 1000) return { qty: parseFloat((value / 1000).toFixed(3)).toString(), unit: 'l' };
    return { qty: parseFloat(value.toFixed(1)).toString(), unit: 'ml' };
  }
  return null;
}

// Attempt to combine two qty+unit pairs into one. Returns { qty, unit } or null if incompatible.
function combineQuantities(qty1, unit1, qty2, unit2) {
  const b1 = toBase(qty1, unit1);
  const b2 = toBase(qty2, unit2);
  if (b1 && b2 && b1.type === b2.type) {
    return fromBase(b1.value + b2.value, b1.type);
  }
  // Fallback: same unit, plain addition
  const q1 = parseFloat(qty1), q2 = parseFloat(qty2);
  const u1 = (unit1||'').toLowerCase().trim(), u2 = (unit2||'').toLowerCase().trim();
  if (!isNaN(q1) && !isNaN(q2) && u1 === u2) {
    return { qty: String(parseFloat((q1 + q2).toFixed(3))), unit: unit1 || unit2 };
  }
  return null;
}

// Subtract qty2+unit2 from qty1+unit1. Returns { qty, unit, covered } where covered=true if fully in stock.
function subtractQuantities(needQty, needUnit, haveQty, haveUnit) {
  const bn = toBase(needQty, needUnit);
  const bh = toBase(haveQty, haveUnit);
  if (bn && bh && bn.type === bh.type) {
    const remaining = bn.value - bh.value;
    if (remaining <= 0) return { covered: true, qty: '0', unit: needUnit };
    const disp = fromBase(remaining, bn.type);
    return { covered: false, ...disp };
  }
  // Same unit fallback
  const qn = parseFloat(needQty), qh = parseFloat(haveQty);
  const un = (needUnit||'').toLowerCase().trim(), uh = (haveUnit||'').toLowerCase().trim();
  if (!isNaN(qn) && !isNaN(qh) && un === uh) {
    const remaining = qn - qh;
    if (remaining <= 0) return { covered: true, qty: '0', unit: needUnit };
    return { covered: false, qty: String(parseFloat(remaining.toFixed(3))), unit: needUnit };
  }
  return null; // incompatible units ‚Äî can't compute
}

// Consolidate a list of { qty, unit, ... } items with the same name, handling cross-unit addition
function consolidateIngredients(items) {
  if (!items.length) return items[0] || null;
  let totalBase = null;
  let baseType = null;
  let fallbackQty = parseFloat(items[0].qty) || 0;
  let fallbackUnit = items[0].unit;
  let canUseBase = true;

  items.forEach(item => {
    const b = toBase(item.qty, item.unit);
    if (b) {
      if (totalBase === null) { totalBase = b.value; baseType = b.type; }
      else if (b.type === baseType) { totalBase += b.value; }
      else { canUseBase = false; } // mixed weight+volume, shouldn't happen for same ingredient
    } else {
      // No conversion ‚Äî try plain addition if same unit
      const q = parseFloat(item.qty);
      if (!isNaN(q) && (item.unit||'').toLowerCase() === (fallbackUnit||'').toLowerCase()) {
        fallbackQty += q;
      } else {
        canUseBase = false;
      }
    }
  });

  const merged = { ...items[0], meals: [] };
  items.forEach(i => { if (i.meal && !merged.meals.includes(i.meal)) merged.meals.push(i.meal); });

  if (canUseBase && totalBase !== null) {
    const disp = fromBase(totalBase, baseType);
    merged.qty  = disp.qty;
    merged.unit = disp.unit;
  } else {
    merged.qty  = String(parseFloat(fallbackQty.toFixed(3)));
    merged.unit = fallbackUnit;
  }
  return merged;
}

function toShopUnit(name, qty, unit) {
  const nameLower = name.toLowerCase();
  const unitLower = (unit || '').toLowerCase().trim();
  const numQty = parseFloat(qty);
  const VOLUMETRIC = ['tbsp','tsp','tablespoon','teaspoon','pinch','handful','clove','cloves','sprig'];

  const rule = UK_PACK_RULES.find(r => r.match.some(m => nameLower.includes(m)));
  if (!rule) return { buyQty: qty, buyUnit: unit, packNote: null };

  const discreteUnits = ['count','bunch','stalk','head','pack','tin','jar','bottle','tube','carton','loaf'];
  if (discreteUnits.includes(rule.soldAs)) {
    let need = isNaN(numQty) ? 1 : Math.ceil(numQty);
    const largestPack = rule.packs[rule.packs.length - 1];
    const numPacks = Math.ceil(need / largestPack);
    const perPackNeed = Math.ceil(need / numPacks);
    const chosenPack = rule.packs.find(p => p >= perPackNeed) || largestPack;
    const finalQty = numPacks * chosenPack;
    const displayUnit = rule.soldAs === 'count' ? '' : rule.soldAs;
    const note = numPacks > 1 ? `${numPacks} √ó ${chosenPack}` : (chosenPack > 1 ? `pack of ${chosenPack}` : null);
    return { buyQty: String(finalQty), buyUnit: displayUnit, packNote: note };
  }

  // Weight/volume ‚Äî check for small measure units first
  if (VOLUMETRIC.includes(unitLower)) return { buyQty: qty, buyUnit: unit, packNote: null };

  let needG = isNaN(numQty) ? 0 : numQty;
  if (unitLower === 'kg') needG = numQty * 1000;
  if (unitLower === 'l')  needG = numQty * 1000;
  if (needG <= 0) return { buyQty: qty, buyUnit: unit, packNote: null };

  const largestPack = rule.packs[rule.packs.length - 1];
  const numPacks = Math.ceil(needG / largestPack);
  const perPackNeed = needG / numPacks;
  const chosenPack = rule.packs.find(p => p >= perPackNeed) || largestPack;
  const finalTotal = numPacks * chosenPack;
  const displayQty = finalTotal >= 1000 ? String(finalTotal / 1000) : String(finalTotal);
  const displayUnit = finalTotal >= 1000 ? (rule.soldAs === 'g' ? 'kg' : 'l') : rule.soldAs;
  const note = numPacks > 1 ? `${numPacks} √ó ${chosenPack}${rule.soldAs}` : null;
  return { buyQty: displayQty, buyUnit: displayUnit, packNote: note };
}

function generateShoppingList() {
  // 1. Collect all ingredients across the week
  const all = [];
  DAYS.forEach((_, i) => {
    const meal = state.meals[i];
    if (meal) (meal.ingredients||[]).forEach(ing => all.push({ ...ing, meal: meal.name }));
  });
  if (!all.length) { alert('No ingredients found. Add some meals with ingredients first.'); return; }

  // 2. Consolidate by ingredient name ‚Äî handling cross-unit addition (e.g. 500g + 1kg = 1.5kg)
  // Use normalised name as key so "onion" and "onions" merge together
  const groups = {};
  all.forEach(ing => {
    const key = normalizeIngName(ing.name);
    if (!groups[key]) groups[key] = [];
    groups[key].push(ing);
  });

  const merged = {};
  Object.entries(groups).forEach(([key, items]) => {
    merged[key] = consolidateIngredients(items);
  });

  // 3. Subtract pantry stock ‚Äî unit-aware (e.g. need 1kg, have 800g ‚Üí need 200g)
  // Use normalised names for pantry lookup
  const pantryMap = {};
  (state.pantry||[]).forEach(p => { pantryMap[normalizeIngName(p.name)] = p; });

  const afterPantry = [];
  Object.values(merged).forEach(ing => {
    const pantryItem = pantryMap[normalizeIngName(ing.name)];
    if (pantryItem) {
      const result = subtractQuantities(ing.qty, ing.unit, pantryItem.qty, pantryItem.unit);
      if (result) {
        if (result.covered) return; // fully in stock ‚Äî skip
        const haveDisp = formatQtyUnit(pantryItem.qty, pantryItem.unit);
        ing = { ...ing, qty: result.qty, unit: result.unit,
          pantryNote: `have ${haveDisp} in pantry` };
      } else {
        // Units incompatible ‚Äî flag for manual check
        const haveDisp = formatQtyUnit(pantryItem.qty, pantryItem.unit);
        ing = { ...ing, pantryNote: `check pantry (${haveDisp})` };
      }
    }
    afterPantry.push(ing);
  });

  // 4. Round to realistic UK supermarket pack sizes
  state.shoppingList = afterPantry.map(ing => {
    const { buyQty, buyUnit, packNote } = toShopUnit(ing.name, ing.qty, ing.unit);
    return {
      name: ing.name,
      qty: buyQty,
      unit: buyUnit,
      meals: ing.meals,
      checked: false,
      packNote: packNote || null,
      pantryNote: ing.pantryNote || null,
    };
  });

  apiFetch('/api/shopping', { method:'POST', body: JSON.stringify(state.shoppingList) });
  renderShopping();
  updateBadges();
  showView('shopping');
}

// Helper: format a qty+unit pair nicely (e.g. "800 g", "1.5 kg")
function formatQtyUnit(qty, unit) {
  const b = toBase(qty, unit);
  if (b) {
    const disp = fromBase(b.value, b.type);
    return `${disp.qty} ${disp.unit}`;
  }
  return `${qty || ''}${unit ? ' ' + unit : ''}`.trim();
}

// UK supermarket aisle order
const SHOP_AISLES = [
  { key: 'fresh-produce',   label: 'Fresh Produce',         icon: 'ü•¶',  match: ['fruit','veg','vegetable','salad','herb','lettuce','spinach','kale','broccoli','onion','garlic','ginger','carrot','potato','tomato','cucumber','pepper','courgette','mushroom','leek','celery','avocado','lemon','lime','apple','banana','orange','berry','grape','pear','mango','melon','pak choi','spring onion','fresh'] },
  { key: 'meat-fish',       label: 'Meat & Fish',           icon: 'ü•©',  match: ['chicken','beef','pork','lamb','mince','steak','bacon','sausage','fish','salmon','prawn','tuna','cod','haddock','anchovy','turkey','duck','venison','ham','pancetta','chorizo','fillet','breast','thigh','wing','loin','rib','king prawn'] },
  { key: 'dairy-eggs',      label: 'Dairy & Eggs',          icon: 'ü•õ',  match: ['milk','cream','butter','cheese','parmesan','cheddar','mozzarella','yoghurt','yogurt','egg','cr√®me fra√Æche','sour cream','double cream','single cream','clotted cream','mascarpone','ricotta','feta','brie','gouda','halloumi'] },
  { key: 'bakery',          label: 'Bakery & Bread',        icon: 'üçû',  match: ['bread','loaf','roll','bun','tortilla','wrap','pita','naan','bagel','croissant','sourdough','baguette','flour','pastry','crumpet','muffin','brioche'] },
  { key: 'frozen',          label: 'Frozen',                icon: 'üßä',  match: ['frozen','ice cream','peas frozen','sweetcorn frozen','chips frozen'] },
  { key: 'tinned',          label: 'Tinned & Jarred Goods', icon: 'ü•´',  match: ['tinned','canned','can of','chopped tomatoes','tomato pur√©e','puree','passata','coconut milk','chickpea','lentil','kidney bean','baked bean','stock','broth','sardine','mackerel','tuna tin','sweetcorn','olives'] },
  { key: 'dry-goods',       label: 'Dry Goods & Grains',    icon: 'üåæ',  match: ['pasta','spaghetti','rice','noodle','couscous','quinoa','oat','lentil','barley','bulgur','arborio','basmati','jasmine','orzo','lasagne','macaroni','penne','fusilli','tagliatelle','risotto','polenta','cornmeal','semolina'] },
  { key: 'condiments',      label: 'Condiments & Sauces',   icon: 'üßÇ',  match: ['sauce','soy sauce','fish sauce','oyster sauce','worcestershire','ketchup','mustard','mayo','mayonnaise','vinegar','oil','olive oil','sesame oil','vegetable oil','salt','pepper','sugar','honey','syrup','jam','paste','curry paste','tahini','miso','hoisin','sriracha','chilli sauce','hot sauce'] },
  { key: 'spices',          label: 'Spices & Herbs',        icon: 'üåø',  match: ['spice','cumin','coriander','turmeric','paprika','chilli','cayenne','cinnamon','ginger powder','garlic powder','oregano','thyme','rosemary','bay leaf','basil','parsley','mint','dill','sage','cardamom','clove','nutmeg','allspice','fennel seed','mustard seed','curry powder','garam masala','tikka','seasoning','mixed herbs','dried'] },
  { key: 'drinks',          label: 'Drinks',                icon: 'ü•§',  match: ['wine','beer','juice','water','stock cube','broth','tea','coffee','milk alternative','oat milk','almond milk','soy milk','cordial','squash'] },
  { key: 'snacks-other',    label: 'Snacks & Other',        icon: 'üõí',  match: [] },
];

function getAisle(itemName) {
  const name = itemName.toLowerCase();
  for (const aisle of SHOP_AISLES.slice(0, -1)) {
    if (aisle.match.some(keyword => name.includes(keyword))) return aisle.key;
  }
  return 'snacks-other';
}

function renderShopping() {
  const container = document.getElementById('shopping-list-container');
  if (!state.shoppingList || !state.shoppingList.length) {
    container.innerHTML = `<div class="empty-state"><div class="big">üõí</div><h3>No shopping list yet</h3><p>Plan your dinners then hit "Generate Shopping List".</p></div>`;
    return;
  }

  // Group items by aisle
  const groups = {};
  SHOP_AISLES.forEach(a => { groups[a.key] = []; });
  state.shoppingList.forEach((item, globalIdx) => {
    const aisleKey = getAisle(item.name);
    groups[aisleKey].push({ item, globalIdx });
  });

  const pantryDeducted = state.shoppingList.filter(i => i.pantryNote).length;
  const fullyFromPantry = (state.shoppingList._pantrySkipped || 0);
  let html = '';

  if (pantryDeducted > 0) {
    html += `<div style="background:#3d7a5210;border:1px solid #3d7a5233;border-radius:10px;padding:11px 15px;margin-bottom:18px;font-size:0.83rem;color:var(--success)">
      ‚úì Pantry stock deducted from ${pantryDeducted} item${pantryDeducted !== 1 ? 's' : ''} ‚Äî quantities already adjusted.
    </div>`;
  }

  SHOP_AISLES.forEach(aisle => {
    const entries = groups[aisle.key];
    if (!entries.length) return;
    html += `<div class="shop-aisle">
      <div class="shop-aisle-header">
        <span class="shop-aisle-icon">${aisle.icon}</span>
        <span class="shop-aisle-title">${aisle.label}</span>
        <span class="shop-aisle-count">${entries.length}</span>
      </div>
      <div class="ingredient-list">`;
    entries.forEach(({ item, globalIdx }) => {
      const meals = Array.isArray(item.meals) ? item.meals : [];
      const qtyDisplay = [item.qty, item.unit].filter(Boolean).join(' ');
      html += `<div class="ingredient-item ${item.checked ? 'checked' : ''}" id="shop-item-${globalIdx}">
        <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleShopItem(${globalIdx}, this.checked)">
        <div style="flex:1;min-width:0">
          <div style="display:flex;align-items:baseline;gap:8px;flex-wrap:wrap">
            <span class="ing-name">${item.name}</span>
            ${qtyDisplay ? `<span class="ing-qty">${qtyDisplay}</span>` : ''}
            ${item.packNote ? `<span style="font-size:0.68rem;color:var(--text-muted);background:var(--surface2);border:1px solid var(--border);padding:1px 6px;border-radius:8px">${item.packNote}</span>` : ''}
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:2px">
            ${item.pantryNote ? `<span style="font-size:0.7rem;color:var(--success)">‚úì ${item.pantryNote}</span>` : ''}
            ${meals.length ? `<span class="ing-meal">${meals.join(', ')}</span>` : ''}
          </div>
        </div>
        <button class="del-btn" onclick="deleteShopItem(${globalIdx})" title="Remove item">√ó</button>
      </div>`;
    });
    html += `</div></div>`;
  });

  container.innerHTML = html;
}

function deleteShopItem(idx) {
  const item = state.shoppingList[idx];
  if (!item) return;
  state.shoppingList.splice(idx, 1);
  if (item.id) {
    apiFetch(`/api/shopping/${item.id}`, { method: 'DELETE' });
  }
  renderShopping();
  updateBadges();
}

function toggleShopItem(idx, checked) {
  const item = state.shoppingList[idx];
  if (!item) return;
  item.checked = checked;
  if (item.id) {
    apiFetch(`/api/shopping/${item.id}/check`, { method:'POST', body: JSON.stringify({ checked }) });
  }
  updateBadges();
  const el = document.getElementById(`shop-item-${idx}`);
  if (el) el.classList.toggle('checked', checked);
}
function markAllDone() {
  state.shoppingList.forEach(i => i.checked = true);
  apiFetch('/api/shopping', { method:'POST', body: JSON.stringify(state.shoppingList) });
  renderShopping();
  updateBadges();
}
async function shoppingBought() {
  if (!state.shoppingList || !state.shoppingList.length) return;
  if (!state.shoppingList.some(i => i.checked)) { alert('Tick some items first.'); return; }
  await apiFetch('/api/shopping/bought', { method:'POST' });
  const [shopping, pantry] = await Promise.all([apiFetch('/api/shopping'), apiFetch('/api/pantry')]);
  state.shoppingList = shopping.map(s => ({
    ...s,
    meals: typeof s.meals === 'string' ? JSON.parse(s.meals) : (s.meals||[]),
    checked: !!s.checked,
  }));
  state.pantry = pantry;
  renderShopping();
  renderPantry();
  updateBadges();
  showView('pantry');
  const msg = document.getElementById('success-msg');
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 4000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PANTRY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PANTRY_CATEGORIES = [
  { key: 'Meat & Fish',         icon: 'ü•©' },
  { key: 'Dairy & Eggs',        icon: 'ü•õ' },
  { key: 'Fruit & Veg',         icon: 'ü•¶' },
  { key: 'Bakery',              icon: 'üçû' },
  { key: 'Frozen',              icon: 'üßä' },
  { key: 'Condiments & Spices', icon: 'üßÇ' },
  { key: 'Drinks',              icon: 'ü•§' },
  { key: 'Grains',              icon: 'üåæ' },
  { key: 'Tinned Goods',        icon: 'ü•´' },
  { key: 'Snacks',              icon: 'üçø' },
  { key: 'Other',               icon: 'üì¶' },
];

function renderPantry() {
  const container = document.getElementById('pantry-container');

  // Group items by pantry_category
  const groups = {};
  (state.pantry || []).forEach(item => {
    const cat = item.pantry_category || 'Other';
    if (!groups[cat]) groups[cat] = [];
    groups[cat].push(item);
  });

  let html = '';

  // Always render ALL known categories, even empty ones
  PANTRY_CATEGORIES.forEach(({ key, icon }) => {
    const items = groups[key] || [];
    const isEmpty = items.length === 0;
    html += `<div class="pantry-section">
      <div class="pantry-section-header">
        <span class="pantry-section-icon">${icon}</span>
        <span class="pantry-section-title">${key}</span>
        <span class="pantry-section-count">${isEmpty ? '0' : items.length}</span>
      </div>`;

    if (isEmpty) {
      html += `<div style="color:var(--border);font-size:0.82rem;font-style:italic;padding:10px 4px">Nothing here yet</div>`;
    } else {
      html += `<div class="pantry-grid">`;
      items.forEach(item => {
        const globalIdx = state.pantry.indexOf(item);
        html += `<div class="pantry-item">
          <div class="pantry-item-info">
            <div class="p-name">${item.name}</div>
            <div class="p-qty">${item.qty ? item.qty + ' ' + (item.unit||'') : (item.unit||'‚Äî')}</div>
            <div class="p-added">Added ${item.added_date || item.addedDate || ''}</div>
          </div>
          <div class="pantry-item-actions">
            <button class="edit-btn" onclick="openEditPantryModal(${globalIdx})">Edit</button>
            <button class="remove-btn" onclick="removePantryItem(${globalIdx})">√ó</button>
          </div>
        </div>`;
      });
      html += `</div>`;
    }
    html += `</div>`;
  });

  // Any uncategorised items that don't match known cats
  const knownCats = PANTRY_CATEGORIES.map(c => c.key);
  const uncategorised = state.pantry.filter(i => !knownCats.includes(i.pantry_category));
  if (uncategorised.length) {
    html += `<div class="pantry-section"><div class="pantry-section-header"><span class="pantry-section-icon">‚ùì</span><span class="pantry-section-title">Uncategorised</span><span class="pantry-section-count">${uncategorised.length}</span></div><div class="pantry-grid">`;
    uncategorised.forEach(item => {
      const globalIdx = state.pantry.indexOf(item);
      html += `<div class="pantry-item"><div class="pantry-item-info"><div class="p-name">${item.name}</div><div class="p-qty">${item.qty ? item.qty+' '+(item.unit||'') : '‚Äî'}</div></div><div class="pantry-item-actions"><button class="edit-btn" onclick="openEditPantryModal(${globalIdx})">Edit</button><button class="remove-btn" onclick="removePantryItem(${globalIdx})">√ó</button></div></div>`;
    });
    html += `</div></div>`;
  }

  container.innerHTML = html;
}
function setPantryCategory(value) {
  const sel = document.getElementById('pantry-item-category');
  if (!sel) return;
  const opt = [...sel.options].find(o => o.value === value);
  if (opt) sel.value = value;
  else sel.value = 'Other';
}

function openAddPantryModal() {
  editingPantryIdx = null;
  document.getElementById('pantry-modal-title').textContent = 'Add Pantry Item';
  document.getElementById('pantry-item-name').value = '';
  document.getElementById('pantry-item-qty').value  = '';
  // Reset unit select
  const unitSel = document.getElementById('pantry-item-unit');
  if (unitSel) {
    unitSel.innerHTML = buildUnitSelectHTML('');
    unitSel.value = '';
    wireUnitSelect('pantry-item-unit', 'pantry-item-unit-other');
  }
  const unitOther = document.getElementById('pantry-item-unit-other');
  if (unitOther) { unitOther.value = ''; unitOther.style.display = 'none'; }
  setPantryCategory('Other');
  document.getElementById('ai-cat-suggest-status').textContent = '';
  document.getElementById('pantry-modal').classList.add('open');
  const nameEl = document.getElementById('pantry-item-name');
  setTimeout(() => nameEl.focus(), 50);
  // AI suggest category when user leaves the name field
  nameEl.onblur = () => aiSuggestPantryCategory(nameEl.value.trim());
}

function openEditPantryModal(idx) {
  editingPantryIdx = idx;
  const item = state.pantry[idx];
  document.getElementById('pantry-modal-title').textContent = 'Edit Pantry Item';
  document.getElementById('pantry-item-name').value = item.name;
  document.getElementById('pantry-item-qty').value  = item.qty  || '';
  // Set unit select
  const unitSel = document.getElementById('pantry-item-unit');
  if (unitSel) {
    unitSel.innerHTML = buildUnitSelectHTML(item.unit || '');
    wireUnitSelect('pantry-item-unit', 'pantry-item-unit-other');
    setUnitSelect('pantry-item-unit', 'pantry-item-unit-other', item.unit || '');
  }
  setPantryCategory(item.pantry_category || 'Other');
  document.getElementById('ai-cat-suggest-status').textContent = '';
  document.getElementById('pantry-modal').classList.add('open');
  const nameEl = document.getElementById('pantry-item-name');
  setTimeout(() => document.getElementById('pantry-item-qty').focus(), 50);
  nameEl.onblur = () => aiSuggestPantryCategory(nameEl.value.trim());
}

async function aiSuggestPantryCategory(name) {
  if (!name) return;
  const statusEl = document.getElementById('ai-cat-suggest-status');
  statusEl.textContent = '‚ú® suggesting‚Ä¶';
  try {
    const raw = await callClaude(
      'You are a grocery categorisation assistant. Respond ONLY with the category name, nothing else.',
      `Categorise this pantry item into exactly one of these categories:
"Meat & Fish", "Dairy & Eggs", "Fruit & Veg", "Bakery", "Frozen", "Condiments & Spices", "Drinks", "Grains", "Tinned Goods", "Snacks", "Other"

Item: "${name}"

Reply with only the category name.`
    );
    const suggested = raw.trim().replace(/['"]/g, '');
    const valid = ['Meat & Fish','Dairy & Eggs','Fruit & Veg','Bakery','Frozen','Condiments & Spices','Drinks','Grains','Tinned Goods','Snacks','Other'];
    const match = valid.find(v => suggested.toLowerCase().includes(v.toLowerCase()));
    if (match) {
      setPantryCategory(match);
      statusEl.textContent = '‚úì AI suggested';
    } else {
      statusEl.textContent = '';
    }
  } catch(e) {
    statusEl.textContent = '';
  }
}
async function savePantryItem() {
  const name = document.getElementById('pantry-item-name').value.trim();
  if (!name) { alert('Please enter an item name.'); return; }
  const qty             = document.getElementById('pantry-item-qty').value.trim();
  const unit            = getUnitValue('pantry-item-unit', 'pantry-item-unit-other');
  const pantry_category = document.getElementById('pantry-item-category').value;
  const date = new Date().toLocaleDateString('en-GB', { day:'numeric', month:'short' });
  if (editingPantryIdx !== null) {
    const item = state.pantry[editingPantryIdx];
    state.pantry[editingPantryIdx] = { ...item, name, qty, unit, pantry_category };
    await apiFetch(`/api/pantry/${item.id}`, { method:'PUT', body: JSON.stringify({ name, qty, unit, pantry_category }) });
  } else {
    // Check for existing item with same normalised name ‚Äî consolidate if found
    const normNew = normalizeIngName(name);
    const existing = state.pantry.find(p => normalizeIngName(p.name) === normNew);
    if (existing) {
      // Try to combine quantities
      const combined = combineQuantities(existing.qty, existing.unit, qty, unit);
      const newQty  = combined ? combined.qty  : existing.qty;
      const newUnit = combined ? combined.unit : existing.unit;
      state.pantry[state.pantry.indexOf(existing)] = { ...existing, qty: newQty, unit: newUnit, pantry_category };
      await apiFetch(`/api/pantry/${existing.id}`, { method:'PUT', body: JSON.stringify({ name: existing.name, qty: newQty, unit: newUnit, pantry_category }) });
      showToast(`‚úì Added to existing "${existing.name}" ‚Äî now ${newQty}${newUnit ? ' '+newUnit : ''}`);
    } else {
      await apiFetch('/api/pantry', { method:'POST', body: JSON.stringify({ name, qty, unit, addedDate: date, pantry_category }) });
      state.pantry = await apiFetch('/api/pantry');
    }
  }
  closeModal('pantry-modal');
  renderPantry();
  updateBadges();
}
async function removePantryItem(i) {
  const item = state.pantry[i];
  state.pantry.splice(i, 1);
  await apiFetch(`/api/pantry/${item.id}`, { method:'DELETE' });
  renderPantry();
  updateBadges();
}
function clearPantry() {
  if (!confirm('Clear the entire pantry?')) return;
  state.pantry = [];
  apiFetch('/api/pantry/clear', { method:'POST' });
  renderPantry();
  updateBadges();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê I COOKED THIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let cookedDayIndex = null;

function openCookedModal(dayIndex) {
  const meal = state.meals[dayIndex];
  if (!meal) return;
  cookedDayIndex = dayIndex;

  // Build pantry lookup by name (normalised)
  const pantryMap = {};
  (state.pantry || []).forEach(p => { pantryMap[normalizeIngName(p.name)] = p; });

  const ings = meal.ingredients || [];
  document.getElementById('cooked-modal-title').textContent = `‚úì Cooked: ${meal.name}`;

  // Summary line
  const inPantryCount = ings.filter(i => pantryMap[normalizeIngName(i.name)]).length;
  document.getElementById('cooked-summary').innerHTML =
    `<strong>${meal.name}</strong> uses <strong>${ings.length} ingredient${ings.length !== 1 ? 's' : ''}</strong>.` +
    (inPantryCount > 0
      ? ` <span style="color:var(--success)">${inPantryCount} are in your pantry</span> and will be deducted.`
      : ' None of these are currently tracked in your pantry ‚Äî they\'ll be noted as used.');

  // Build ingredient rows
  const list = document.getElementById('cooked-ingredient-list');
  list.innerHTML = ings.map((ing, i) => {
    const pantryItem = pantryMap[normalizeIngName(ing.name)];
    const inPantry   = !!pantryItem;
    const pantryQty  = inPantry && pantryItem.qty ? ` (have ${pantryItem.qty}${pantryItem.unit ? ' '+pantryItem.unit : ''})` : '';
    return `<div class="cooked-ingredient-row ${inPantry ? 'in-pantry' : ''}" id="ci-row-${i}">
      <input type="checkbox" checked id="ci-check-${i}" style="width:16px;height:16px;cursor:pointer;flex-shrink:0"
        onchange="document.getElementById('ci-row-${i}').classList.toggle('skipped', !this.checked)">
      <span class="ci-name">
        ${ing.name}
        ${inPantry
          ? `<span class="ci-pantry-flag"> ‚úì in pantry${pantryQty}</span>`
          : `<span class="ci-missing-flag"> not in pantry</span>`}
      </span>
      <input type="text" class="ci-qty-input" id="ci-qty-${i}" value="${ing.qty || ''}" placeholder="qty">
      <span class="ci-unit">${ing.unit || ''}</span>
    </div>`;
  }).join('');

  document.getElementById('cooked-modal').classList.add('open');
}

function cookedSelectAll() {
  const meal = state.meals[cookedDayIndex];
  if (!meal) return;
  (meal.ingredients || []).forEach((_, i) => {
    const chk = document.getElementById(`ci-check-${i}`);
    const row = document.getElementById(`ci-row-${i}`);
    if (chk) { chk.checked = true; }
    if (row) row.classList.remove('skipped');
  });
}

async function confirmCooked() {
  const meal = state.meals[cookedDayIndex];
  if (!meal) return;

  const pantryMap = {};
  (state.pantry || []).forEach(p => { pantryMap[normalizeIngName(p.name)] = p; });

  const ings = meal.ingredients || [];
  const updates = []; // [{pantryItem, deductQty, deductUnit}]
  const notInPantry = []; // ingredients used but not tracked

  ings.forEach((ing, i) => {
    const checked = document.getElementById(`ci-check-${i}`)?.checked;
    if (!checked) return; // skipped

    const usedQtyRaw = document.getElementById(`ci-qty-${i}`)?.value?.trim();
    const usedQty    = parseFloat(usedQtyRaw);
    const pantryItem = pantryMap[normalizeIngName(ing.name)];

    if (pantryItem) {
      updates.push({ pantryItem, usedQty: isNaN(usedQty) ? null : usedQty, unit: ing.unit || '' });
    } else {
      notInPantry.push(ing.name);
    }
  });

  // Apply deductions to pantry state + persist (unit-aware: tbsp deducted from l, g from kg, etc.)
  const saveOps = [];
  for (const { pantryItem, usedQty, unit } of updates) {
    if (usedQty === null) continue; // no quantity entered ‚Äî leave unchanged

    const result = subtractQuantities(pantryItem.qty, pantryItem.unit, String(usedQty), unit);
    const idx = state.pantry.indexOf(pantryItem);

    if (result) {
      if (result.covered) {
        // Fully used up ‚Äî remove from pantry
        state.pantry.splice(idx, 1);
        saveOps.push(apiFetch(`/api/pantry/${pantryItem.id}`, { method: 'DELETE' }));
      } else {
        // Partial ‚Äî update with normalised qty+unit (e.g. 1.5l minus 10tbsp ‚Üí 1.35l)
        state.pantry[idx] = { ...pantryItem, qty: result.qty, unit: result.unit };
        saveOps.push(apiFetch(`/api/pantry/${pantryItem.id}`, {
          method: 'PUT',
          body: JSON.stringify({ name: pantryItem.name, qty: result.qty, unit: result.unit, pantry_category: pantryItem.pantry_category }),
        }));
      }
    } else {
      // Incompatible units (e.g. kg vs ml) ‚Äî leave unchanged, can't compute
      console.warn(`Cannot deduct ${usedQty} ${unit} from ${pantryItem.name} (${pantryItem.qty} ${pantryItem.unit}) ‚Äî incompatible units`);
    }
  }

  await Promise.all(saveOps);
  renderPantry();
  updateBadges();
  closeModal('cooked-modal');

  // Show a friendly confirmation
  const deducted  = updates.length;
  const removed   = updates.filter(u => {
    const cur = parseFloat(u.pantryItem.qty); // original before update ‚Äî show count
    return u.usedQty !== null && !isNaN(cur) && cur - u.usedQty <= 0;
  }).length;

  let msg = `‚úì Pantry updated! Deducted ${deducted} ingredient${deducted !== 1 ? 's' : ''}`;
  if (notInPantry.length) msg += `. ${notInPantry.length} item${notInPantry.length !== 1 ? 's' : ''} weren't in your pantry (${notInPantry.slice(0,3).join(', ')}${notInPantry.length > 3 ? '‚Ä¶' : ''})`;
  msg += '.';

  const banner = document.getElementById('success-msg');
  banner.textContent = msg;
  banner.style.display = 'block';
  showView('pantry');
  setTimeout(() => { banner.style.display = 'none'; banner.textContent = '‚úì Shopping added to pantry!'; }, 5000);
}

async function aiCategorisePantry() {
  if (!state.pantry.length) { alert('Your pantry is empty.'); return; }
  const btn = document.getElementById('ai-cat-btn');
  btn.disabled  = true;
  btn.innerHTML = '<span class="spinner dark"></span> Categorising‚Ä¶';
  try {
    const names = state.pantry.map(p => p.name);
    const raw = await callClaude(
      'You are a grocery categorisation assistant. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
      `Categorise each of these pantry items into one of these categories:
"Meat & Fish", "Dairy & Eggs", "Fruit & Veg", "Bakery", "Frozen", "Condiments & Spices", "Drinks", "Grains", "Tinned Goods", "Snacks", "Other"

Items: ${JSON.stringify(names)}

Return a JSON array with one entry per item, in the same order:
[{"name":"...","category":"..."}]`
    );
    const results = safeParseJSON(raw);
    const valid = ['Meat & Fish','Dairy & Eggs','Fruit & Veg','Bakery','Frozen','Condiments & Spices','Drinks','Grains','Tinned Goods','Snacks','Other'];
    // Update local state
    const updates = [];
    results.forEach((r, i) => {
      const item = state.pantry[i];
      if (!item) return;
      const cat = valid.find(v => (r.category||'').toLowerCase().includes(v.toLowerCase())) || 'Other';
      item.pantry_category = cat;
      updates.push({ id: item.id, category: cat });
    });
    // Persist all at once
    await apiFetch('/api/pantry/categorise', { method:'POST', body: JSON.stringify({ items: updates }) });
    renderPantry();
  } catch(e) {
    alert('Could not categorise: ' + e.message);
  } finally {
    btn.disabled  = false;
    btn.innerHTML = '‚ú® Auto-categorise';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AI (proxied through Worker ‚Äî no credentials in browser) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function requireKey() { return true; }

async function callClaude(systemPrompt, userMsg) {
  const resp = await fetch(API + '/api/ai', {
    method:  'POST',
    headers: { 'Content-Type': 'application/json' },
    body:    JSON.stringify({ system: systemPrompt, user: userMsg }),
  });
  if (!resp.ok) {
    const e = await resp.json().catch(() => ({}));
    throw new Error(e.error || `AI error ${resp.status}`);
  }
  const data = await resp.json();
  const raw = data.response;
  // Workers AI sometimes returns an already-parsed object ‚Äî normalise to string
  if (raw === null || raw === undefined) return '';
  if (typeof raw === 'object') return JSON.stringify(raw);
  return String(raw);
}

function repairJSON(s) {
  s = s.replace(/,(\s*[}\]])/g, '$1');
  s = s.replace(/"cost"\s*:\s*[\xA3\$\u20AC\s]*(\d+\.?\d*)/g, '"cost": $1');
  let inStr = false, esc = false, opens = [];
  for (let i = 0; i < s.length; i++) {
    const c = s[i];
    if (esc) { esc = false; continue; }
    if (c === '\\' && inStr) { esc = true; continue; }
    if (c === '"') { inStr = !inStr; continue; }
    if (inStr) continue;
    if (c === '{' || c === '[') opens.push(c);
    if (c === '}' || c === ']') opens.pop();
  }
  let out = s.trimEnd().replace(/,\s*$/, '');
  for (let i = opens.length - 1; i >= 0; i--) out += opens[i] === '{' ? '}' : ']';
  return out;
}

function safeParseJSON(text) {
  if (text !== null && typeof text === 'object') return text;
  if (typeof text !== 'string' || !text.trim()) throw new Error('AI returned no usable response');
  let s = text.replace(/```json\s*/gi, '').replace(/```/g, '').trim();
  try { return JSON.parse(s); } catch (_) {}
  s = repairJSON(s);
  try { return JSON.parse(s); } catch (e) {
    throw new Error('Could not parse AI response: ' + e.message);
  }
}

// ‚îÄ‚îÄ AI Generate Recipe from description ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openAiRecipeModal() {
  document.getElementById('ai-recipe-prompt').value = '';
  document.getElementById('ai-recipe-gen-error').style.display = 'none';
  document.getElementById('ai-recipe-gen-modal').classList.add('open');
  setTimeout(() => document.getElementById('ai-recipe-prompt').focus(), 50);
}

async function runAiRecipeGen() {
  const prompt = document.getElementById('ai-recipe-prompt').value.trim();
  if (!prompt) { showRecipeGenError('Please describe what you want to cook.'); return; }
  const btn = document.getElementById('ai-recipe-gen-btn');
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Generating‚Ä¶';
  document.getElementById('ai-recipe-gen-error').style.display = 'none';
  try {
    const raw = await callClaude(
      'You are a professional recipe writer. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
      `Create a complete recipe based on this request: "${prompt}"

Return JSON with exactly these keys:
{
  "name": "Recipe Name",
  "category": "Pasta|Meat|Fish|Vegetarian|Curry|Soup|Salad|Asian|Other",
  "serves": "4",
  "desc": "One enticing sentence description",
  "cookTime": 30,
  "onePot": false,
  "ingredients": [{"name":"","qty":"","unit":"","calories":120}],
  "steps": "1. Step one\\n2. Step two\\n3. Step three"
}
cookTime is total cook time in minutes (integer). onePot is true if the whole dish can be made in one pan/pot/tray.
Each ingredient's "calories" is the total kcal contribution of that quantity (not per 100g).
Include 6-14 ingredients. For units use ONLY: g, kg, ml, l, tsp, tbsp, cup(s), tin(s), jar(s), pack(s), slice(s), cloves, sprigs, sticks, handful, bunch, or leave unit blank for single items. 4-8 clear steps.`
    );
    const r = safeParseJSON(raw);
    if (!r.name) throw new Error('AI did not return a valid recipe');
    // Compute calories from bottom-up ingredient totals
    const serves = parseInt(r.serves) || 4;
    const ingCalTotal = (r.ingredients || []).reduce((s, i) => s + (i.calories ? Number(i.calories) : 0), 0);
    const recipe = {
      id: 'r_' + Date.now(),
      name: r.name,
      category: r.category || 'Other',
      serves: r.serves || '4',
      desc: r.desc || '',
      steps: r.steps || '',
      ingredients: r.ingredients || [],
      cookTime: r.cookTime || null,
      calories: ingCalTotal > 0 ? Math.round(ingCalTotal / serves) : null,
      onePot: !!r.onePot,
    };
    state.recipes.push(recipe);
    await apiFetch('/api/recipes', { method: 'POST', body: JSON.stringify(recipe) });
    closeModal('ai-recipe-gen-modal');
    applyRecipeFilters();
    updateBadges();
    // Open the recipe so user can review it
    setTimeout(() => viewRecipe(recipe.id), 200);
  } catch(e) {
    showRecipeGenError('Could not generate recipe: ' + e.message);
  } finally {
    btn.disabled = false; btn.innerHTML = '‚ú® Generate';
  }
}

function showRecipeGenError(msg) {
  const el = document.getElementById('ai-recipe-gen-error');
  el.textContent = msg; el.style.display = 'block';
}

// ‚îÄ‚îÄ Import Recipe from URL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openUrlImportModal() {
  document.getElementById('url-import-input').value = '';
  document.getElementById('url-import-error').style.display = 'none';
  document.getElementById('url-import-status').style.display = 'none';
  document.getElementById('url-import-modal').classList.add('open');
  setTimeout(() => document.getElementById('url-import-input').focus(), 50);
}

async function runUrlImport() {
  const urlInput = document.getElementById('url-import-input').value.trim();
  if (!urlInput) { showUrlImportError('Please enter a URL.'); return; }
  // Basic URL validation
  let parsedUrl;
  try {
    parsedUrl = new URL(urlInput.startsWith('http') ? urlInput : 'https://' + urlInput);
  } catch(e) {
    showUrlImportError('Please enter a valid URL (e.g. https://www.bbcgoodfood.com/recipes/‚Ä¶)');
    return;
  }
  const btn = document.getElementById('url-import-btn');
  const statusEl = document.getElementById('url-import-status');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Fetching‚Ä¶';
  statusEl.style.display = 'block';
  statusEl.textContent = 'üåê Fetching page‚Ä¶';
  document.getElementById('url-import-error').style.display = 'none';
  try {
    statusEl.textContent = 'üßë‚Äçüç≥ Extracting recipe with AI‚Ä¶';
    const resp = await apiFetch('/api/url-import', {
      method: 'POST',
      body: JSON.stringify({ url: parsedUrl.href }),
    });
    if (!resp.response) throw new Error('No response from AI.');
    const r = safeParseJSON(resp.response);
    if (r.error || !r.name) throw new Error(r.error || 'Could not find a recipe at that URL ‚Äî try a different page.');
    const recipe = {
      id: 'r_' + Date.now(),
      name: r.name,
      category: r.category || 'Other',
      serves: r.serves || '4',
      desc: r.desc || '',
      steps: r.steps || '',
      ingredients: r.ingredients || [],
      cookTime: r.cookTime || null,
      calories: r.calories || null,
      onePot: !!r.onePot,
    };
    state.recipes.push(recipe);
    await apiFetch('/api/recipes', { method: 'POST', body: JSON.stringify(recipe) });
    closeModal('url-import-modal');
    applyRecipeFilters();
    updateBadges();
    setTimeout(() => viewRecipe(recipe.id), 200);
  } catch(e) {
    showUrlImportError(e.message || 'Import failed ‚Äî the site may block access. Try copying the recipe text instead.');
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'üîó Import Recipe';
    statusEl.style.display = 'none';
  }
}

function showUrlImportError(msg) {
  const el = document.getElementById('url-import-error');
  el.textContent = msg; el.style.display = 'block';
}

async function aiSuggestDay(dayIndex) {
  const modal = document.getElementById('ai-modal');
  document.getElementById('ai-modal-title').textContent = `‚ú® Suggestions for ${DAYS[dayIndex]}`;
  document.getElementById('ai-modal-sub').textContent   = 'Tailored to your catalog and what you have this week';
  document.getElementById('ai-suggestions-container').innerHTML =
    `<div style="text-align:center;padding:30px;color:var(--text-muted)">
       <div class="spinner dark" style="width:22px;height:22px;margin:0 auto 10px"></div>
       <div style="font-size:0.85rem">Thinking‚Ä¶</div>
     </div>`;
  modal.classList.add('open');

  const planned     = DAYS.map((d, i) => state.meals[i] ? `${d}: ${state.meals[i].name}` : null).filter(Boolean);
  const pantryNames = state.pantry.map(p => p.name);
  const recipeNames = state.recipes.map(r => r.name);

  try {
    const raw = await callClaude(
      'You are a dinner planning assistant. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
      `I need 4 dinner suggestions for ${DAYS[dayIndex]}.
Already planned this week: ${planned.join(', ') || 'nothing yet'}.
My recipe catalog: ${recipeNames.slice(0,20).join(', ')}.
Pantry items: ${pantryNames.slice(0,20).join(', ') || 'unknown'}.
Return JSON array of exactly 4 objects: [{"name":"...","why":"...","fromCatalog":true}]
"why" is max 15 words. "fromCatalog" true only if the name exactly matches a recipe in my catalog.`
    );
    const suggestions = safeParseJSON(raw);
    document.getElementById('ai-suggestions-container').innerHTML =
      `<div class="ai-suggestions">` +
      suggestions.map(s => `
        <div class="ai-suggestion-item" onclick="pickAiSuggestion(${dayIndex},'${s.name.replace(/'/g,"\\'")}')">
          <div class="sug-name">${s.name} ${s.fromCatalog ? '<span class="ai-badge">üìñ In catalog</span>' : ''}</div>
          <div class="sug-why">${s.why}</div>
        </div>`).join('') +
      `</div>`;
  } catch(e) {
    document.getElementById('ai-suggestions-container').innerHTML =
      `<div style="color:var(--danger);font-size:0.85rem;padding:16px">${e.message}</div>`;
  }
}

function pickAiSuggestion(dayIndex, name) {
  const recipe = state.recipes.find(r => r.name.toLowerCase() === name.toLowerCase());
  const meal = recipe
    ? { name: recipe.name, notes: recipe.steps||'', ingredients: (recipe.ingredients||[]).map(i => ({...i})), recipeId: recipe.id }
    : { name, notes: '', ingredients: [] };
  state.meals[dayIndex] = meal;
  apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex, meal }) });
  closeModal('ai-modal');
  renderWeek();
}

function aiPlanWeek() {
  document.getElementById('ai-week-prefs').value = '';
  document.getElementById('ai-week-modal').classList.add('open');
}
async function runAiWeekPlan() {
  const btn   = document.getElementById('ai-week-go-btn');
  const prefs = document.getElementById('ai-week-prefs').value.trim();
  btn.disabled  = true;
  btn.innerHTML = '<span class="spinner"></span> Planning‚Ä¶';
  try {
    const catalogNames = state.recipes.map(r => r.name);
    if (!catalogNames.length) { alert('No recipes in your catalog yet. Add some recipes first!'); return; }
    const raw = await callClaude(
      'You are a dinner planning assistant. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
      `Plan 7 dinners Monday‚ÄìSunday choosing ONLY from the recipe catalog below. Do not invent recipes.
Recipe catalog: ${catalogNames.join(', ')}.
Pantry: ${state.pantry.map(p => p.name).join(', ') || 'unknown'}.
Preferences: ${prefs || 'none'}.
Return JSON array of 7 objects (Monday first):
[{"day":"Monday","name":"exact recipe name from catalog"}]
Every "name" MUST exactly match a recipe from the catalog list above. Vary types of food.`
    );
    const plan = safeParseJSON(raw);
    closeModal('ai-week-modal');
    const saves = [];
    plan.slice(0, 7).forEach((item, i) => {
      const recipe = state.recipes.find(r => r.name.toLowerCase() === item.name.toLowerCase());
      if (!recipe) return; // skip if not found in catalog
      const meal = { name: recipe.name, notes: recipe.steps||'', ingredients: (recipe.ingredients||[]).map(x => ({...x})), recipeId: recipe.id };
      state.meals[i] = meal;
      saves.push(apiFetch('/api/meals', { method:'POST', body: JSON.stringify({ dayIndex: i, meal }) }));
    });
    await Promise.all(saves);
    renderWeek();
  } catch(e) {
    alert('Could not generate plan: ' + e.message);
  } finally {
    btn.disabled  = false;
    btn.innerHTML = '‚ú® Generate Plan';
  }
}

// ‚îÄ‚îÄ Cost helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcTotalCost(recipe) {
  const ings = recipe.ingredients || [];
  if (!ings.some(i => i.cost)) return 0;
  return ings.reduce((sum, i) => sum + (i.cost ? Number(i.cost) : 0), 0);
}

// ‚îÄ‚îÄ Calorie helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcTotalCalories(recipe) {
  const ings = recipe.ingredients || [];
  if (!ings.some(i => i.calories)) return 0;
  return ings.reduce((sum, i) => sum + (i.calories ? Number(i.calories) : 0), 0);
}

function updateRecipeCaloriesDisplay() {
  const container = document.getElementById('rec-ingredients-container');
  if (!container) return;
  let total = 0;
  let hasAny = false;
  container.querySelectorAll('[id^="ring-row-"]').forEach(row => {
    const id = row.id.replace('ring-row-', '');
    const calEl = document.getElementById(`ring-cal-${id}`);
    if (calEl) {
      const v = parseFloat(calEl.value);
      if (!isNaN(v) && v > 0) { total += v; hasAny = true; }
    }
  });
  const display = document.getElementById('rec-calories-display');
  const hidden  = document.getElementById('rec-calories');
  if (display) {
    display.textContent = hasAny ? `${Math.round(total)} kcal total (enter serves to get per-portion)` : '‚Äî';
    display.style.color = hasAny ? 'var(--text)' : 'var(--text-muted)';
  }
  if (hidden) hidden.value = hasAny ? String(Math.round(total)) : '';
}

// ‚îÄ‚îÄ AI Update All Costs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function aiUpdateAllCosts() {
  if (!state.recipes.length) { alert('No recipes in your catalog.'); return; }
  const btn = document.getElementById('ai-costs-btn');

  // Separate unpriced and already-priced recipes
  const unpriced = state.recipes.filter(r => !calcTotalCost(r));
  const alreadyPriced = state.recipes.filter(r => calcTotalCost(r) > 0);

  if (!unpriced.length) {
    // All already priced ‚Äî ask if they want to update all
    if (!confirm(`All ${alreadyPriced.length} recipes already have cost info. Would you like to re-price them all?`)) return;
    await _runCostUpdate(state.recipes, btn);
    return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner dark"></span> Fetching costs‚Ä¶';
  await _runCostUpdate(unpriced, btn, alreadyPriced.length);
}

async function _runCostUpdate(recipes, btn, skippedCount = 0) {
  btn.disabled = true;
  const BATCH = 2;
  let updated = 0, failed = 0;

  for (let i = 0; i < recipes.length; i += BATCH) {
    const batch = recipes.slice(i, i + BATCH);
    const done = Math.min(i + BATCH, recipes.length);
    btn.innerHTML = `<span class="spinner dark"></span> ${done}/${recipes.length}‚Ä¶`;
    try {
      const recipeList = batch.map(r => ({
        id: r.id, name: r.name, serves: r.serves || '4',
        ingredients: (r.ingredients || []).map(ing => ({ name: ing.name, qty: ing.qty || '', unit: ing.unit || '' }))
      }));
      const raw = await callClaude(
        'You are a UK grocery pricing assistant. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
        `Price each ingredient for the quantity used in GBP. Use plain decimal numbers only, no currency symbols.
Return ONLY this JSON structure, nothing else:
[{"id":"recipe_id","ingredients":[{"name":"ingredient name","cost":0.45}]}]
Recipes: ${JSON.stringify(recipeList)}`
      );
      const results = safeParseJSON(raw);
      if (!Array.isArray(results)) { failed++; continue; }
      const saves = [];
      results.forEach(res => {
        if (!res.id || !Array.isArray(res.ingredients)) return;
        const recipe = state.recipes.find(r => r.id === res.id);
        if (!recipe) return;
        res.ingredients.forEach(priced => {
          const cost = parseFloat(String(priced.cost ?? '').replace(/[^\d.]/g, ''));
          const ing = recipe.ingredients.find(i => i.name.toLowerCase() === priced.name.toLowerCase());
          if (ing && !isNaN(cost) && cost > 0) ing.cost = cost;
        });
        updated++;
        saves.push(apiFetch('/api/recipes', { method: 'POST', body: JSON.stringify(recipe) }));
      });
      await Promise.all(saves);
    } catch(e) {
      console.warn(`Costs batch ${i}‚Äì${done} skipped:`, e.message);
      failed++;
    }
  }

  applyRecipeFilters();
  renderWeek();

  const msg = failed
    ? `‚úì ${updated} priced (${failed} batches failed)`
    : `‚úì ${updated} recipes priced`;

  btn.innerHTML = msg;

  // If we only updated unpriced ones, ask about the rest
  if (skippedCount > 0) {
    setTimeout(async () => {
      if (confirm(`${updated} new recipes priced! There are also ${skippedCount} recipes that already had cost info. Would you like to re-price those too?`)) {
        const alreadyPriced = state.recipes.filter(r => calcTotalCost(r) > 0);
        await _runCostUpdate(alreadyPriced, btn);
      } else {
        btn.disabled = false;
        btn.innerHTML = 'üí∑ AI Update Costs';
      }
    }, 500);
  } else {
    setTimeout(() => { btn.disabled = false; btn.innerHTML = 'üí∑ AI Update Costs'; }, 3000);
  }
}

// ‚îÄ‚îÄ AI Update All Calories ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function aiUpdateAllCalories() {
  if (!state.recipes.length) { alert('No recipes in your catalog.'); return; }
  const btn = document.getElementById('ai-calories-btn');

  // Separate recipes with no ingredient calories from those that already have them
  const uncalculated = state.recipes.filter(r => !calcTotalCalories(r));
  const alreadyCalc  = state.recipes.filter(r => calcTotalCalories(r) > 0);

  if (!uncalculated.length) {
    // All already have calories ‚Äî ask if they want to re-estimate all
    if (!confirm(`All ${alreadyCalc.length} recipes already have calorie info. Would you like to re-estimate them all?`)) return;
    await _runCalorieUpdate(state.recipes, btn);
    return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner dark"></span> Estimating calories‚Ä¶';
  await _runCalorieUpdate(uncalculated, btn, alreadyCalc.length);
}

async function _runCalorieUpdate(recipes, btn, skippedCount = 0) {
  btn.disabled = true;
  const BATCH = 2;
  let updated = 0, failed = 0;

  for (let i = 0; i < recipes.length; i += BATCH) {
    const batch = recipes.slice(i, i + BATCH);
    const done = Math.min(i + BATCH, recipes.length);
    btn.innerHTML = `<span class="spinner dark"></span> ${done}/${recipes.length}‚Ä¶`;
    try {
      const recipeList = batch.map(r => ({
        id: r.id, name: r.name, serves: r.serves || '4',
        ingredients: (r.ingredients || []).map(ing => ({ name: ing.name, qty: ing.qty || '', unit: ing.unit || '' }))
      }));
      const raw = await callClaude(
        'You are a nutritionist. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
        `Estimate the calories for each ingredient in each recipe.
Return ONLY this JSON structure, nothing else:
[{"id":"recipe_id","ingredients":[{"name":"ingredient name","calories":120}]}]
calories is the total kcal contribution of that ingredient quantity as listed (not per 100g).
Recipes: ${JSON.stringify(recipeList)}`
      );
      const results = safeParseJSON(raw);
      if (!Array.isArray(results)) { failed++; continue; }
      const saves = [];
      results.forEach(res => {
        if (!res.id || !Array.isArray(res.ingredients)) return;
        const recipe = state.recipes.find(r => r.id === res.id);
        if (!recipe) return;
        res.ingredients.forEach(estimated => {
          const cal = parseFloat(String(estimated.calories ?? '').replace(/[^\d.]/g, ''));
          const ing = recipe.ingredients.find(i => i.name.toLowerCase() === estimated.name.toLowerCase());
          if (ing && !isNaN(cal) && cal > 0) ing.calories = cal;
        });
        // Recompute recipe.calories from bottom-up total
        const serves = parseInt(recipe.serves) || 4;
        const ingCalTotal = recipe.ingredients.reduce((s, i) => s + (i.calories ? Number(i.calories) : 0), 0);
        recipe.calories = ingCalTotal > 0 ? Math.round(ingCalTotal / serves) : recipe.calories;
        updated++;
        saves.push(apiFetch('/api/recipes', { method: 'POST', body: JSON.stringify(recipe) }));
      });
      await Promise.all(saves);
    } catch(e) {
      console.warn(`Calories batch ${i}‚Äì${done} skipped:`, e.message);
      failed++;
    }
  }

  applyRecipeFilters();
  renderWeek();

  const msg = failed
    ? `‚úì ${updated} updated (${failed} batches failed)`
    : `‚úì ${updated} recipes updated`;

  btn.innerHTML = msg;

  if (skippedCount > 0) {
    setTimeout(async () => {
      if (confirm(`${updated} new recipes estimated! There are also ${skippedCount} recipes that already had calorie info. Would you like to re-estimate those too?`)) {
        const alreadyCalc = state.recipes.filter(r => calcTotalCalories(r) > 0);
        await _runCalorieUpdate(alreadyCalc, btn);
      } else {
        btn.disabled = false;
        btn.innerHTML = 'üî• AI Update Calories';
      }
    }, 500);
  } else {
    setTimeout(() => { btn.disabled = false; btn.innerHTML = 'üî• AI Update Calories'; }, 3000);
  }
}

async function aiGenerateRecipe() {
  const name = document.getElementById('rec-name').value.trim();
  if (!name) { alert('Enter a recipe name first.'); return; }
  const btn = document.getElementById('ai-gen-btn');
  btn.disabled  = true;
  btn.innerHTML = '<span class="spinner"></span>';
  try {
    const raw = await callClaude(
      'You are a recipe assistant. Respond ONLY with valid JSON ‚Äî no markdown, no explanation.',
      `Generate a complete recipe for: "${name}"
Return JSON with exactly these keys:
{"category":"Pasta|Meat|Fish|Vegetarian|Curry|Soup|Salad|Asian|Other","serves":"4","desc":"one sentence","cookTime":30,"onePot":false,"ingredients":[{"name":"","qty":"","unit":"","calories":120}],"steps":"1. ...\n2. ..."}
cookTime is total minutes (integer). onePot true if one pan/pot/tray.
Each ingredient's "calories" is the total kcal contribution of that quantity (not per 100g).
For units use ONLY: g, kg, ml, l, tsp, tbsp, cup(s), tin(s), jar(s), pack(s), slice(s), cloves, sprigs, sticks, handful, bunch, or leave unit blank for single items.`
    );
    const r = safeParseJSON(raw);
    if (r.category) {
      const catEl = document.getElementById('rec-cat');
      for (const o of catEl.options) { if (o.value === r.category) { catEl.value = r.category; break; } }
    }
    if (r.serves)   document.getElementById('rec-serves').value   = r.serves;
    if (r.desc)     document.getElementById('rec-desc').value     = r.desc;
    if (r.steps)    document.getElementById('rec-steps').value    = r.steps;
    if (r.cookTime) document.getElementById('rec-cooktime').value = r.cookTime;
    if (r.onePot !== undefined) document.getElementById('rec-onepot').checked = !!r.onePot;
    if (r.ingredients) {
      document.getElementById('rec-ingredients-container').innerHTML = '';
      recIngCount = 0;
      r.ingredients.forEach(ing => addRecipeIngRow(ing));
      updateRecipeCaloriesDisplay();
    }
  } catch(e) {
    alert('Could not generate recipe: ' + e.message);
  } finally {
    btn.disabled  = false;
    btn.innerHTML = '‚ú® AI Fill';
  }
}
</script>

<div id="loading-overlay" style="display:none;position:fixed;inset:0;background:rgba(253,248,242,0.92);z-index:500;align-items:center;justify-content:center;flex-direction:column;gap:14px">
  <div class="spinner dark" style="width:32px;height:32px"></div>
  <div style="color:var(--text-muted);font-size:0.9rem">Loading your data‚Ä¶</div>
</div>

</body>
</html>
